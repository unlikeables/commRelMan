"use strict";function crearPDF(){console.log("creando el objeto para crear pdf");var doc=new jsPDF;doc.setFontSize(40),doc.text(35,25,"Paranyan loves jsPDF"),doc.addImage(imgData,"JPEG",15,40,180,160),doc.save("Reportes.pdf"),console.log("fin de la generacion de pdf")}var ApplicationConfiguration=function(){var applicationModuleName="likeable-crm",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","btford.socket-io","dcbImgFallback","gettext","highcharts-ng"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).constant("CONSTANT",{host:"https://crm.likeable.mx",fbapiversion:"/v2.4/"}),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("accounts"),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("charts"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("csvs"),ApplicationConfiguration.registerModule("feeds"),ApplicationConfiguration.registerModule("influencers"),ApplicationConfiguration.registerModule("themes"),ApplicationConfiguration.registerModule("users"),angular.module("accounts").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Empresas","accounts","dropdown","/accounts(/create)?"),Menus.addSubMenuItem("topbar","accounts","Listado de las Empresas","accounts"),Menus.addSubMenuItem("topbar","accounts","Añadir Empresa","accounts/create")}]);var user,permisos=[{rol:"app-manager",permisos:["1","2"]},{rol:"account-manager",permisos:["1"]},{rol:"user",permisos:[0]}];angular.module("accounts").controller("SettingsController",["$scope","Authentication",function($scope,Authentication){user=Authentication.user}]).config(["$stateProvider",function($stateProvider){$stateProvider.state("listAccounts",{url:"/accounts",templateUrl:"modules/accounts/views/list-accounts.client.view.html"}).state("listTwit",{url:"/get/twits",templateUrl:"modules/accounts/views/lista.twits.view.html"}).state("createAccount",{url:"/accounts/create",templateUrl:function(){for(var permiso in permisos)if(user.roles[0]===permisos[permiso].rol)return permisos[permiso].permisos.indexOf(2)>0?"modules/accounts/views/create-account.client.view.html":"modules/users/views/404.html"}}).state("viewAccount",{url:"/accounts/:accountId",templateUrl:"modules/accounts/views/view-account.client.view.html"}).state("inbox",{url:"/inbox",templateUrl:"modules/accounts/views/inbox.html"}).state("editAccount",{url:"/accounts/:accountId/edit",templateUrl:"modules/accounts/views/edit-account.client.view.html"}).state("dashboard",{url:"/dashboard",templateUrl:"modules/accounts/views/dashboard.html"})}]),angular.module("accounts").filter("linksTwitter",["$filter",function($filter){return function(text,target){if(!text)return text;var replacedText=$filter("linky")(text,target),targetAttr="";angular.isDefined(target)&&(targetAttr=' target="'+target+'"');var patronMencion=/(^|\s)#(\w*[a-zA-Z_]+\w*)/gim;replacedText=text.replace(patronMencion,'$1<a target="_blank" class="link-twitter link-twitter-mencion" href="https://twitter.com/search?q=%23$2"'+targetAttr+">#$2</a>");var patronHashtag=/(^|\s)\@(\w*[a-zA-Z_]+\w*)/gim;return replacedText=replacedText.replace(patronHashtag,'$1<a target="_blank" class="link-twitter link-twitter-hastag" href="https://twitter.com/$2"'+targetAttr+">@$2</a>")}}]).controller("AccountsController",["$scope","$http","$resource","$stateParams","$location","Authentication","Accounts","CONSTANT",function($scope,$http,$resource,$stateParams,$location,Authentication,Accounts,CONSTANT){$scope.authentication=Authentication,Highcharts.setOptions({lang:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Novimbre","Diciembre"],weekdays:["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"],shortMonths:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]}}),$scope.statusLoginFacebook=!1,"undefined"!=typeof $scope.authentication.user.additionalProvidersData&&($scope.statusLoginFacebook=!0),$scope.fechaActual=new Date,$scope.esquemaColores=["#465769","#005b8a","#aea9fd","#ffc65b","#31d6c5","#fe8081","#dee2eb","#a8d6e3","#f37c00"],$scope.constant=CONSTANT,$scope.creaArchivo=function(nombreSistema,opcion){function obtenPorcentajes(obj,total){var obj_perce={};for(var i in obj)0===obj[i]?obj_perce[i]=0:obj_perce[i]=Math.round((100*obj[i]/total).toFixed(2));return obj_perce}$scope.clickSentiment=function(key,value){0!==value&&window.open($scope.constant.host+"/#!/filtroAccount?first="+fecha_inicial+"&second="+fecha_final+"&sentiment="+key+"&cuenta="+nombreSistema+"&opcion="+opcion)},void 0===nombreSistema&&(nombreSistema=Authentication.user.cuenta.marca),void 0===opcion&&(opcion="general");var obj={};obj.fecha_inicial=$scope.dt;var fecha_inicial=$scope.dt,fecha_final=$scope.dt2,right_now=new Date;fecha_final.getDate()===right_now.getDate()?obj.fecha_final=fecha_final:(fecha_final.setHours(23),fecha_final.setMinutes(59),fecha_final.setSeconds(59),obj.fecha_final=fecha_final),$scope.graficaTags("create",nombreSistema,obj.fecha_inicial,obj.fecha_final),obj.coleccion=nombreSistema+"_consolidada",obj.tipo=opcion,obj.nombreSistema=nombreSistema;$http.post("/generaArchivo",obj).success(function(items){var data=items,csv=[["Categoria","Número"]],contador=1,contador2=0,contador_coincidencias=[],n=[],title=[],obj={},series=[],sentiment={};sentiment.negativo=items.sentiment_negativo,sentiment.neutro=items.sentiment_neutro,sentiment.positivo=items.sentiment_positivo,$scope.numeroSentiment=sentiment;var total=0;for(var x in sentiment)total+=sentiment[x];$scope.sentiment_perce=obtenPorcentajes(sentiment,total),isNaN($scope.sentiment_perce.negativo)===!0&&isNaN($scope.sentiment_perce.neutro)===!0&&isNaN($scope.sentiment_perce.positivo)===!0||0===$scope.sentiment_perce.negativo&&0===$scope.sentiment_perce.neutro&&0===$scope.sentiment_perce.positivo?$scope.mostrarSentiment=!1:$scope.mostrarSentiment=!0;var divTema,temasTemas=[],subtemasTemas=[],objTemp={};for(var tt in items)objTemp={},divTema=tt.split("_"),1==divTema.length&&(objTemp.name=tt,objTemp.y=items[tt],objTemp.drilldown=tt,temasTemas.push(objTemp),objTemp={},objTemp.id=divTema[0],objTemp.data=[],objTemp.events={click:function(e,i){}},subtemasTemas.push(objTemp));for(var tt in items){objTemp={},divTema=tt.split("_");var arrayTemporal=[];if(1!=divTema.length)for(var st in subtemasTemas)subtemasTemas[st].id===divTema[0]&&(arrayTemporal[0]=divTema[1],arrayTemporal[1]=items[tt],subtemasTemas[st].data.push(arrayTemporal))}$scope.sentiment=sentiment;for(var i in data){-1===i.search("_")&&(obj[contador2]={name:i,drilldown:i,y:data[i]},series.push({id:i,events:{click:function(e,i){}},data:[]}),contador2++);for(var k in obj)-1!==i.search(obj[k].name)&&-1!==i.search("_")&&(contador_coincidencias.hasOwnProperty(obj[k].name)?contador_coincidencias[obj[k].name]+=data[i]:contador_coincidencias[obj[k].name]=data[i]);csv[contador]=[i,data[i]],n[contador-1]=data[i],title[contador-1]=i,contador++}var arr_subtemas=[];contador=0;var array=[];for(var j in obj)if(contador=0,"undefined"!==obj[j].name){array.push(obj[j]);for(var l in data)if(-1!==l.search(obj[j].name)&&-1!==l.search("_")){0===contador&&(arr_subtemas[obj[j].name]=[]);var start=l.indexOf("_"),subtema=l.slice(start+1);for(var z in series)series[z].id===obj[j].drilldown&&series[z].data.push([subtema,data[l]]);arr_subtemas[obj[j].name][contador]=subtema,contador++}}for(var graf_subtemas={},i=0;i<=series.length;i++)if(series[i])for(var j in series[i].data)"Subtema"!==series[i].data[j][0]&&(graf_subtemas.hasOwnProperty(series[i].data[j][0])?graf_subtemas[series[i].data[j][0]]+=series[i].data[j][1]:graf_subtemas[series[i].data[j][0]]=series[i].data[j][1]);var temasDrillOrd=array.slice(0);temasDrillOrd.sort(function(a,b){var x=a.y,y=b.y;return x>y?-1:y>x?1:0}),$scope.temasDecarga=temasDrillOrd;for(var cuentaTemasDrill=temasDrillOrd.length-1,totalTemas=0,recorreTemas=0;cuentaTemasDrill>=recorreTemas;recorreTemas++)totalTemas+=temasDrillOrd[recorreTemas].y;$scope.totalTemas=totalTemas;var topTemasDrill=[];if(10>cuentaTemasDrill)for(var i=0;cuentaTemasDrill>=i;i++)topTemasDrill.push(temasDrillOrd[i]);else for(var i=0;10>i;i++)topTemasDrill.push(temasDrillOrd[i]);topTemasDrill.length>0?$scope.mostrarTemasDrill=!0:$scope.mostrarTemasDrill=!1,$scope.config={loading:!0,options:{chart:{type:"pie",events:{redraw:function(){$scope.config.loading=!1}}},drilldown:{drillUpButton:{relativeTo:"spacingBox",position:{y:0,x:-40}},allowPointDrilldown:!1,series:subtemasTemas},legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20,enabled:!0},lang:{drillUpText:"<< Regresar"},exporting:{width:1e3,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="temas_subtemas",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},height:"500px",title:{text:""},credits:{enabled:!1},xAxis:{type:"category"},legend:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage+" %"}}},series:{borderWidth:0,dataLabels:{enabled:!0}}},series:[{name:"Total",colorByPoint:!0,data:temasTemas}]};var objTemas=new Array;for(var i in topTemasDrill)objTemas.push({name:topTemasDrill[i].name,y:topTemasDrill[i].y,events:{click:function(e,i){window.open($scope.constant.host+"/#!/filtroAccount?first="+fecha_inicial+"&second="+fecha_final+"&tema="+e.point.name+"&total="+e.point.y+"&cuenta="+nombreSistema+"&opcion="+opcion)}}});objTemas.length>0?$scope.mostrarTemas=!0:$scope.mostrarTemas=!1;for(var t in objTemas)objTemas[t].color=$scope.esquemaColores[t];$scope.tipoGraficaTemas="pie",$scope.chartTemas={loading:!0,chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:" "},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{chart:{events:{redraw:function(){$scope.chartTemas.loading=!1}}},legend:{enabled:!0,align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20,labelFormatter:function(){return this.name+" ("+this.y+")"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return Math.round(this.percentage.toFixed(2))+"%"},style:{fontWeight:"bold",color:"black"}},showInLegend:!0},column:{dataLabels:{enabled:!0,formatter:function(){return this.y}}}},exporting:{width:1500,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="top_temas",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}},{text:"Exportar CSV Temas",onclick:function(){$scope.descargaTemas($scope.nombre_cuenta,$scope.temasDecarga,$scope.totalTemas)}},{text:"&nbsp;"}]}}}},xAxis:{categories:{},lineColor:"transparent"},yAxis:{title:{text:" "}},series:[{type:$scope.tipoGraficaTemas,name:"Total",data:objTemas}]},$scope.cambiarGraf=function(){console.log("$scope.cambiarGraf"),$scope.chartTemas.series[0].type="column"},$scope.cambiarGraficaTemas=function(){$scope.chartTemas.series[0].type=$scope.tipoGraficaTemas};var objSubTemas=new Array;for(var i in series)for(var j in series[i].data)objSubTemas.push(series[i].data[j]);var objSubTemasC=new Array,contadorSubtemas=0,totalSubtemas=0;for(var i in graf_subtemas)totalSubtemas+=graf_subtemas[i],objSubTemasC.push({name:i,y:graf_subtemas[i],events:{click:function(e,i){window.open($scope.constant.host+"/#!/filtroAccount?first="+fecha_inicial+"&second="+fecha_final+"&subtema="+e.point.name+"&total="+e.point.y+"&cuenta="+nombreSistema+"&opcion="+opcion)}}}),contadorSubtemas++;objSubTemasC.sort(function(a,b){return b.y-a.y}),$scope.subtemasDecarga=objSubTemasC,$scope.totalSubtemas=totalSubtemas;var cuentaSubTemas=objSubTemasC.length-1,topSubTemas=[];if(10>cuentaSubTemas)for(var i=0;cuentaSubTemas>=i;i++)topSubTemas.push(objSubTemasC[i]);else for(var i=0;10>i;i++)topSubTemas.push(objSubTemasC[i]);for(var t in topSubTemas)topSubTemas[t].color=$scope.esquemaColores[t];$scope.tipoGraficaSubTemas="pie",$scope.chartSubTemas={loading:!0,chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:" "},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{chart:{events:{redraw:function(){$scope.chartSubTemas.loading=!1}}},legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return Math.round(this.percentage.toFixed(2))+"%"}},showInLegend:!0,distance:-50,style:{fontWeight:"bold",color:"black"}},showInLegend:!0},exporting:{width:1500,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="top_subtemas",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}},{textKey:"downloadPNG",text:"Exportar CSV Subtemas",onclick:function(){$scope.descargaSubtemas($scope.nombre_cuenta,$scope.subtemasDecarga,$scope.totalSubtemas)}}]}}}},xAxis:{categories:{},lineColor:"transparent"},yAxis:{title:{text:" "}},series:[{type:$scope.tipoGraficaSubTemas,name:"Total",data:topSubTemas}]},$scope.cambiarGraficaSubTemas=function(){$scope.chartSubTemas.series[0].type=$scope.tipoGraficaSubTemas},objSubTemasC.length>0?$scope.mostrarSubtemas=!0:$scope.mostrarSubtemas=!1;var csvContent="";if(0!==data){csv.forEach(function(infoArray,index){var dataString=infoArray.join(",");csvContent+=index<csv.length?dataString+"\n":dataString});var encodedUri=encodeURI(csvContent);$scope.archivo=encodedUri}else console.log("No hubo resultados para ese rango de fechas")}),$http.post("/chartPromedioCasos",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(data){var total=data.Completos+data.Descartados+data.Entrada;console.log("Imprimiendo el total de promedio caso"),console.log(data),$scope.totalCasos=total;var vistos=total-data.Entrada,obj=new Array,coloresPromedioCasos={"En Proceso":"#32b9d9",Descartados:"#8ed996",Entrada:"#465769",Completos:"#f67c01"};for(var i in data)obj.push({name:i.replace("Proceso","En Proceso"),y:data[i],color:coloresPromedioCasos[i.replace("Proceso","En Proceso")]});obj.sort(function(a,b){return b.y-a.y}),0===total?$scope.mostrarPromedioCasos=!1:$scope.mostrarPromedioCasos=!0;var porcentajeTotalCasos=Math.round(parseInt(vistos)/parseInt(total)*100);isNaN(porcentajeTotalCasos)?$scope.porcentajeTotalCasos=0:$scope.porcentajeTotalCasos=porcentajeTotalCasos,$scope.porcentajeTotalCasos<=0&&($scope.loadingTotalCasos=!1);var casos={};casos.crm=data.Completos+data.Descartados,casos.facebook=data.facebook;var arregloDona=[];"twitter"===opcion?(casos.total=data.Completos+data.Descartados+data.Entrada,casos.resto=casos.total-casos.crm,arregloDona=[{type:"pie",name:"Número de Casos",innerSize:"50%",data:[{index:0,name:"Atendidos en CRM",color:"#0DBEC8",y:casos.crm},{index:1,name:"No Atendidos",color:"#EBEEF3",y:casos.resto}],dataLabels:{enabled:!1}}]):(casos.total=data.Completos+data.Descartados+data.Entrada+data.facebook,casos.resto=casos.total-(casos.crm+casos.facebook),arregloDona=[{type:"pie",name:"Número de Casos",innerSize:"50%",data:[{index:0,name:"Atendidos en CRM",color:"#0DBEC8",y:casos.crm},{index:1,name:"Atendidos en Facebook",color:"#4A669F",y:casos.facebook},{index:2,name:"No Atendidos",color:"#EBEEF3",y:casos.resto}],dataLabels:{enabled:!1}}]),$scope.chartDona={loading:!0,options:{chart:{events:{redraw:function(){$scope.chartDona.loading=!1}}},title:{text:" ",align:"center",verticalAlign:"middle",y:40},tooltip:{enabled:!0},plotOptions:{pie:{borderWidth:1,borderColor:"silver",dataLabels:{enabled:!0,distance:-50,style:{fontWeight:"bold",color:"white",textShadow:"0px 1px 2px black"}},startAngle:-90,endAngle:90}},exporting:{chartOptions:{width:2e3,margin:[100,100,100,100]},buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="total_de_casos",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},title:{text:$scope.porcentajeTotalCasos+"%",style:{fontWeight:"bold",fontSize:"30px"}},subtitle:{text:'<div style="text-align:center; border:0px !important;"><span style="font-size:14px;color:black;">'+(casos.total-casos.resto)+" de "+casos.total+" Casos</span><br/>",floating:!1,verticalAlign:"bottom",y:-105,style:{color:"#FF00FF",fontWeight:"bold"}},series:arregloDona},$scope.loadingPromedioCasos=!0,$scope.tipoPromedioCasos="pie";for(var o in obj)"En Proceso"==obj[o].name&&(obj[o].name="Atendidos"),"Completos"==obj[o].name&&(obj[o].name="Atendidos"),"facebook"==obj[o].name&&(obj[o].name="Atendidos en FB");$scope.chartPromedioCasos={loading:!0,chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,height:300},credits:{enabled:!1},title:{text:" "},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{chart:{width:380,spacingRight:20,events:{redraw:function(){$scope.chartPromedioCasos.loading=!1}}},legend:{enabled:!0,align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20,labelFormatter:function(){return this.name+" ("+this.y+")"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return this.percentage.toFixed(1)+"%"},style:{fontWeight:"bold",color:"black"}},showInLegend:!0}},exporting:{buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="promedio_de_casos",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},xAxis:{categories:{},lineColor:"transparent"},yAxis:{title:{text:" "}},series:[{type:$scope.tipoPromedioCasos,name:"Total",data:obj}]},$scope.cambiarGraficaPromedioCasos=function(){$scope.chartPromedioCasos.series[0].type=$scope.tipoPromedioCasos}}),$http.post("/chartNivelServicio",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(datosNServicio){var obj=new Array,menosHora=new Array,unaOcho=new Array,ochoVeinticuatro=new Array,masVeinticuatro=new Array;for(var i in datosNServicio)menosHora.push(datosNServicio[i].menosHora),unaOcho.push(datosNServicio[i].unaOcho),ochoVeinticuatro.push(datosNServicio[i].ochoVeinticuatro),masVeinticuatro.push(datosNServicio[i].masVeinticuatro);obj.push({name:"Menos de 1 hr",y:datosNServicio.menosHora,color:"#8ed996"}),obj.push({name:"1 - 8 hrs",y:datosNServicio.unaOcho,color:"#32b9d9"}),obj.push({name:"8 - 24 hrs",y:datosNServicio.ochoVeinticuatro,color:"#f67c01"}),obj.push({name:"Más de 24 hrs",y:datosNServicio.masVeinticuatro,color:"#5F7082"}),obj.sort(function(a,b){return b.y-a.y}),$scope.tipoGraficaNivelServicio="pie",$scope.chartNivelServicio={loading:!0,chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},title:{text:" "},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{chart:{events:{redraw:function(){$scope.chartNivelServicio.loading=!1}}},legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return Math.round(this.percentage.toFixed(2))+"%"},style:{fontWeight:"bold",color:"black"}},showInLegend:!0}},exporting:{width:1e3,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="nivel_de_servicio",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},xAxis:{categories:{},lineColor:"transparent"},yAxis:{title:{text:" "}},series:[{type:$scope.tipoGraficaNivelServicio,name:"Total",data:obj}]},$scope.cambiarGraficaNivelServicio=function(){$scope.chartNivelServicio.series[0].type=$scope.tipoGraficaNivelServicio};var sumaNivelServicio=0;for(var o in obj)sumaNivelServicio+="undefined"==typeof obj[o].y?0:parseInt(obj[o].y);0!==sumaNivelServicio?$scope.mostrarNivelServicio=!0:$scope.mostrarNivelServicio=!1}),$http.post("/chartDescartados",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(data_graf_descartados){if("No hubo resultados"!==data_graf_descartados){console.log(data_graf_descartados),$scope.mostrarMotivoDescarte=!0;var op,objDescartados=new Array,coloresDescartados={respondidas:"#E3684D",insulto:"#5FBED2","no Relacionado":"#F7C479",spam:"#8DD995",troll:"#739FFF",otro:"#FCA1BF",irrelevante:"#f8c479","mediático":"#7CB5EC","campaña":"#5F7082"};for(var i in data_graf_descartados){switch(i){case"respondidas":op="answered";break;case"insulto":op="insult";break;case"troll":op="troll";break;case"otro":op="otro";break;case"irrelevante":op="not-related";break;case"mediático":op="mediatico";break;case"campaña":op="campaign";break;case"spam":op="spam"}"total"!==i&&objDescartados.push({name:i,y:data_graf_descartados[i],color:coloresDescartados[i],events:{click:function(e,i){window.open($scope.constant.host+"/#!/filtroAccount?first="+fecha_inicial+"&second="+fecha_final+"&descartado="+e.point.op+"&total="+e.point.y+"&cuenta="+nombreSistema+"&opcion="+opcion),console.log(e.point),console.log(e)}},op:op})}objDescartados.sort(function(a,b){return b.y-a.y}),$scope.chartDescartados={loading:!0,chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},title:{text:" "},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{chart:{width:380,events:{redraw:function(){$scope.chartDescartados.loading=!1}}},legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return Math.round(this.percentage.toFixed(2))+"%"},style:{fontWeight:"bold",color:"black"}},showInLegend:!0}},exporting:{width:1e3,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="motivo_de_descarte",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}},{text:"Exportar CSV Descartados",onclick:function(){$scope.descargaDescartados($scope.nombre_cuenta,$scope.dt,$scope.dt2,opcion)}}]}}}},series:[{type:"pie",name:"Total",data:objDescartados}]}}else $scope.mostrarMotivoDescarte=!1,console.log("No hay descartados")}),$http.post("/chartDesempenio",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(data_desem){var existe_data=0;if("No hubo resultados"!==data_desem){var obj_desem=new Array,arr_names=new Array,aux_descartado=new Array,aux_atendidos=new Array,aux_respuestas=new Array,images=(new Array,{}),count=0,miniatura="";for(var i in data_desem)if(0!==data_desem[i].total){count++,existe_data++,images['<span style="text-align:center";>'+data_desem[i].nombre+'<br><span style="font-weight:bold;">'+data_desem[i].total+" Casos</span></span>"]=data_desem[i].imagen?'<br><img src="'+data_desem[i].imagen+'" class="circular--ligero" style="width:30px; height:30px;border-radius:50%;">':'<br><img src="/modules/core/img/usuario-sem-imagem.png" class="circular-ligero" style="width:30px; height:30px;border-radius:50%;">',miniatura=data_desem[i].imagen,(""==miniatura||"undefined"==typeof miniatura)&&(miniatura="/modules/core/img/usuario-sem-imagem.png");var totalPorcentaje=data_desem[i].total/$scope.totalCasos*100;totalPorcentaje=totalPorcentaje.toFixed(2),arr_names.push('<div class="datos-desempeno"><a title="'+data_desem[i].nombre+": "+totalPorcentaje+"% \nAtendidos: "+data_desem[i].atendidos+"\nDescartados: "+data_desem[i].descartado+"\nTotal: "+data_desem[i].total+'"><img src="'+miniatura+'" class="circular-ligero" style="width:30px; cursor:pointer; height:30px;border-radius:50%; max-width:100px;"></a></div>'),aux_atendidos.push(data_desem[i].atendidos),aux_descartado.push(data_desem[i].descartado)}console.log("auxiliares !!!"),console.log(aux_atendidos),console.log(aux_descartado),console.log(aux_respuestas),obj_desem.push({name:"Descartados",data:aux_descartado,color:"#8ed996",events:{click:function(e,i){console.log(e.point),window.open($scope.constant.host+"/#!/filtroAccount?first="+fecha_inicial+"&second="+fecha_final+"&usuario="+e.point.op+"&tipo="+e.point.tipo+"&cuenta="+nombreSistema+"&opcion="+opcion)}}}),obj_desem.push({name:"Atendidos",data:aux_atendidos,color:"#f67c01",events:{click:function(e,i){console.log(e.point),window.open($scope.constant.host+"/#!/filtroAccount?first="+fecha_inicial+"&second="+fecha_final+"&usuario="+e.point.op+"&tipo="+e.point.tipo+"&cuenta="+nombreSistema+"&opcion="+opcion)}}}),0===existe_data?$scope.mostrarDesempenoEquipo=!1:$scope.mostrarDesempenoEquipo=!0,$scope.obj_desem=obj_desem;var alto=400>50*count?400:50*count;console.log("Alto !!!!!"),console.log(alto),$scope.loadingDesempenio=!1,$scope.chartDesempenio={loading:!0,options:{chart:{type:"bar",height:alto,renderTo:"container",events:{redraw:function(){$scope.chartDesempenio.loading=!1}}},title:{text:" "},credits:{enabled:!1},xAxis:{categories:arr_names,labels:{useHTML:!0,textAlign:"left",formatter:function(){return this.value}}},yAxis:{min:0,allowDecimals:!1,title:{text:" "}},legend:{reversed:!0},scrollbar:{enabled:!1},plotOptions:{series:{stacking:"normal"}},exporting:{width:1e3,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="desempeño_del_equipo",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},series:obj_desem}}else $scope.mostrarDesempenoEquipo=!1}),$http.post("/chartPromedioRespuesta",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(data_tiempo){if("No hubo resultados"!==data_tiempo){var obj_tiempo_respuesta=new Array,contadorTiempoRespuesta=0;for(var i in data_tiempo)obj_tiempo_respuesta.push({name:i,y:data_tiempo[i],color:$scope.esquemaColores[contadorTiempoRespuesta]}),contadorTiempoRespuesta++;$scope.chartTiempoRespuesta={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:" "},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return Math.round(this.percentage.toFixed(2))+"%"},style:{fontWeight:"bold",color:"black"}},showInLegend:!0}},exporting:{width:1e3,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="promedio_de_respuesta",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},series:[{type:"pie",name:"Total",data:obj_tiempo_respuesta}]},$scope.mostrarPromedioRespuesta=!0}else $scope.mostrarPromedioRespuesta=!1,console.log("No hubo resultados de tiempo promedio")}),$http.post("/chartRating",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(dataRating){console.log("LA RESPUESTA DE CHART RATING"),console.log(dataRating),0===dataRating?$scope.mostrarRating=!1:$scope.mostrarRating=!0,$scope.rating=dataRating}),$http.post("/chartPromedioTiempo",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(data_promedio_tiempo){$scope.chartPromedioTiempo=data_promedio_tiempo}),$http.post("/chartDesempenioHora",{nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2,tipo:opcion}).success(function(desempenioHora){var totalAT=0,arregloAT=[];"twitter"===opcion?(totalAT=desempenioHora.totalAtendidos-desempenioHora.totalFacebook,arregloAT=[desempenioHora.atendidos.cero,desempenioHora.atendidos.una,desempenioHora.atendidos.dos,desempenioHora.atendidos.tres,desempenioHora.atendidos.cuatro,desempenioHora.atendidos.cinco,desempenioHora.atendidos.seis,desempenioHora.atendidos.siete,desempenioHora.atendidos.ocho,desempenioHora.atendidos.nueve,desempenioHora.atendidos.diez,desempenioHora.atendidos.once,desempenioHora.atendidos.doce,desempenioHora.atendidos.trece,desempenioHora.atendidos.catorce,desempenioHora.atendidos.quince,desempenioHora.atendidos.dieciseis,desempenioHora.atendidos.diecisiete,desempenioHora.atendidos.dieciocho,desempenioHora.atendidos.diecinueve,desempenioHora.atendidos.veinte,desempenioHora.atendidos.veintiuno,desempenioHora.atendidos.veintidos,desempenioHora.atendidos.veintitres]):(totalAT=desempenioHora.totalAtendidos,
arregloAT=[desempenioHora.atendidos.cero+desempenioHora.facebook.cero,desempenioHora.atendidos.una+ +desempenioHora.facebook.una,desempenioHora.atendidos.dos+desempenioHora.facebook.dos,desempenioHora.atendidos.tres+desempenioHora.facebook.tres,desempenioHora.atendidos.cuatro+desempenioHora.facebook.cuatro,desempenioHora.atendidos.cinco+desempenioHora.facebook.cinco,desempenioHora.atendidos.seis+desempenioHora.facebook.seis,desempenioHora.atendidos.siete+desempenioHora.facebook.siete,desempenioHora.atendidos.ocho+desempenioHora.facebook.ocho,desempenioHora.atendidos.nueve+desempenioHora.facebook.nueve,desempenioHora.atendidos.diez+desempenioHora.facebook.diez,desempenioHora.atendidos.once+desempenioHora.facebook.once,desempenioHora.atendidos.doce+desempenioHora.facebook.doce,desempenioHora.atendidos.trece+desempenioHora.facebook.trece,desempenioHora.atendidos.catorce+desempenioHora.facebook.catorce,desempenioHora.atendidos.quince+desempenioHora.facebook.quince,desempenioHora.atendidos.dieciseis+desempenioHora.facebook.dieciseis,desempenioHora.atendidos.diecisiete+desempenioHora.facebook.diecisiete,desempenioHora.atendidos.dieciocho+desempenioHora.facebook.dieciocho,desempenioHora.atendidos.diecinueve+desempenioHora.facebook.diecinueve,desempenioHora.atendidos.veinte+desempenioHora.facebook.veinte,desempenioHora.atendidos.veintiuno+desempenioHora.facebook.veintiuno,desempenioHora.atendidos.veintidos+desempenioHora.facebook.veintidos,desempenioHora.atendidos.veintitres+desempenioHora.facebook.veintitres]),$scope.graficaDesempenioHora={loading:!0,options:{chart:{events:{redraw:function(){$scope.graficaDesempenioHora.loading=!1}}},exporting:{width:1e3,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="crecimiento",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},credits:{enabled:!1},xAxis:{title:{text:"Horas"},categories:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"]},yAxis:{min:0,allowDecimals:!1,title:{text:"Casos"},plotLines:[{value:0,width:1,color:"#808080"}]},series:[{color:"#0DBEC8",name:"Total de Casos ("+desempenioHora.totalTodos+")",data:[desempenioHora.todos.cero,desempenioHora.todos.una,desempenioHora.todos.dos,desempenioHora.todos.tres,desempenioHora.todos.cuatro,desempenioHora.todos.cinco,desempenioHora.todos.seis,desempenioHora.todos.siete,desempenioHora.todos.ocho,desempenioHora.todos.nueve,desempenioHora.todos.diez,desempenioHora.todos.once,desempenioHora.todos.doce,desempenioHora.todos.trece,desempenioHora.todos.catorce,desempenioHora.todos.quince,desempenioHora.todos.dieciseis,desempenioHora.todos.diecisiete,desempenioHora.todos.dieciocho,desempenioHora.todos.diecinueve,desempenioHora.todos.veinte,desempenioHora.todos.veintiuno,desempenioHora.todos.veintidos,desempenioHora.todos.veintitres]},{color:"#32d285",name:"Atendidos ("+desempenioHora.totalAtendidos+")",y:1500,data:arregloAT},{color:"#95A4C2",name:"Descartados ("+desempenioHora.totalDescartados+")",data:[desempenioHora.descartados.cero,desempenioHora.descartados.una,desempenioHora.descartados.dos,desempenioHora.descartados.tres,desempenioHora.descartados.cuatro,desempenioHora.descartados.cinco,desempenioHora.descartados.seis,desempenioHora.descartados.siete,desempenioHora.descartados.ocho,desempenioHora.descartados.nueve,desempenioHora.descartados.diez,desempenioHora.descartados.once,desempenioHora.descartados.doce,desempenioHora.descartados.trece,desempenioHora.descartados.catorce,desempenioHora.descartados.quince,desempenioHora.descartados.dieciseis,desempenioHora.descartados.diecisiete,desempenioHora.descartados.dieciocho,desempenioHora.descartados.diecinueve,desempenioHora.descartados.veinte,desempenioHora.descartados.veintiuno,desempenioHora.descartados.veintidos,desempenioHora.descartados.veintitres]},{color:"#E3684D",name:"Sin Atender ("+desempenioHora.totalNuevos+")",data:[desempenioHora.nuevos.cero,desempenioHora.nuevos.una,desempenioHora.nuevos.dos,desempenioHora.nuevos.tres,desempenioHora.nuevos.cuatro,desempenioHora.nuevos.cinco,desempenioHora.nuevos.seis,desempenioHora.nuevos.siete,desempenioHora.nuevos.ocho,desempenioHora.nuevos.nueve,desempenioHora.nuevos.diez,desempenioHora.nuevos.once,desempenioHora.nuevos.doce,desempenioHora.nuevos.trece,desempenioHora.nuevos.catorce,desempenioHora.nuevos.quince,desempenioHora.nuevos.dieciseis,desempenioHora.nuevos.diecisiete,desempenioHora.nuevos.dieciocho,desempenioHora.nuevos.diecinueve,desempenioHora.nuevos.veinte,desempenioHora.nuevos.veintiuno,desempenioHora.nuevos.veintidos,desempenioHora.nuevos.veintitres]}],title:{text:" "}}})},$scope.graficaCrecimiento={loading:!0,options:{chart:{events:{redraw:function(){$scope.graficaCrecimiento.loading=!1}}},rangeSelector:{enabled:!0,selected:4,inputEnabled:!1,buttonTheme:{visibility:"hidden"},labelStyle:{visibility:"hidden"}},navigator:{enabled:!1},exporting:{width:1e3,buttons:{contextButton:{menuItems:[{textKey:"downloadPNG",text:"Exportar a PNG",onclick:function(){var nombreCorto="crecimiento",nombreMeses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fecha1=new Date($scope.dt),fecha2=new Date($scope.dt2),fechaFinal=fecha1.getDate()+"_"+nombreMeses[fecha1.getMonth()+1]+"_"+fecha1.getFullYear()+"__"+fecha2.getDate()+"_"+nombreMeses[fecha2.getMonth()+1]+"_"+fecha2.getFullYear();this.exportChart({filename:$scope.account+"_"+nombreCorto+"_"+fechaFinal},{title:{}})}}]}}}},series:[],title:{text:" "},useHighStocks:!0},$scope.graficaCrecimiento.series.push({id:1,name:"Facebook",color:"#45619D",data:[[11476512e5,23.15],[11477376e5,23.01],[1147824e6,22.73],[11479104e5,22.83],[11479968e5,22.56],[1148256e6,22.88],[11483424e5,22.79],[11484288e5,23.5],[11485152e5,23.74],[11486016e5,23.72],[11489472e5,23.15],[11490336e5,22.65]]},{id:2,name:"Twitter",color:"#88C9F9",data:[[11476512e5,25.15],[11477376e5,25.01],[1147824e6,25.73],[11479104e5,25.83],[11479968e5,25.56],[1148256e6,25.88],[11483424e5,25.79],[11484288e5,25.5],[11485152e5,26.74],[11486016e5,26.72],[11489472e5,26.15],[11490336e5,26.65]]}),$scope.getDashboard=function(){setInterval(function(){$http.post("/getDashboard",{}).success(function(respuesta){$scope.total_clientes=respuesta.length,$scope.dashboards=respuesta}).error(function(err){console.log("Error !!!"),console.log(err)})},1e3),$http.post("/getDashboard",{}).success(function(respuesta){$scope.total_clientes=respuesta.length,$scope.dashboards=respuesta;var elemento=angular.element(document.querySelector("#isotope-container")),elemento2=angular.element(document.querySelector("#isotope-container2"));angular.element(document).ready(function(){$(elemento).isotope({itemSelector:".elemento-cuenta",layoutMode:"fitRows"}),$(elemento2).isotope({itemSelector:".elemento-cuenta2",layoutMode:"fitRows"})})}).error(function(err){console.log("Error !!!"),console.log(err)})},$scope.descargaArchivo=function(nombreSistema,opcion){void 0===nombreSistema&&(nombreSistema=Authentication.user.cuenta.marca),void 0===opcion&&(opcion="general");var obj={nombreSistema:nombreSistema,fecha_inicial:$scope.dt,fecha_final:$scope.dt2};$http({method:"POST",url:"/generaCsv",data:obj,timeout:9e4}).then(function(items){console.log("Llamando a the !!!!"),console.log(items);var items=items.data,data=new Array;data.push(["Fecha de Entrada","Fecha de Respuesta","Tiempo de Respuesta","Status","Razón de Descartado","Nombre de Usuario","Fuente","Clase","Mensaje","Tema","Subtema","Sentimiento","Respuesta"]);for(var i in items)data.push([items[i].fecha_llegada,items[i].fecha_respuesta,items[i].tiempo_respuesta,items[i].status,items[i].razon_desacartado,items[i].nombre_post,items[i].obj,items[i].tipo,items[i].mensaje,items[i].tema,items[i].subtema,items[i].sentiment,items[i].respuesta]);var dataString,csvContent="";data.forEach(function(infoArray,index){dataString=infoArray.join(","),csvContent+=index<data.length?dataString+"\n":dataString});var csvData;encodeURI(csvContent);csvData=new Blob([csvContent],{type:"text/csv"});var csvUrl=URL.createObjectURL(csvData),link=document.createElement("a");link.setAttribute("href",csvUrl);var fecha_string_inicial=new Date($scope.dt).toDateString().replace(/ /g,""),fecha_string_final=new Date($scope.dt2).toDateString().replace(/ /g,"");link.setAttribute("download",obj.nombreSistema+"_"+fecha_string_inicial+"_to_"+fecha_string_final+".csv"),link.click()})},$scope.descargaDescartados=function(nombreSistema,fecha_inicial,fecha_final,tipo){void 0===nombreSistema&&(nombreSistema=Authentication.user.cuenta.marca),$http.post("/getDescartados",{nombreSistema:nombreSistema,fecha_inicial:fecha_inicial,fecha_final:fecha_final,tipo:tipo}).success(function(descartados){if("error"!==descartados){var data=[],mensaje="";data.push(["Mensaje","Fecha Entrada","Fecha Descarte","Usuario","Red","Tipo","Motivo Descarte","Descartó"]);for(var i in descartados)descartados[i].mensaje&&(mensaje=descartados[i].mensaje.replace(/,/g,"-"),data.push([mensaje,descartados[i].fechaEntrada,descartados[i].fechaDescarte,descartados[i].usuario,descartados[i].red,descartados[i].tipo,descartados[i].motivoDescarte,descartados[i].usuarioDescarte]));var dataString,csvContent="";data.forEach(function(infoArray,index){dataString=infoArray.join(","),csvContent+=index<data.length?dataString+"\n":dataString});var csvData;encodeURI(csvContent);csvData=new Blob([csvContent],{type:"text/csv"});var csvUrl=URL.createObjectURL(csvData),link=document.createElement("a");link.setAttribute("href",csvUrl);var fecha_string_inicial=new Date($scope.dt).toDateString().replace(/ /g,""),fecha_string_final=new Date($scope.dt2).toDateString().replace(/ /g,"");link.setAttribute("download",nombreSistema+"_descartados_"+fecha_string_inicial+"_to_"+fecha_string_final+".csv"),link.click()}}).error(function(err){console.log("Error !!!"),console.log(err)})},$scope.descargaTemas=function(nombreSistema,temas,totalTemas){void 0===nombreSistema&&(nombreSistema=Authentication.user.cuenta.marca);var data=[];data.push(["Tema","Porcentaje","Total"]);for(var i in temas)data.push([temas[i].name,(temas[i].y/totalTemas*100).toFixed(2)+"%",temas[i].y]);var dataString,csvContent="";data.forEach(function(infoArray,index){dataString=infoArray.join(","),csvContent+=index<data.length?dataString+"\n":dataString});var csvData;encodeURI(csvContent);csvData=new Blob([csvContent],{type:"text/csv"});var csvUrl=URL.createObjectURL(csvData),link=document.createElement("a");link.setAttribute("href",csvUrl);var fecha_string_inicial=new Date($scope.dt).toDateString().replace(/ /g,""),fecha_string_final=new Date($scope.dt2).toDateString().replace(/ /g,"");link.setAttribute("download",nombreSistema+"_temas_"+fecha_string_inicial+"_to_"+fecha_string_final+".csv"),link.click()},$scope.descargaSubtemas=function(nombreSistema,subtemas,totalSubtemas){void 0===nombreSistema&&(nombreSistema=Authentication.user.cuenta.marca),console.log("Los subtemas"),console.log(subtemas);var data=[];data.push(["Subtema","Porcentaje","Total"]);for(var i in subtemas)data.push([subtemas[i].name,(subtemas[i].y/totalSubtemas*100).toFixed(2)+"%",subtemas[i].y]);var dataString,csvContent="";data.forEach(function(infoArray,index){dataString=infoArray.join(","),csvContent+=index<data.length?dataString+"\n":dataString});var csvData;encodeURI(csvContent);csvData=new Blob([csvContent],{type:"text/csv"});var csvUrl=URL.createObjectURL(csvData),link=document.createElement("a");link.setAttribute("href",csvUrl);var fecha_string_inicial=new Date($scope.dt).toDateString().replace(/ /g,""),fecha_string_final=new Date($scope.dt2).toDateString().replace(/ /g,"");link.setAttribute("download",nombreSistema+"_subtemas_"+fecha_string_inicial+"_to_"+fecha_string_final+".csv"),link.click()},$scope.today=function(){var hoy=(new Date).getDate(),timestamp=(new Date).setDate(hoy-15),start_date=new Date(timestamp);start_date.setHours(0),start_date.setMinutes(0),start_date.setSeconds(0),$scope.dt=start_date,$scope.dt2=new Date},$scope.today(),$scope.clear=function(){$scope.dt=null},$scope.toggleMin=function(){$scope.minDate=-10},$scope.toggleMin(),$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0,$scope.opened2=!1},$scope.open2=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened2=!0,$scope.opened=!1},$scope.dateOptions={startingDay:1,showWeeks:!1},$scope.formats=["dd / MMMM / yyyy"],$scope.format=$scope.formats[0],$scope.maxDate=Date.now(),$scope.obtienePublicacionesFacebook=function(nombreSistema){$scope.nombre_cuenta="",$scope.nombre_cuentaFB=nombreSistema,$scope.nombre_cuentaTW="",$scope.nombre_cuentaTW_uno="",$scope.creaArchivo(nombreSistema,"facebook"),$http.post("/get5PublicacionesFB",{nombreSistema:nombreSistema}).success(function(resp){$scope.publicacionesCuenta=resp}).error(function(err){console.log("Error !!!"),console.log(err)})},$scope.obtienePublicacionesTwitter=function(nombreSistema,opcionTW){0===opcionTW?($scope.nombre_cuentaTW=nombreSistema,$scope.nombre_cuentaTW_uno=""):1===opcionTW&&($scope.nombre_cuentaTW="",$scope.nombre_cuentaTW_uno=nombreSistema),$scope.nombre_cuenta="",$scope.nombre_cuentaFB="",$scope.creaArchivo(nombreSistema,"twitter"),$http.post("/get5PublicacionesTW",{nombreSistema:nombreSistema}).success(function(resp){$scope.publicacionesCuenta=resp}).error(function(err){console.log("Error !!!"),console.log(err)})},$scope.mostrarPublications=!1,$scope.mostrarMetrics=!0,$scope.activoPublications="active",$scope.activoMetricas="",$scope.mostrarSeccion=function(mostrar){"metricas"===mostrar&&($scope.mostrarPublications=!1,$scope.mostrarMetrics=!0,$scope.activoPublications="",$scope.activoMetricas="active"),"publicaciones"===mostrar&&($scope.mostrarPublications=!0,$scope.mostrarMetrics=!1,$scope.activoPublications="active",$scope.activoMetricas="")},$scope.imagen_error="/modules/core/img/usuario-sem-imagem.png",$scope.authentication=Authentication,$scope.pag=2,$scope.pageData="",$scope.getSingleTweet=function(tweet){this.open()},$scope.user=Authentication,$scope.clickTitulo=function(account){console.log("Account"),console.log(account),$scope.mostrarDesempenoEquipo=!0,$scope.mostrarTotalCasos=!0,$scope.mostrarPromedioCasos=!0,"undefined"!=typeof $scope.chartDesempenio.loading&&($scope.chartDesempenio.loading=!0),"undefined"!=typeof $scope.chartDona.loading&&($scope.chartDona.loading=!0),"undefined"!=typeof $scope.chartPromedioCasos.loading&&($scope.chartPromedioCasos.loading=!0),"undefined"!=typeof $scope.chartTemas.loading&&($scope.chartTemas.loading=!0),"undefined"!=typeof $scope.chartSubTemas.loading&&($scope.chartSubTemas.loading=!0),"undefined"!=typeof $scope.config.loading&&($scope.config.loading=!0),"undefined"!=typeof $scope.chartNivelServicio.loading&&($scope.chartNivelServicio.loading=!0),$scope.imagen_cuenta=account.imagen_src,$scope.nombre_cuenta=account.nombreSistema,$scope.nombre_cuentaFB="",$scope.nombre_cuentaTW="",$scope.nombre_cuentaTW_uno="",$scope.twitter_cuenta=account.datosTwitter.twitter_screenname_principal,$scope.creaArchivo(account.nombreSistema),$scope.mostrarNubeTerminos=!1,$scope.id_facebook_cuenta=account.datosPage.id,$scope.graficaTags("create",account.nombreSistema,$scope.dt,$scope.dt2),$scope.account=account.nombreSistema},$scope.create=function(){$scope.conectaPostPagina();var infoPagina=$scope.pageSelect;if(infoPagina.id){var urlPost="https://graph.facebook.com"+$scope.constant.fbapiversion+infoPagina.id+"/subscribed_apps?access_token="+infoPagina.access_token;infoPagina.access_token;$http.post(urlPost).success(function(response){console.log(response)})}var account=new Accounts({marca:this.marca,nombreSistema:this.nombreSistema,correo:this.correo,twitter_consumer_key:this.twitter_consumer_key,twitter_consumer_secret:this.twitter_consumer_secret,twitter_access_token:this.twitter_access_token,twitter_access_token_secret:this.twitter_access_token_secret,twitter_screenname_principal:this.twitter_screenname_principal,twitter_id_principal:this.twitter_id_principal,twitter_screenname_respuesta:this.twitter_screenname_respuesta,twitter_id_respuesta:this.twitter_id_respuesta,terminos:this.terminos,datosPage:$scope.pageSelect});account.$save(function(response){$location.path("accounts/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(account){if(account){account.$remove();for(var i in $scope.accounts)$scope.accounts[i]===account&&$scope.accounts.splice(i,1)}else $scope.account.$remove(function(){$location.path("accounts")})},$scope.getInbox=function(){var id=Authentication.user.cuenta._id;$http.post("/getInbox",{data:id}).success(function(resp){$scope.inbox=resp.data}).error(function(err){console.log("Error !!!"),console.log(err)})},$scope.removefromlist=function(accountid){$scope.account=Accounts.get({accountId:accountid});var account=$scope.account;if(account){account.$remove();for(var i in $scope.accounts)$scope.accounts[i]===account&&$scope.accounts.splice(i,1)}else $scope.account.$remove(function(){$location.path("accounts")})},$scope.conectarPagina=function(accessToken){var url="https://graph.facebook.com/me/accounts?access_token="+accessToken;$http.get(url).success(function(informacion){var fbData=[];fbData.push(informacion.data),$scope.datos=fbData[0]})},$scope.update=function(){var account=new Accounts($scope.account);account.hasOwnProperty("datosPage");if("undefined"!=typeof $scope.pageSelect)$scope.conectaPostPagina(),account.datosPage=$scope.pageSelect;else{var revisaPaginas=account.datosPage.hasOwnProperty("id");revisaPaginas===!0&&(account.datosPage.id="-1")}account.$update(function(){$location.path("accounts/"+account._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.getTw=function(){var id=$scope.authentication.user.cuenta._id,service_tw=$resource("/cuentas/get/:cuentaId",{cuentaId:"@id"});service_tw.get({cuentaId:id},function(data){$scope.twits=data})},$scope.subtemasPagina=[],$scope.temaEscogido="",$scope.subtemaEscogido="",$scope.resTemas="",$scope.resSubtemas="",$scope.MuestraTemas="",$scope.getTemas=function(){$http.post("/getTemasPantalla/:cuenta",{cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){$scope.temasActuales=data})},$scope.obtenerSubtemas=function(temaAhora){$scope.obtieneResTemas(temaAhora),$scope.temaEscogido=temaAhora;var temaSeleccionado=temaAhora;for(var i in $scope.temasActuales)if($scope.temasActuales[i].tema===temaSeleccionado){var subtemasPagina=[];for(var j in $scope.temasActuales[i].subtemas)subtemasPagina[j]={nombre:$scope.temasActuales[i].subtemas[j].subtema};$scope.subtemasPagina=subtemasPagina}},$scope.obtieneResTemas=function(tema){$http.post("/getResTemas/",{temaActual:tema,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){$scope.resTemas=data,$scope.MuestraTemas=data,$scope.subtemaEscogido=""})},$scope.abreRespuesta=function(tweet){$scope.tweet=[tweet];$modal.open({templateUrl:"myModalContent.html",controller:"AccountsController",size:150})},$scope.addRespuesta=function(){console.log($scope.temaEscogido),console.log($scope.subtemaEscogido)},$scope.obtieneResSubtemas=function(otraVariable){$scope.subtemaEscogido="",$scope.subtemaEscogido=otraVariable,$http.post("/getResSubtemas",{temaActual:$scope.temaEscogido,subtemaActual:otraVariable,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){0===data.length?$scope.MuestraTemas=$scope.resTemas:$scope.MuestraTemas=data})},$scope.getFb=function(){var id=$scope.authentication.user.cuenta._id,service=$resource("/getFb/:idCuenta",{idCuenta:"@id"});service.get({idCuenta:id},function(data){$scope.posts=data})},$scope.find=function(cuenta){$scope.accounts=Accounts.query(),$scope.accounts.$promise.then(function(data){var arr=[];for(var i in $scope.accounts)arr[i]=$scope.accounts[i],""===arr[i].datosTwitter?arr[i].twitter="-1":arr[i].datosTwitter&&arr[i].datosTwitter.twitter_screenname_respuesta&&(arr[i].twitter_respuesta="-1"),""===arr[i].datosPage&&(arr[i].facebook="-1");var byName=arr.slice(0);byName.sort(function(a,b){var x=a.nombreSistema.toLowerCase(),y=b.nombreSistema.toLowerCase();return y>x?-1:x>y?1:0}),$scope.accounts=byName,cuenta?($scope.imagen_cuenta=cuenta.imagen_src,$scope.nombre_cuenta=cuenta.nombreSistema,$scope.creaArchivo(cuenta.nombreSistema),$scope.account=cuenta.nombreSistema,$scope.graficaTags("create",cuenta.nombreSistema,$scope.dt,$scope.dt2),cuenta.datosTwitter&&($scope.twitter_cuenta=cuenta.datosTwitter.twitter_screenname_principal)):($scope.imagen_cuenta=$scope.accounts[0].imagen_src,$scope.nombre_cuenta=$scope.accounts[0].nombreSistema,$scope.twitter_cuenta=$scope.accounts[0].datosTwitter.twitter_screenname_principal,$scope.creaArchivo($scope.accounts[0].nombreSistema),$scope.account=$scope.accounts[0].nombreSistema,$scope.graficaTags("create",$scope.accounts[0].nombreSistema,$scope.dt,$scope.dt2),$scope.accounts[0].datosTwitter&&($scope.twitter_cuenta=$scope.accounts[0].datosTwitter.twitter_screenname_principal))})},$scope.findOne=function(){$scope.account=Accounts.get({accountId:$stateParams.accountId})},$scope.$on("actualizaAccounts",function(event,message){$scope.find()}),$scope.$on("creaCuenta",function(event,message){$scope.find(message[0])}),$scope.$on("creoCuentaFacebook",function(event,message){$scope.find(message)}),$scope.item=[],$scope.counter=0,$scope.prueba=function(){for(var i=1;50>i;)$scope.item.push(++$scope.counter),i++},$scope.prueba(),$scope.graficaTags=function(action,nombreSistema,fecha1,fecha2){var palabras=[],fecha_inicio=fecha1,fecha_fin=fecha2,nombreColeccion=nombreSistema+"_consolidada",NumeroMaximoElementosMostrar=10;if("undefined"!=typeof nombreColeccion){var cadenaSolicitud="/getStringTagCloud?cuenta="+nombreColeccion+"&fecha1="+fecha_inicio+"&fecha2="+fecha_fin+"&id_facebook="+$scope.id_facebook_cuenta;$http.get(cadenaSolicitud).success(function(data){var datosRemotos=data,elemento=angular.element(document.querySelector("#tagcloud")),keywords=datosRemotos[0].terminos.splice(0,NumeroMaximoElementosMostrar),hashtags=datosRemotos[1].hashtags.splice(0,NumeroMaximoElementosMostrar),mentions=datosRemotos[2].menciones.splice(0,NumeroMaximoElementosMostrar);palabras=hashtags.concat(mentions,keywords);new Array;"create"==action&&($scope.palabras=hashtags.concat(mentions,keywords),$(elemento).jQCloud($scope.palabras,{autoResize:!0,height:350,shape:"circle"}),$scope.mostrarNubeTerminos=!0,$(elemento).jQCloud("update",$scope.palabras)),"update"==action&&(palabras=hashtags.concat(mentions,keywords),$(elemento).html("").jQCloud("update",$scope.palabras)),$scope.palabras.length>0?$scope.mostrarNubeTerminos=!0:($(elemento).html(""),$scope.mostrarNubeTerminos=!1)}).error(function(){var elemento=angular.element(document.querySelector("#tagcloud"));console.log("error nube de terminos"),$(elemento).html(""),$scope.mostrarNubeTerminos=!1})}else console.log("no hay cuenta")}}]).controller("ModalAccountCtrl",["$scope","$modal","$location","$log","$resource","Authentication",function($scope,$modal,$location,$log,$resource,Authentication){$scope.open=function(id){var modalInstance=$modal.open({templateUrl:"createAccountContent.html",controller:"ModalAccountInstanceCtrl",size:200,resolve:{id_cuenta:function(){return id}}});modalInstance.result.then(function(selectedItem){$scope.$emit("creaCuenta",selectedItem),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}},$scope.eliminaMonitoreo=function(id){var modalInstance=$modal.open({templateUrl:"desconectaMonitoreo.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return id}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaAccounts","Hola"),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.eliminaCuentaGeneral=function(id){var modalInstance=$modal.open({templateUrl:"eliminaCuenta.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return id}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaAccounts","Hola"),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.conectaFacebook=function(id){if(Authentication.user.additionalProvidersData){var modalInstance=$modal.open({templateUrl:"conectaFacebook.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return id}}});modalInstance.result.then(function(respuesta){respuesta&&$scope.$emit("creoCuentaFacebook",respuesta)},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}}else{var acepta=confirm("No tienes sesion activa en Facebook deseas iniciar sesion?");acepta&&(document.location=$scope.constant.host+"/auth/facebook")}},$scope.desconectaCuentaFacebook=function(id){var modalInstance=$modal.open({templateUrl:"desconectaCuentaContent.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return id.desconecta="Facebook",id}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaAccounts","Hola"),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}},$scope.desconectaCuentaTwitter=function(id){var modalInstance=$modal.open({templateUrl:"desconectaCuentaContent.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return id.desconecta="Twitter",id}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaAccounts","Hola"),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}},$scope.conectaTwitter=function(id){var modalInstance=$modal.open({templateUrl:"conectTwitterContent.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return id.desconecta="Twitter",id}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaAccounts","Hola"),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}},$scope.addTrackers=function(informacionCuenta){var modalInstance=$modal.open({templateUrl:"trackers.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return informacionCuenta}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaAccounts","Hola"),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.deleteTrackers=function(informacionCuenta){var modalInstance=$modal.open({templateUrl:"deleteTrackers.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return informacionCuenta}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaAccounts","Hola"),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.eliminaListeningTwitter=function(id){var modalInstance=$modal.open({templateUrl:"eliminaRespTwitterContent.html",controller:"ModalAccountInstanceCtrl",size:150,resolve:{id_cuenta:function(){return id}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}}}]).controller("ModalAccountInstanceCtrl",["$scope","$modalInstance","id_cuenta","$resource","$http","Accounts","Authentication",function($scope,$modalInstance,id_cuenta,$resource,$http,Accounts,Authentication){if($scope.paginaActual=id_cuenta,$scope.authentication=Authentication,id_cuenta&&id_cuenta.datosTwitter&&"-1"!==id_cuenta.datosTwitter.twitter_access_token&&($scope.twitter_consumer_secret=id_cuenta.datosTwitter.twitter_consumer_secret,$scope.twitter_consumer_key=id_cuenta.datosTwitter.twitter_consumer_key,$scope.twitter_access_token=id_cuenta.datosTwitter.twitter_access_token,$scope.twitter_access_token_secret=id_cuenta.datosTwitter.twitter_access_token_secret,$scope.twitter_screenname_principal=id_cuenta.datosTwitter.twitter_screenname_principal,$scope.twitter_screenname_respuesta=id_cuenta.datosTwitter.twitter_screenname_respuesta,$scope.twitter_id_respuesta=id_cuenta.datosTwitter.twitter_id_respuesta,$scope.twitter_id_principal=id_cuenta.datosTwitter.twitter_id_principal),$scope.muestraForm=!0,$scope.muestraAyuda=!1,id_cuenta&&(id_cuenta.datosPage?$scope.selected_page=id_cuenta.datosPage.id:$scope.selected_page=!1),Authentication.user.additionalProvidersData){var url="https://graph.facebook.com/me/accounts?access_token="+Authentication.user.additionalProvidersData.facebook.accessToken;$http.get(url).success(function(informacion){var fbData=[];fbData.push(informacion.data),$scope.paginas=fbData})}$scope.borraCuentaGeneral=function(){$scope.paginaActual?$http.post("/eliminaCuenta",{nombreSistema:$scope.paginaActual.nombreSistema}).success(function(respuestaCuenta){var respuesta=respuestaCuenta.replace(/"/gi,"");"ok"===respuesta&&($scope.desvinculaCuenta($scope.paginaActual),$modalInstance.close())}):alert("Error en cuenta")},$scope.desvinculaMonitoreo=function(){$http.post("/eliminaMonitoreo",{_id:id_cuenta._id}).success(function(data){$modalInstance.close(data)})},$scope.eliminaListeningTwitter=function(item){$http.post("/eliminaListening",item).success(function(data){$modalInstance.close(item)})},$scope.selectPage=function(data){$scope.carga_pagina_facebook=data,$scope.selected_page=data.id},$scope.showHelp=function(){$scope.muestraForm=!1,$scope.muestraAyuda=!0},$scope.showFormulario=function(){$scope.muestraForm=!0,$scope.muestraAyuda=!1},$scope.desvinculaCuenta=function(item){if("Facebook"===item.desconecta){var idCuenta=item._id,idPage=item.datosPage.id,tokenPage=item.datosPage.access_token;$http.post("/deleteFBAccount",{idPage:idPage,tokenPage:tokenPage,idCuenta:idCuenta}).success(function(data){$modalInstance.close()}).error(function(error_cuenta_face){console.log("Error !!!!"),console.log(error_cuenta_face)})}else $http.post("/desconectaTwitter",item).success(function(data){$modalInstance.close()}).error(function(error_cuenta_face){console.log("Error !!!!"),console.log(error_cuenta_face)})},$scope.conectaPaginaFacebook=function(){if($scope.monitoreo)$http.post("/agregaMonitoreo",{_id:id_cuenta._id,monitoreo:$scope.monitoreo,nombreCuenta:id_cuenta.nombreSistema,usuario:$scope.authentication.user.additionalProvidersData}).success(function(data){1===data?$scope.mensajeMonitoreo="No se ha encontrado la cuenta en facebook":2===data&&$modalInstance.close(data)});else if(id_cuenta.datosPage)$scope.desconectaCuenta();else{var idCuentaSelect=$scope.carga_pagina_facebook.id,accessTokenSelect=$scope.carga_pagina_facebook.access_token;$http.post("/connectFBAccount",{idCuenta:idCuentaSelect,accessToken:accessTokenSelect,datosPage:$scope.carga_pagina_facebook,_id:id_cuenta._id}).success(function(data){var respuestaFinal=data.replace(/"/gi,"");"ok"===respuestaFinal&&$modalInstance.close($scope.paginaActual)}).error(function(err){console.log("Error en Conectar Pagina"),console.log(err)})}},$scope.guardaPaginaselecccion=function(informacionPagina){console.log("Guardando pagina Facebook");var appDefault="689164264519175",conectado=0,information=informacionPagina,url="http://graph.facebook.com"+$scope.constant.fbapiversion+information.id+"/subscribed_apps?access_token="+information.access_token;$http.get(url).success(function(respuesta){if(respuesta.data)for(var i=0;i<respuesta.data.length;i++)respuesta.data[i].id===appDefault&&conectado++;conectado>0?console.log("La cuenta esta conectada"):console.log("La cuenta no esta conectada");
}).error(function(err){console.log("EL ERROR"),console.log(err)}),$scope.pageSelect=information},$scope.conectaPostPagina=function(){var infoPagina=$scope.pageSelect;if("undefined"!=typeof infoPagina){var urlPost="https://graph.facebook.com"+$scope.constant.fbapiversion+infoPagina.id+"/subscribed_apps?access_token="+infoPagina.access_token;infoPagina.access_token;$http.post(urlPost).success(function(response){console.log(response)})}else console.log("No administra ninguna pagina")},$scope.desconectaCuenta=function(){var idCuenta=($scope.carga_pagina_facebook.id,$scope.carga_pagina_facebook.access_token,id_cuenta._id),idPage=id_cuenta.datosPage.id,tokenPage=id_cuenta.datosPage.access_token;$http.post("/deleteFBAccount",{idPage:idPage,tokenPage:tokenPage,idCuenta:idCuenta}).success(function(data){if("1"===data){var idCuentaSelect=$scope.carga_pagina_facebook.id,accessTokenSelect=$scope.carga_pagina_facebook.access_token;$http.post("/connectFBAccount",{idCuenta:idCuentaSelect,accessToken:accessTokenSelect,datosPage:$scope.carga_pagina_facebook,_id:id_cuenta._id}).success(function(data){$modalInstance.close(data)}).error(function(err){console.log("error !!!"),console.log(err)})}})},$scope.ok=function(req){$modalInstance.close($scope.selected.item)},$scope.submitTwitter=function(){var account=new Accounts({id:id_cuenta._id,twitter_consumer_key:$scope.twitter_consumer_key,twitter_consumer_secret:$scope.twitter_consumer_secret,twitter_access_token:$scope.twitter_access_token,twitter_access_token_secret:$scope.twitter_access_token_secret,twitter_screenname_principal:$scope.twitter_screenname_principal,twitter_screenname_respuesta:$scope.twitter_screenname_respuesta});$http.post("/getDataTwitter",account).success(function(response){switch(console.log(response),response){case 1:$scope.response_twitter_submit="Sorry, We don´t found the listening account";break;case 0:$scope.response_twitter_submit="Sorry, We don´t found the responding account";break;case 2:$scope.response_twitter_submit="Sorry, Invalid or expired token";break;default:$modalInstance.close(id_cuenta)}})},$scope.saveTrackers=function(){for(var trackerSinEspacios=$scope.listadoTrackers.replace(/ /g,""),nombreTrackers=$scope.trackerName,separaTrackers=trackerSinEspacios.split(","),arregloTrackers=[],i=0;i<separaTrackers.length;i++)arregloTrackers.push(separaTrackers[i]);var trackers={nombreTrackers:nombreTrackers,trackers:arregloTrackers};$http.post("/insertTrackers",{infoCuenta:$scope.paginaActual,nombreTrackers:nombreTrackers,objetoTrackers:trackers}).success(function(response){1===response?$modalInstance.close($scope.paginaActual._id):$scope.responseTrackers="Hubo un error al agregar los trackers, intente de nuevo"})},$scope.eliminaTrackers=function(){$http.post("/eliminaTrackers",{infoCuenta:$scope.paginaActual}).success(function(response){"ok"===response?$modalInstance.close($scope.paginaActual._id):$scope.responseTrackers="Hubo un error al eliminar los trackers, intente de nuevo"})},$scope.fileChanged=function(element){$scope.files=element.files,$scope.apply()},$scope.submit=function(req,res){var fd=new FormData;if("undefined"==typeof $scope.file_imagen)$scope.errorNuevaCuenta="Es Obligatorio Subir un Logo";else{var f=$scope.file_imagen;fd.append("file",f),fd.append("nombre",$scope.nombre),fd.append("nombre_corto",$scope.nombre_corto),$http.post("/dataAccount",fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(response){var respuesta=response.replace(/"/gi,"");"ok"===respuesta&&$http.post("/informacionCuenta",{nombreSistema:$scope.nombre_corto}).success(function(infoCuenta){$modalInstance.close(infoCuenta)}).error(function(err){console.log("error !!!"),console.log(err)})})}},$scope.evaluaActivo=function(id){return id===$scope.selected_page?!0:!1},$scope.cambiaImagen=function(){var f=document.getElementById("file").files[0];$scope.file_imagen=f;var r=new FileReader;r.onloadend=function(e){var data=e.target.result;$scope.image=data;var fileDisplayArea=document.getElementById("fileDisplayArea");fileDisplayArea.innerHTML="";var img=new Image;img.src=r.result;var aux=r.result,image=aux.replace("data:image/jpeg;base64,","");image=image.replace(" ","+");var muestraImagen="<div class='perfil-circular' style='width:120px; height:120px;background-image: url("+img.src+");' align='center'></div>";$(fileDisplayArea).append(muestraImagen)},r.readAsDataURL(f)},$scope.cancel=function(){console.log($scope.archivo),$modalInstance.dismiss("cancel")}}]).directive("scroll",["$window",function($window){return{restrict:"A",link:function(scope,elem,attrs){var rawElement=elem[0];rawElement.bind("scroll",function(){console.log(rawElement.scrollTop),rawElement.scrollTop+rawElement.offsetHeight+5>=rawElement.scrollHeight&&scope.$apply("prueba()")})}}}]).directive("datepickerPopup",["dateFilter","datepickerPopupConfig",function(dateFilter,datepickerPopupConfig){return{restrict:"A",priority:1,require:"ngModel",link:function(scope,element,attr,ngModel){var dateFormat=attr.datepickerPopup||datepickerPopupConfig.datepickerPopup;ngModel.$formatters.push(function(value){return dateFilter(value,dateFormat)})}}}]).controller("MapController",["$scope","$http","$stateParams","$location","Authentication",function($scope,$http,$stateParams,$location,Authentication){}]),angular.module("accounts").factory("Accounts",["$resource",function($resource){return $resource("accounts/:accountId",{accountId:"@_id"},{update:{method:"PUT"}})}]),angular.module("articles").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Articles","articles","dropdown","/articles(/create)?"),Menus.addSubMenuItem("topbar","articles","List Articles","articles"),Menus.addSubMenuItem("topbar","articles","New Article","articles/create")}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("listArticles",{url:"/articles",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("createArticle",{url:"/articles/create",templateUrl:"modules/articles/views/create-article.client.view.html"}).state("viewArticle",{url:"/articles/:articleId",templateUrl:"modules/articles/views/view-article.client.view.html"}).state("editArticle",{url:"/articles/:articleId/edit",templateUrl:"modules/articles/views/edit-article.client.view.html"})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Articles",function($scope,$stateParams,$location,Authentication,Articles){$scope.authentication=Authentication,$scope.create=function(){var article=new Articles({title:this.title,content:this.content});article.$save(function(response){$location.path("articles/"+response._id),$scope.title="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(function(){$location.path("articles")})},$scope.update=function(){var article=$scope.article;article.$update(function(){$location.path("articles/"+article._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.articles=Articles.query()},$scope.findOne=function(){$scope.article=Articles.get({articleId:$stateParams.articleId})}}]),angular.module("articles").factory("Articles",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("charts").config(["$stateProvider",function($stateProvider){$stateProvider.state("listCharts",{url:"/charts",templateUrl:"modules/charts/views/list-charts.client.view.html"}).state("createChart",{url:"/charts/create",templateUrl:"modules/charts/views/create-chart.client.view.html"}).state("viewChart",{url:"/charts/:chartId",templateUrl:"modules/charts/views/view-chart.client.view.html"}).state("editChart",{url:"/charts/:chartId/edit",templateUrl:"modules/charts/views/edit-chart.client.view.html"})}]),angular.module("charts").controller("ChartsController",["$scope","$http","$stateParams","$location","Authentication","Charts",function($scope,$http,$stateParams,$location,Authentication,Charts){$scope.authentication=Authentication,$scope.graficaTags=function(action){var nombreColeccion=$scope.authentication.user.cuenta.marca+"_consolidada",NumeroMaximoElementosMostrar=10;console.log(nombreColeccion);$http.get("/getStringTagCloud?cuenta="+nombreColeccion).success(function(data){var datosRemotos=data;console.log(datosRemotos);var elemento=angular.element(document.querySelector("#tagcloud"));"create"==action&&($scope.check_hashtag=!0,$scope.check_mentions=!0,$scope.check_keywords=!0),$scope.check_hashtag?$scope.hashtags=datosRemotos[1].hashtags.splice(0,NumeroMaximoElementosMostrar):$scope.hashtags=[],$scope.check_mentions?$scope.mentions=datosRemotos[2].menciones.splice(0,NumeroMaximoElementosMostrar):$scope.mentions=[],$scope.check_keywords?$scope.keywords=datosRemotos[0].terminos.splice(0,NumeroMaximoElementosMostrar):$scope.keywords=[],$scope.palabras=[],"create"==action&&(console.log("create"),$scope.palabras=$scope.hashtags.concat($scope.mentions,$scope.keywords),$(elemento).jQCloud($scope.palabras,{width:500,height:350,shape:!0})),"update"==action&&(console.log("update"),$scope.palabras=$scope.hashtags.concat($scope.mentions,$scope.keywords),$(elemento).html(""),$(elemento).jQCloud($scope.palabras,{width:500,height:350,shape:!0}))})},$scope.chart1=function(){console.log("Ha entrado  Chart1"),console.log($scope.authentication.cuenta.marca),$http.post("/getChart1",{nombreSistema:$scope.authentication.cuenta.marca}).success(function(resp){console.log("Obteniendo Data para chart"),console.log(resp),$scope.publicacionesCuenta=resp}).error(function(err){console.log("Error !!!"),console.log(err)})},$scope.create=function(){var chart=new Charts({name:this.name});chart.$save(function(response){$location.path("charts/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(chart){if(chart){chart.$remove();for(var i in $scope.charts)$scope.charts[i]===chart&&$scope.charts.splice(i,1)}else $scope.chart.$remove(function(){$location.path("charts")})},$scope.update=function(){var chart=$scope.chart;chart.$update(function(){$location.path("charts/"+chart._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.charts=Charts.query()},$scope.findOne=function(){$scope.chart=Charts.get({chartId:$stateParams.chartId})}}]),angular.module("charts").factory("Charts",["$resource",function($resource){return $resource("charts/:chartId",{chartId:"@_id"},{update:{method:"PUT"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("login",{url:"/",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("home",{url:"/home",templateUrl:"modules/feeds/views/buzon.view.html"}).state("politicas",{url:"/politicas",templateUrl:"modules/core/views/politicas.html"}).state("terminos",{url:"/terminos",templateUrl:"modules/core/views/terminos.html"}).state("soporte",{url:"/soporte",templateUrl:"modules/core/views/soporte.html"})}]),angular.module("core").controller("HeaderController",["$scope","$location","Authentication","Menus",function($scope,Authentication,Menus,$location){console.log($scope),$scope.authentication=Authentication,$scope.tieneHeader=Authentication.user.hasOwnProperty("_id"),$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]).controller("MenuLateral",["$scope","Authentication","Menus","$http","$resource","$location",function($scope,Authentication,Menus,$http,$resource,$location){$scope.authentication=Authentication;var tieneSesion=$scope.authentication.user.hasOwnProperty("_id");tieneSesion===!1&&$location.path("/"),$scope.getClass=function(path){return"/home"===$location.path()?$scope.active_menu="active":$scope.active_menu="",$location.path().substr(0,path.length)===path?"active":""},$scope.obtieneDesempenioDiario=function(){}}]),angular.module("core").controller("HomeController",["$scope","Authentication","ui.bootstrap",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").controller("NotificationController",["$scope","$location","Authentication","Socket",function($scope,Authentication,$location,Socket){$scope.authentication=Authentication}]),angular.module("ngLocale",[],["$provide",function($provide){var PLURAL_CATEGORY={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};$provide.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],MONTH:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],SHORTDAY:["dom","lun","mar","mié","jue","vie","sáb"],SHORTMONTH:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],fullDate:"EEEE, d 'de' MMMM 'de' y",longDate:"d 'de' MMMM 'de' y",medium:"dd/MM/yyyy HH:mm:ss",mediumDate:"dd/MM/yyyy",mediumTime:"HH:mm:ss","short":"dd/MM/yy HH:mm",shortDate:"dd/MM/yy",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"€",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,macFrac:0,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,macFrac:0,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:" ¤",posPre:"",posSuf:" ¤"}]},id:"es-es",pluralCat:function(n){return 1==n?PLURAL_CATEGORY.ONE:PLURAL_CATEGORY.OTHER}})}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("core").factory("Socket",["socketFactory","$location",function(socketFactory,$location){return socketFactory({prefix:"",ioSocket:io.connect($location.protocol()+"://"+$location.host()+":"+$location.port())})}]),angular.module("gettext").run(["gettextCatalog",function(gettextCatalog){gettextCatalog.setStrings("en_US",{ACCOUNTS:"ACCOUNTS",Accept:"Accept","Account Name:":"Account Name:",Accounts:"Accounts","Add Influencer":"Add Influencer","Add Response":"Add Response","Add Subtopic":"Add Subtopic","Add Topic":"Add Topic","Add to your Predefined Answers":"Add to your Predefined Answers",Answer:"Answer",Answered:"Answered","Are you sure you want to delete this Subtopic?":"Are you sure you want to delete this Subtopic?","Are you sure you want to delete this Topic?":"Are you sure you want to delete this Topic?","Are you sure?":"Are you sure?",Articles:"Articles",Assign:"Assign","Average Case":"Average Case","Average Time":"Average Time",Begin:"Begin","By doing so, you will delete its Subtopics":"By doing so, you will delete its Subtopics",Cancel:"Cancel",Cancelar:"Cancel","Change Password":"Change Password","Clasificado por":"Sort by",Close:"Close",Complete:"Complete",Completed:"Completed","Confirm New Password":"Confirm New Password",Create:"Create","Current Password":"Current Password",Dashboard:"Dashboard",Description:"Description","Direct Messages":"Direct Messages","Doing so will remove the answer":"Doing so will remove the answer","Download CSV":"Download CSV","Edit Feed":"Edit Feed",Email:"Email",Engagement:"Engagement","Enter your account username.":"Enter your account username.",Entries:"Entries","Facebook Account":"Facebook Account",Favorites:"Favorites","First Name":"First Name",Follow:"Follow","For furter assitance call <strong>01 800 20 56 30</strong>":"<!--For furter assitance call <strong>01 800 20 56 30</strong>-->",Generate:"Generate","Got it!":"Got it!",INFLUENCERS:"INFLUENCERS",Industry:"Industry",Influencers:"Influencers",Insult:"Insult","Last Name":"Last Name",'Login with an account that you will use to respend width<br><a href="https://apps.twitter.com" target="_blank">apps.twitter.com</a>':'Login with an account that you will use to respend width<br><a href="https://apps.twitter.com" target="_blank">apps.twitter.com</a>',MAILBOX:"MAILBOX",METRICS:"METRICS",Mailbox:"Mailbox",Map:"Map",Name:"Name","Need Help?":"Need Help?","New Feed":"New Feed","New Password":"New Password","New Response":"New Response","New Subtopic":"New Subtopic","New Topic":"New Topic","Nickname:":"Nickname:",'No articles yet, why don\\u0027t you <a href="/#!/articles/create">create one</a>?':'No articles yet, why don\\u0027t you <a href="/#!/articles/create">create one</a>?',"No tienes notificaciones":"No notifications","Not Related":"Not Related",Other:"Other",PROFILE:"PROFILE",PUBLICATIONS:"PUBLICATIONS",Password:"Password",Performances:"Performances","Please select the account you<br>would like to manage":"Please select the account you<br>would like to manage",'Posted on\n				<span data-ng-bind="article.created | date:\\u0027mediumDate\\u0027"></span>\n				by\n				<span data-ng-bind="article.user.displayName"></span>':'Posted on\n				<span data-ng-bind="article.created | date:\\u0027mediumDate\\u0027"></span>\n				by\n				<span data-ng-bind="article.user.displayName"></span>',"Private Message":"Private Message",Profile:"Profile",RESPONSE:"RESPONSE",RESUMEN:"ABSTRACT",Range:"Range","Read More":"Read More",Regresar:"Back",Reject:"Reject",Rejected:"Rejected","Remind to fill all the fields with *":"Remind to fill all the fields with *",Replies:"Replies","Response Averange / hrs":"Response Averange / hrs","Restore your password":"Restore your password","Return to entries":"Return to entries",Retweets:"Retweets",Rol:"Rol","Rol del usuario":"Rol del usuario",SUBTOPIC:"SUBTOPIC","Save Changes":"Save Changes","Selecting reasons gives you a better understanding<br>of your conversations:":"Selecting reasons gives you a better understanding<br>of your conversations:",Sentiment:"Sentiment",Spam:"Spam","Sure you want to proceed?":"Deseas Continuar",TEAM:"TEAM",TOPIC:"TOPIC",Tagcloud:"Tagcloud",Team:"Team","This will affect it\\u0027s history":"This will affect it\\u0027s history","Top Subtopics":"Top Subtopics","Top Topics":"Top Topics","Topics &amp;<br>Subtopics":"Topics &amp;<br>Subtopics","Total Cases":"Total Cases",Troll:"Troll","Twitter  Accounts":"Twitter  Accounts","Twitter Setup":"Twitter Setup","Upload Image":"Upload LogoUpload Image","Upload Logo":"Upload Logo",User:"User","User Name":"User Name",Username:"Username","Username (twitter)":"Username (twitter)","Why?":"Why?","You will not be notified when they message back":"You will not be notified when they message back","Your account’s information will be deleted permanently":"Your account’s information will be deleted permanently","{{ \\u0027Discart Reason\\u0027 | translate }}":"Razón Descarte","¿Are you sure?":"Are you sure?","¿Estás seguro de que deseas desconectar listening account de twitter?":"¿Estás seguro de que deseas desconectar listening account de twitter?","¿Forgot Password?":"¿Forgot Password?","not-related":"not-related",answered:"answered",campaign:"campaign",insult:"insult",other_comments:"other_comments"}),gettextCatalog.setStrings("es_ES",{"(Responding)":"(Attending...)",ACCOUNTS:"CUENTAS",Accept:"Aceptar","Access Token":"Access Token","Access Token Secret":"Access Token Secret","Account Name:":"Nombre de la Cuenta:",Accounts:"Cuentas","Add Influencer":"Agregar Influencer","Add Response":"Agregar Respuesta","Add Subtopic":"Agregar Subtema","Add Topic":"Agregar Tema","Add User":"Agregar Usuario","Add to your Predefined Answers":"Agregar a mis respuestas predefinidas",Answer:"Ver Conversación",Answered:"Respondido","Are you sure you want delete this response?":"¿Estás seguro de borrar esta respuesta?","Are you sure you want to delete this Subtopic?":"¿Estás seguro de borrar este Subtema?","Are you sure you want to delete this Topic?":"¿Estás seguro de borrar este Tema?","Are you sure?":"¿Estas seguro?",Articles:"Artículos","Average Case":"Promedio de Casos","Average Time":"Tiempo Promedio",Begin:"Ingresar","By doing so, you will delete its Subtopics":"Al hacerlo, eliminarás sus Subtemas y sus Respuestas",Cancel:"Cancelar",Cancelar:"Cancelar","Change Password":"Cambio de Contraseña","Clasificado por":"Clasificado por",Close:"Cerrar","Completado por":"Resuelto por",Complete:"Completar",Completed:"Resueltos","Confirm New Password":"Confirmar Nueva Contraseña","Consumer Secret":"Consumer Secret","Costumer Key":"Clave de Cliente",Create:"Crear","Current Password":"Contraseña Actual",Description:"Descripción","Direct Messages":"Mensajes Directos","Doing so will remove the answer":"Al hacerlo eliminarás la respuesta","Download CSV":"Descargar CSV","Download PDF":"Descargar PDF","Edit Feed":"Editar",Email:"Email","Enter your account username.":"Ingresa tu nombre de usuario",Entries:"Entrada","Facebook Account":"Cuenta de Facebook","First Name":"Nombre",Follow:"Seguir",Generate:"Generar","Got it!":"¡Entendido!",INFLUENCERS:"INFLUENCERS",Industry:"Industria",Influencers:"Influencers",Insult:"Insulto","Last Name":"Apellidos",'Login with an account that you will use to respend width<br><a href="https://apps.twitter.com" target="_blank">apps.twitter.com</a>':"Has Login con la cuenta que utilizarás para dar respuesta",MAILBOX:"BUZÓN",METRICS:"METRICAS",Mailbox:"Buzón",Map:"Mapa",Name:"Nombre","Need Help?":"Ver Tutorial","New Account":"Nueva Cuenta","New Feed":"Respuesta Nueva","New Messages":"Nuevos Mensajes","New Password":"Nueva Contraseña","New Response":"Nueva Respuesta","New Subtopic":"Nuevo Subtema","New Topic":"Nuevo Tema","Nickname:":"Nombre Corto de la Cuenta:",'No articles yet, why don\\u0027t you <a href="/#!/articles/create">create one</a>?':'No hay artículos aún, ¿ <a href="/#!/articles/create">crear uno</a>?',"No tienes notificaciones":"No tienes notificaciones","Not Related":"No Relacionado",Notifications:"Notificaciones",Other:"Otro",PROFILE:"PERFIL",PUBLICATIONS:"PUBLICACIONES",Password:"Contraseña","Please select the account you<br>would like to manage":"Selecciona la cuenta<br/>que deseas agregar","Primary Account":"Cuenta Primaria","Private Message":"Mensaje Privado",Proceso:"Atendidos",Profile:"Perfil",RESPONSE:"RESPUESTA",RESUMEN:"RESUMEN",Range:"Rango","Read More":"Leer Todos",Regresar:"Back",Reject:"Descartar",Rejected:"Descartados","Remind to fill all the fields with *":"Recuerda rellenar todos los campos marcados con *",Response:"Respuesta","Response Averange / hrs":"Promedio de respuesta / hrs","Restore your password":"Recuperación de Contraseña","Return to entries":"Regresar a Entrada",Rol:"Rol","Rol del usuario":"Rol del usuario",SUBTOPIC:"SUBTEMA","Save Changes":"Guardar Cambios","Secondary Account":"Cuenta Secundaria","Selecting reasons gives you a better understanding<br>of your conversations:":"Selecciona la razón por la que descartas este mensaje",Sentiment:"Sentimiento",Spam:"Spam","Sure you want to proceed?":"¿Estas Seguro?",TEAM:"EQUIPO",TOPIC:"TEMA",Tagcloud:"Nube de Términos",Team:"Equipo","Top Subtopics":"Top Subtemas","Top Topics":"Top Temas","Topics &amp;<br>Subtopics":"Temas &amp;<br>Subtemas","Total Cases":"Total Casos",Troll:"Troll","Twitter  Accounts":"Cuentas de Twitter","Twitter Setup":"Cofiguración de Twitter","Upload Image":"Subir Imagen","Upload Logo":"Subir Logo",User:"Nombre de Usuario","User Name":"Nombre deUsuario",Username:"Nombre de Usuario","Username (twitter)":"Nombre de Usuario (Twitter)","Why?":"¿Por qué?","You will not be notified when they message back":"Dejarás de recibir notificaciones cuando te mencionen o te escriban","Your account’s information will be deleted permanently":"La información de la cuenta será borrada permanentemente",to:"a","¿Are you sure?":"¿Estas seguro?","¿Estás seguro de que deseas desconectar listening account de twitter?":"¿Estás seguro de que deseas desconectar esta cuenta?","¿Forgot Password?":"¿Olvidaste tu contraseña?","not-related":"no relacionado",answered:"Respondido",campaign:"campaña",insult:"insulto",other_comments:"mediático"})}]),angular.module("csvs").config(["$stateProvider",function($stateProvider){$stateProvider.state("listCsvs",{url:"/csvs",templateUrl:"modules/csvs/views/list-csvs.client.view.html"}).state("createCsv",{url:"/csvs/create",templateUrl:"modules/csvs/views/create-csv.client.view.html"}).state("viewCsv",{url:"/csvs/:csvId",templateUrl:"modules/csvs/views/view-csv.client.view.html"}).state("editCsv",{url:"/csvs/:csvId/edit",templateUrl:"modules/csvs/views/edit-csv.client.view.html"})}]),angular.module("csvs").controller("CsvsController",["$scope","$stateParams","$http","$location","Authentication","Csvs",function($scope,$stateParams,$http,$location,Authentication,Csvs){$scope.authentication=Authentication,$scope.creaArchivo=function(){function obtenPorcentajes(obj,total){var obj_perce={};for(var i in obj)obj_perce[i]=(100*obj[i]/total).toFixed(2);return obj_perce}var obj={};obj.fecha_inicial=$scope.dt,obj.fecha_final=$scope.dt2,obj.coleccion=Authentication.user.cuenta.marca+"_consolidada";$http.post("/generaArchivo",obj).success(function(items){var data=items;console.log("Sacando archivos en front");var csv=[["Categoria","Nùmero"]],contador=1,contador2=0,contador_coincidencias=[],n=[],title=[],obj={},series=[],sentiment={};items.sentiment_negativo&&(sentiment.negativo=items.sentiment_negativo),items.sentiment_neutro&&(sentiment.neutro=items.sentiment_neutro),items.sentiment_positivo&&(sentiment.positivo=items.sentiment_positivo);var total=0;for(var i in sentiment)console.log(i),console.log(sentiment),console.log(sentiment[i]),total+=sentiment[i];$scope.sentiment_perce=obtenPorcentajes(sentiment,total),$scope.sentiment=sentiment;for(var h in data){-1===h.search("_")&&(obj[contador2]={name:h,drilldown:h},series.push({id:h,events:{click:function(e,h){alert(e.point.name)}},data:[]}),contador2++);for(var k in obj)-1!==h.search(obj[k].name)&&-1!==h.search("_")&&(contador_coincidencias.hasOwnProperty(obj[k].name)?contador_coincidencias[obj[k].name]+=data[h]:contador_coincidencias[obj[k].name]=data[h]);csv[contador]=[h,data[h]],n[contador-1]=data[h],title[contador-1]=h,contador++}var arr_subtemas=[];contador=0;var array=[];for(var j in obj){void 0===typeof contador_coincidencias[obj[j].name]?obj[j].y=0:obj[j].y=contador_coincidencias[obj[j].name],console.log(obj[j].y),console.log(obj[j].y=contador_coincidencias[obj[j].name]),contador=0,array.push(obj[j]);for(var l in data)if(-1!==l.search(obj[j].name)&&-1!==l.search("_")){0===contador&&(arr_subtemas[obj[j].name]=[]);var start=l.indexOf("_"),subtema=l.slice(start+1);for(var z in series)series[z].id===obj[j].name&&series[z].data.push([subtema,data[l]]);arr_subtemas[obj[j].name][contador]=subtema,contador++}}console.log("Por fechas"),console.log($scope.dt),console.log($scope.dt2),$http.post("/chartPromedioCasos",{nombreSistema:Authentication.user.cuenta.marca,fecha_inicial:$scope.dt,fecha_final:$scope.dt2}).success(function(data){console.log("Obteniendo datos de char1"),console.log(data);var total=data.totalProceso+data.totalDescartado+data.totalNuevos+data.totalAtendidos,vistos=total-data.totalNuevos,obj=[];for(var i in data)obj.push(new Array(i.replace("total",""),data[i]));$scope.chartTotalCasos={options:{chart:{type:"solidgauge"},credits:{enabled:!1},pane:{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},solidgauge:{dataLabels:{y:-30,borderWidth:0,useHTML:!0}}},series:[{data:[vistos],dataLabels:{format:'<div style="text-align:center"><span style="font-size:120px;color:black;font-weight:bold;">{y}/'+total+"</span><br/>"}}],title:{text:" ",y:50},yAxis:{currentMin:0,currentMax:total,title:{y:140},stops:[[.1,"#DF5353"],[.5,"#DDDF0D"],[.9,"#55BF3B"]],lineWidth:0,tickInterval:20,tickPixelInterval:400,tickWidth:0,labels:{y:15}},loading:!1},$scope.chartPromedioCasos={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},title:{text:" "},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return this.percentage.toFixed(2)+"%"},style:{fontWeight:"bold",color:"black"}},showInLegend:!0}}},series:[{type:"pie",name:"Total",data:obj}]},$http.post("/chartDescartados",{nombreSistema:Authentication.user.cuenta.marca,fecha_inicial:$scope.dt,fecha_final:$scope.dt2}).success(function(data_graf_descartados){if(console.log("Imprimiendo datos graficas descartados"),console.log(data_graf_descartados),'"No hubo resultados"'!==data_graf_descartados){var objDescartados=[];for(var i in data_graf_descartados)objDescartados.push(new Array(i,data_graf_descartados[i]));$scope.chartDescartados={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},title:{text:" "},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return this.percentage.toFixed(2)+"%";
},style:{fontWeight:"bold",color:"black"}},showInLegend:!0}}},series:[{type:"pie",name:"Total",data:objDescartados}]}}else console.log("No hay descartados");console.log("Termino descartados")}),$http.post("/chartDesempenio",{nombreSistema:Authentication.user.cuenta.marca,fecha_inicial:$scope.dt,fecha_final:$scope.dt2}).success(function(data_desem){if(console.log("Entro a desempeño chart "),console.log(data_desem),"No hubo resultados"!==data_desem){var obj_desem=[],arr_names=[],aux_descartado=[],aux_atendidos=[],aux_respuestas=[],aux_clasificados=[];data_desem.sort(function(a,b){return b.total-a.total});var images={};for(var i in data_desem)images['<span style="text-align:center";>'+data_desem[i].nombre+'<br><span style="font-weight:bold;">'+data_desem[i].total+" Casos</span></span>"]=data_desem[i].imagen?'<br><img src="'+data_desem[i].imagen+'" style="width:30px; height:30px;border-radius:50%;">':'<br><img src="/modules/core/img/usuario-sem-imagem.png" style="width:30px; height:30px;border-radius:50%;">',arr_names.push('<span style="text-align:center";>'+data_desem[i].nombre+'<br><span style="font-weight:bold;">'+data_desem[i].total+" Casos</span></span>"),aux_clasificados.push(data_desem[i].clasificacion),aux_respuestas.push(data_desem[i].respuestas),aux_atendidos.push(data_desem[i].atendidos),aux_descartado.push(data_desem[i].descartado);obj_desem.push({name:"Descartados",data:aux_descartado}),obj_desem.push({name:"Atendidos",data:aux_atendidos}),obj_desem.push({name:"Respondidos",data:aux_respuestas}),obj_desem.push({name:"Clasificados",data:aux_clasificados}),$scope.chartDesempenio={options:{chart:{type:"bar"},title:{text:" "},credits:{enabled:!1},xAxis:{categories:arr_names,labels:{useHTML:!0,formatter:function(){return'<br><div class="datos">'+this.value+" "+images[this.value]+"</div>"}}},yAxis:{min:0,title:{text:" "}},legend:{reversed:!0},plotOptions:{series:{stacking:"normal"}}},series:obj_desem},console.log("Termino desempeño Chart empezaremos con promedio respuesta")}else console.log("No hubo resultados para tiempo promedio");$http.post("/chartPromedioRespuesta",{nombreSistema:Authentication.user.cuenta.marca,fecha_inicial:$scope.dt,fecha_final:$scope.dt2}).success(function(data_tiempo){if(console.log("Obteniendo el tiempo"),console.log(data_tiempo),'"No hubo resultados"'!==data_tiempo){console.log("Generando gráfica ");var obj_tiempo_respuesta=[];for(var i in data_tiempo)obj_tiempo_respuesta.push(new Array(i,data_tiempo[i]));$scope.chartTiempoRespuesta={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:" "},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,style:{fontWeight:"bold",color:"black"}},showInLegend:!0}}},series:[{type:"pie",name:"Total",data:obj_tiempo_respuesta}]}}else console.log("No hubo resultados de tiempo promedio");$http.post("/chartPromedioTiempo",{nombreSistema:Authentication.user.cuenta.marca,fecha_inicial:$scope.dt,fecha_final:$scope.dt2}).success(function(data_promedio_tiempo){console.log("Imprimiendo el tiempo promedio de respuesta"),$scope.chartPromedioTiempo=data_promedio_tiempo,$http.post("/chartTwit",{nombreSistema:Authentication.user.cuenta.marca,id_cuenta:Authentication.user.cuenta._id}).success(function(data_twit){console.log(data_twit)})})})})}),$scope.config={options:{chart:{type:"pie"},lang:{drillUpText:"<< Regresar a Temas"}},title:{text:""},credits:{enabled:!1},xAxis:{type:"category"},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0}}},series:[{name:"Things",colorByPoint:!0,data:array}],drilldown:{series:series}};var objTemas=[];for(var g in array)objTemas.push(new Array(array[g].name,array[g].y));$scope.chartTemas={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:" "},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return this.percentage.toFixed(2)+"%"},style:{fontWeight:"bold",color:"black"}},showInLegend:!0}}},series:[{type:"pie",name:"Total",data:objTemas}]};var objSubTemas=[];for(var e in series)for(var f in series[e].data)objSubTemas.push(series[e].data[f]);$scope.chartSubTemas={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:" "},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},options:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:20},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return this.percentage.toFixed(2)+"%"}},showInLegend:!0,distance:-50,style:{fontWeight:"bold",color:"black"}},showInLegend:!0}},series:[{type:"pie",name:"Total",data:objSubTemas}]};var csvContent="data:text/csv;charset=utf-8,";if("0"!==data){csv.forEach(function(infoArray,index){var dataString=infoArray.join(",");csvContent+=index<csv.length?dataString+"\n":dataString});var encodedUri=encodeURI(csvContent);$scope.archivo=encodedUri}else alert("No hubo resultados para ese rango de fechas")})},$scope.descargaArchivo=function(){window.open($scope.archivo)},$scope.today=function(){var semana_antes=(new Date).getDate();$scope.dt=(new Date).setDate(semana_antes-7),$scope.dt2=new Date},$scope.today(),$scope.clear=function(){$scope.dt=null},$scope.disabled=function(date,mode){return"day"===mode&&(0===date.getDay()||6===date.getDay())},$scope.toggleMin=function(){$scope.minDate=-10},$scope.toggleMin(),$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0},$scope.open2=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened2=!0},$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.formats=["dd/MM/yyyy"],$scope.format=$scope.formats[0],$scope.create=function(){var csv=new Csvs({name:this.name});csv.$save(function(response){$location.path("csvs/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(csv){if(csv){csv.$remove();for(var i in $scope.csvs)$scope.csvs[i]===csv&&$scope.csvs.splice(i,1)}else $scope.csv.$remove(function(){$location.path("csvs")})},$scope.update=function(){var csv=$scope.csv;csv.$update(function(){$location.path("csvs/"+csv._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.csvs=Csvs.query()},$scope.findOne=function(){$scope.csv=Csvs.get({csvId:$stateParams.csvId})}}]),angular.module("csvs").factory("Csvs",["$resource",function($resource){return $resource("csvs/:csvId",{csvId:"@_id"},{update:{method:"PUT"}})}]),angular.module("feeds").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Feeds","feeds","dropdown","/feeds(/create)?"),Menus.addSubMenuItem("topbar","feeds","List Feeds","feeds"),Menus.addSubMenuItem("topbar","feeds","New Feed","feeds/create")}]),angular.module("feeds").config(["$stateProvider",function($stateProvider){$stateProvider.state("listFeeds",{url:"/feeds",templateUrl:"modules/feeds/views/list-feeds.client.view.html"}).state("filtro",{url:"/filtroAccount",templateUrl:"modules/feeds/views/filtro-account.view.html"}).state("nuevoBuzon",{url:"/nuevo",templateUrl:"modules/feeds/views/lista-feeds-buzon.client.view.html"}).state("getFbFeed",{url:"/feeds/getMailBox",templateUrl:"modules/feeds/views/lista.fb.view.html"}).state("getResueltos",{url:"/feeds/resueltos",templateUrl:"modules/feeds/views/lista.resueltos.view.html"}).state("getDescartados",{url:"/feeds/descartados",templateUrl:"modules/feeds/views/lista.descartados.view.html"}).state("getProcesos",{url:"/feeds/proceso",templateUrl:"modules/feeds/views/lista.proceso.view.html"}).state("createFeed",{url:"/feeds/create",templateUrl:"modules/feeds/views/create-feed.client.view.html"}).state("viewFeed",{url:"/feeds/:feedId",templateUrl:"modules/feeds/views/view-feed.client.view.html"}).state("editFeed",{url:"/feeds/:feedId/edit",templateUrl:"modules/feeds/views/edit-feed.client.view.html"}).state("mailbox",{url:"/mailbox",templateUrl:"modules/feeds/views/buzon.view.html"})}]),angular.module("feeds").filter("etiquetasFecha",["$filter",function($filter){return function(text){var hoy=new Date,fechaTwit=new Date(text),html="";return html=hoy.getDate()+hoy.getMonth()+hoy.getFullYear()!==fechaTwit.getDate()+fechaTwit.getMonth()+fechaTwit.getFullYear()?'<label class="etiqueta-gris izq"  style="margin-left: 5px;" title="'+$filter("date")(fechaTwit,"h:mm a")+'">'+$filter("date")(fechaTwit,"d MMM yy")+"</label>":'<label class="etiqueta-gris izq"  style="margin-left: 5px;">'+$filter("date")(fechaTwit,"h:mm a")+"</label>"}}]).filter("capitalize",function(){return function(input){return input?input.charAt(0).toUpperCase()+input.substr(1).toLowerCase():""}}).filter("searchResultImg",function(){return function(input){return input&&input.atendido?input.atendido.usuario_foto?input.atendido.usuario_foto:input.clasificacion.imagen_usuario?input.clasificacion.imagen_usuario:"/modules/core/img/usuario-sem-imagem.png":void 0}}).filter("validaImagenDescartado",function(){return function(input){return"undefined"==typeof input||null===input?"/modules/core/img/usuario-sem-imagem.png":input}}).filter("validaImgFacebook",function(){return function(input){return"undefined"==typeof input.imagen_https?"/modules/core/img/usuario-sem-imagem.png":0===input.imagen_https.length?"/modules/core/img/usuario-sem-imagem.png":input.imagen_https}}).filter("linksTwitter",["$filter",function($filter){return function(text,entities,trackers){if(!text)return text;var replacedText=text;if(angular.isDefined(entities)){for(var a in entities.hashtags)replacedText=replacedText.replace("#"+entities.hashtags[a].text,'<a href="https://twitter.com/hashtag/'+entities.hashtags[a].text+'" target="_blank">#'+entities.hashtags[a].text+"</a>");for(var b in entities.user_mentions)replacedText=replacedText.replace("@"+entities.user_mentions[b].screen_name,'<a href="https://twitter.com/'+entities.user_mentions[b].screen_name+'" target="_blank">@'+entities.user_mentions[b].screen_name+"</a>")}if(angular.isDefined(trackers))for(var t in trackers){var buscar=trackers[t];new RegExp(buscar,"gim");replacedText=replacedText.replace(trackers[t],'<span class="tracker">'+trackers[t]+"</span>")}var patronLink=/(^|\s)(http:\/\/t\.[co\/])(\w*[a-zA-Z_]+\w*)\/(\w*[a-zA-Z_]+\w*)/gim;replacedText=replacedText.replace(patronLink,'$1<a href="$2$3/$4" target="_blank" class="link-twitter link-twitter-hastag">$2$3/$4</a>');var patronLink2=/(^|\s)(https:\/\/t\.[co\/])(\w*[a-zA-Z_]+\w*)\/(\w*[a-zA-Z_]+\w*)/gim;return replacedText=replacedText.replace(patronLink2,'$1<a href="$2$3/$4" target="_blank" class="link-twitter link-twitter-hastag">$2$3/$4</a>')}}]).filter("facebookLinkComment",["$filter",function($filter){return function(text,id_comentario){if(""!==text){var partes=text.split("_");"undefined"==typeof id_comentario&&(id_comentario="");var partes_comentario=id_comentario.split("_"),url="https://www.facebook.com/"+partes[0]+"/posts/"+partes[1]+"?comment_id="+partes_comentario[1];return url}}}]).filter("facebookLinkSubComment",["$filter",function($filter){return function(text,id_comentario){if(""!==text){var partes=text.split("_");"undefined"==typeof id_comentario&&(id_comentario="");var partes_comentario=id_comentario.split("_"),url="https://www.facebook.com/"+partes[0]+"/posts/"+partes[1]+"?comment_id="+partes_comentario[1];return url}}}]).filter("facebookLinkPost",["$filter",function($filter){return function(text){if(""!==text){var partes=text.split("_"),url="https://www.facebook.com/"+partes[0]+"/posts/"+partes[1];return url}}}]).filter("tipoFacebook",["$filter",function($filter){return function(text){switch(text){case"facebook_inbox":return"Inbox";case"comment":return"Comment";case"post":return"Post";default:return text}}}]).filter("html5Entities",["$filter",function($filter){return function(text){if(""!==text){var texto=text;return texto.replace("!!!","")}}}]).filter("facebookMentions",["$filter",function($filter){return function(text){if(text){var replacedText=text,patronHashtag=/(^|\s)\@(\[)(\w*[0-9]+\w*)(:)(\w*[0-9]+\w)(:)(\w*[\sa-z\SA-Z]+\w)(\])/gim;return replacedText=replacedText.replace(patronHashtag,'$1<a target="_blank" class="link-twitter link-twitter-hastag" href="https://facebook.com/$3">@$7</a>'),null!==replacedText.match(/%[0-9a-f]{2}/i)&&(replacedText=decodeURIComponent(replacedText)),replacedText}}}]).filter("fechaPublicacion",["$filter",function($filter){return function(text,tipo){var monthNames=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],fechaActual=new Date,fechaEnviada=new Date(text),tiempoRestante=(fechaActual-fechaEnviada)/864e5,etiqueta="";return etiqueta+=tiempoRestante>0?fechaEnviada.getDate()+" "+monthNames[fechaEnviada.getMonth()]+" "+fechaEnviada.getFullYear():fechaEnviada.getHours()+" "+fechaEnviada.getMinutes()}}]).filter("numeroNotificaciones",["$filter",function($filter){return function(text){if(""!==text){if(text>0&&100>text)return text;if(text>=100)return"99+"}}}]).service("NotificacionService",["$rootScope","$http","$q","Authentication",function($rootScope,$http,$q,Authentication){return{notificacion_activa:new Array,totalDesempenioDiario:$http.post("/obtieneDesempenioDiario",{idUsuario:Authentication.user._id,cuenta:Authentication.user.cuenta.marca}).success(function(data){return data}),add:function(item){if(this.notificacion_activa.length>0)for(var i=0;i<this.notificacion_activa.length;i++)this.notificacion_activa.splice(i,1);this.notificacion_activa.push(item)},"delete":function(){for(var i=0;i<=this.notificacion_activa.length;i++)this.notificacion_activa.splice(i,1)},getDesempenio:function(){return $http.post("/obtieneDesempenioDiario",{idUsuario:Authentication.user._id,cuenta:Authentication.user.cuenta.marca}).success(function(data){return data})}}}]).controller("FeedsController",["NotificacionService","Socket","$scope","$http","$stateParams","$location","$resource","Authentication","$modal","$document","CONSTANT","$anchorScroll",function(NotificacionService,Socket,$scope,$http,$stateParams,$location,$resource,Authentication,$modal,$document,CONSTANT,$anchorScroll){$scope.pendientes=0,$scope.notificacion_activa=NotificacionService.notificacion_activa,NotificacionService.getDesempenio().success(function(data){$scope.totalDesempenioDiario=data}),$scope.tipo="todos",$http.post("/totalPendientes",{coleccion:Authentication.user.cuenta.marca+"_consolidada",id_cuenta:Authentication.user.cuenta._id,filtro:$scope.tipo}).success(function(data){$scope.pendientes=parseInt(data),"nuevos"===$scope.tipoBuzon&&($scope.textoSelectorBandeja="Nuevos ("+$scope.pendientes+")")}),$scope.filter_show=!0,$scope.paginacion_a=!1,$scope.paginacion_busqueda_skip=0,$scope.lote=new Array,$scope.activacheckbox="",$scope.checkLote=function(checked,elemento){if(checked){var datos_bloqueo={};datos_bloqueo.cuenta=$scope.authentication.user.cuenta.marca,datos_bloqueo.user=$scope.authentication.user.displayName,datos_bloqueo._id=elemento._id,datos_bloqueo.user_image=$scope.authentication.user.imagen_src,Socket.emit("idBloquea",datos_bloqueo),$scope.activacheckbox="activaCheck",$scope.lote.push(elemento)}else for(var i in $scope.lote)$scope.lote[i]===elemento&&(Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:elemento._id}),$scope.lote.splice(i,1),0===$scope.lote.length&&($scope.activacheckbox=""))},$scope.constant=CONSTANT,$scope.showNotificacion=function(notificacion){if("/mailbox"===$location.$$path)$scope.abrirNotificaciones(),$http.get("getOneContent?colec="+notificacion.coleccion+"&mo_id="+notificacion.mongo_id).then(function(data){var obj=data.data;obj.mongo_id=notificacion._id,delete obj.conversacion,obj.conversacion=new Array,obj.conv_cuenta=obj.conv_cuenta+1,NotificacionService.add(obj)});else{$location.path("/mailbox").search({colec:notificacion.coleccion,mo_id:notificacion.mongo_id,not_id:notificacion._id})}};var backspace=0,count=0;$document.bind("keypress keyup keydown",function(e){"keydown"===e.type&&8===e.which&&"busqueda"===e.target.name?(count++,count>1&&e.preventDefault()):count=0,8===e.which&&"INPUT"===e.target.nodeName&&""===$scope.s&&(backspace++,backspace>0&&($scope.paginacion_busqueda=!1,$scope.posts=$scope.aux))}),$scope.busquedaActiva=!1,$scope.numeroResultadosBusqueda=0,$scope.busquedaInput=function(tipo){var criterio=$scope.s;return $scope.buzon=tipo,criterio?void(criterio.length>0&&""!==criterio?($http.get("buscar?criterio="+criterio+"&coleccion="+Authentication.user.cuenta.marca+"&tipo="+tipo).success(function(data){delete $scope.posts,$scope.posts=angular.copy(data);var id_photo;for(var i in $scope.posts)!function(w){$scope.posts[w]&&(id_photo=$scope.posts[w].atendido?$scope.posts[w].atendido.usuario_id:$scope.posts[w].descartado?$scope.posts[w].descartado.idUsuario:null,id_photo&&$scope.getUserPhoto(id_photo,function(conv){conv[0]&&conv[0].hasOwnProperty("imagen_src")===!0&&$scope.posts[w]&&($scope.posts[w].atendido?$scope.posts[w].atendido.usuario_foto=conv[0].imagen_src:$scope.posts[w].descartado?$scope.posts[w].descartado.usuario_foto=conv[0].imagen_src:console.log("No se hace nada"))}))}(i);0===data.length?(delete $scope.posts,$scope.paginacion_busqueda=!1,$scope.paginacion_busqueda_skip=0,$scope.numeroResultadosBusqueda=0):($scope.paginacion_busqueda=!0,$scope.numeroResultadosBusqueda=data.length)}),$scope.busquedaActiva=!0):($scope.numeroResultadosBusqueda=0,$scope.busquedaActiva=!1,$scope.paginacion_busqueda_skip=0,$scope.paginacion_busqueda=!1,$scope.posts=$scope.aux)):($scope.busquedaActiva=!1,delete $scope.posts,$scope.paginacion_busqueda=!1,$scope.posts=$scope.aux,void $scope.refreshAux())},$scope.actualizaImgTwitter=function(mensaje){for(var i=0;i<$scope.posts.length;i++)mensaje._id===$scope.posts[i]._id&&($scope.posts[i].imagen="http://crm.likeable.mx/modules/core/img/loading.gif",$scope.posts[i].imagen_https="https://crm.likeable.mx/modules/core/img/loading.gif");$http.post("/actualizaImgTwitter",{cuenta:$scope.authentication.user.cuenta,mensaje:mensaje}).success(function(imgActualizada){if(imgActualizada)for(var i=0;i<$scope.posts.length;i++)imgActualizada._id===$scope.posts[i]._id&&($scope.posts[i].imagen_https=imgActualizada.imagen_https,$scope.posts[i].imagen=imgActualizada.imagen)})},$scope.refreshAux=function(){$scope.paginacion_busqueda=!1,delete $scope.posts,$scope.posts=$scope.aux},$scope.$on("muestraFlash",function(event,str){$scope.muestraFlash(str)}),$scope.muestraFlash=function(str){console.log(str),$scope.flash=!0,$scope.flash_text=str,setTimeout(function(){$scope.flash=!1,$scope.flash_text=""},2500)},$scope.obtieneNuevoBuzon=function(){$http.get($scope.constant.host+"/nuevoBuzon?coleccion=facespa_consolidada&cuenta_id=167584559969748&inicio=0").success(function(data){$scope.paginacion=15,$scope.posts=data,$scope.MuestraListadoFeeds=!0,console.log(data)}).error(function(error){console.log("ERROR !!!"),console.log(error)})},$scope.changeRadio=function(){"comment"!==$scope.filter_val?($scope.filter_show=!0,$scope.filtro={tipo:$scope.filter_val}):$scope.filter_show=!1,$scope.getFilter=function(){return $scope.filter_show?{tipo:$scope.filter_val}:{obj:"facebook"}&&({tipo:"comment"}||{tipo:"post"}||{tipo:"share"})}};var existe_notificacion=!1;$scope.comparaUrl=function(){var url=window.location.href;url=url.replace("#object-0",""),window.location.href=url,$scope.authentication=Authentication;var tieneSesion=$scope.authentication.user.hasOwnProperty("_id");tieneSesion===!1&&$location.path("/"),NotificacionService.getDesempenio().success(function(data){$scope.totalDesempenioDiario=data}),$location.$$search.colec&&($scope.notificacion={},$scope.notificacion.coleccion=$location.$$search.colec,$scope.notificacion.mongo_id=$location.$$search.mo_id,$scope.notificacion._id=$location.$$search.not_id)},$scope.filtroAccount=function(){var obj={};obj={first:$location.$$search.first,second:$location.$$search.second,cuenta:$location.$$search.cuenta+"_consolidada",opcion:$location.$$search.opcion},$location.$$search.total&&(obj.total=$location.$$search.total),$location.$$search.palabra?obj.palabra=$location.$$search.palabra:$location.$$search.sentiment&&(obj.sentiment=$location.$$search.sentiment),$location.$$search.usuario&&(obj.usuario=$location.$$search.usuario,obj.tipo=$location.$$search.tipo),$location.$$search.descartado?obj.descartado=$location.$$search.descartado:$location.$$search.tema?obj.tema=$location.$$search.tema:$location.$$search.subtema&&(obj.subtema=$location.$$search.subtema),obj.skip=0,console.log("El objeto es "),console.log(obj),$scope.obj_filtro_account=obj,$http.post("/obtienePorClick",obj).success(function(data){console.log("Datos para mostrar click!"),console.log(data),$scope.numeroResultadosBusqueda=data.length,$scope.posts=data,$scope.muestraLoadingPrimario=!1})},$scope.loadMoreFiltroAccount=function(){var obj=$scope.obj_filtro_account;obj.skip+=15,$http.post("/obtienePorClick",obj).success(function(data){console.log("Datos para mostrar click!"),console.log(data);for(var i in data)$scope.posts.push(data[i]);$scope.posts=$scope.posts.filter(function(){return!0}),$scope.numeroResultadosBusqueda+=data.length,$scope.muestraLoadingPrimario=!1})},$scope.isInfluencer=function(index){$http.post("/isInfluencer",{screen_name:$scope.posts[index].user.screen_name,coleccion:"influencers_"+Authentication.user.cuenta.marca}).success(function(result){return"error"===result?!1:"false"===result?!1:'"true"'===result?($scope.posts[index].influencer="true",!0):void 0})},$scope.changeIndex=function(e){27===e.which&&($scope.notificacionesOcultas=!0,$scope.clasesNotificaciones="animated bounceOutDown")},$scope.diasTranscurridos=function(fecha){var fechaActual=new Date,fechaEnviada=new Date(fecha),tiempoRestante=(fechaActual-fechaEnviada)/864e5;return parseInt(tiempoRestante)},$scope.scrollTo=function(element,to,duration){if(console.log("Scrollenado !"),!(0>duration)){var difference=to-element.scrollTop;console.log("Diferencia");var perTick=difference/duration*10;setTimeout(function(){element.scrollTop=element.scrollTop+perTick,console.log("Subiendo"),console.log(perTick),console.log(element.scrollTop),element.scrollTop!=to&&$scope.scrollTo(element,to,duration-10)},10)}},$scope.limiteTexto=300,$scope.getUserPhoto=function(id_usuario,callback){null===id_usuario&&(id_usuario=""),"direct-facebook"!==id_usuario&&""!==id_usuario&&$http.get("/getUserData?userId="+id_usuario).success(function(data){callback(data)})},$scope.textos={tema:"Tema",subtema:"Subtema"},$scope.authentication=Authentication,$scope.statusLoginFacebook=!1,"undefined"!=typeof $scope.authentication.user.additionalProvidersData&&($scope.statusLoginFacebook=!0),$scope.notificaciones_ocupadas=[],$scope.notificaciones=[],Socket.emit("getNotificaciones",$scope.authentication.user._id),$scope.notificar=function(data){if("undefined"!=typeof data[0].screen_name){if(!Notification)return void alert("No se aceptaron las notificaciones");if("granted"!==Notification.permission)Notification.requestPermission();else{var notification=new Notification("Likeable crm",{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAAAXNSR0IArs4c6QAABMBJREFUWAnNmV+IFVUcx7/n3Ll796orsmi4ayaCEWYrWAmBvmT10MuKoUG4EPTUQ6b5IBIZYb1sECZB9BDSg/UiCW70FBGhS2QvofgHpWw17+LuslG70r3uzD39fufOnebMzD2zM3fv6sCy5/x+v/P7feb8n98VaOOZfgsDUBiUAo8roF8I9CuFfnZJ5QqVKwKo1BUuQ2Ck9xgu5g1HfrI9DCcUXoPETgGxPktrBXUDdZxRAieyQs8bdHo/HqFeel9IDFF/ySyAcVtVV3WcpB4/0nscN+P6uCQV9NIedK15GEep6QEaz1LcRTsSVaWpc/z2n3h30yncs3mygo7vw6ruIk7TEG+3OWlXR1PiXHUOL/V9gslWvlqC0lBvFgWMEOS6Vo0XUk6wY8rDIE2FC0l+E0E1pMSoEGJZUiOrjKavWLoSanbCapakVErN0tzdlgQbWxQ83Lon80BS9PLQV+h5bxyl599OYrHKuGM4NjNEDQ1QXjj+nMw/3NQlFBDdL36Awtqt0XipdZ5qzMAsYWMDtG8tbT/tLhy3Fvjv2v5GUM5SYAZ/pwmaBaC8T1LlzUCTsyCW9AYtC+ueCcqZCwL7manZLgDlzZw28u6mItd/Wkjh4ZbL9WmayxWzNJgazTWoPhb1iZPTp9+s+OReyOWrAydq7t+gnKfAp6C+T1BjDarP7naPRfJaeuEdg0fNjBv17BUhG2w+KF8wsjsxWxS3vILCqkcNoXf7V6Oeq+KzSb25Z7wFRQOKntXoHvwoKob7248xWVYB7QDrmVHSiA1mbWzY04xfMvQlZM9Dhlh5LtzL3xiyvBVmdOgM3ZjXAd+Oy7s/g7Ph2bgL2viXvv59XB6S8GKr/fAh3Atfh6TxIjM6+mYe16VLnBLKL3+Orqf2JtoKpwuFvicSdWGh8+op3P1iN9yLp8Nio8yMDnXKvDa70o7DQLGM+l9jmDt/AssOnCeQAcNh3kpxYJcVlBkd/sahQupT2nEIorwC7o1RDbpQkBw4bdExY3AypZJ20MC7+XOqd0m9WUm16rBBYc0WawRmlPxJa7XqsJIuy6hPXbdGYUb6JL+/oNVvD8P74ycrKDNKWvpXrFYdVqq7U6kROIHBoGdSLRMMeMgW4lEzd9LdUJZFcsZCZzDSzQ0L/txo9/EmrsH9/azVDbMxY2N7ojSL1boDSlX3MPvx00Btxu7dZ9OgnAsC6HBe1IdGhG4b9odSP5rNv4/q4adckL2Rqa2Nfkqv5pnCedaUew+1744C1X+sLajrTjaTacFE0x93Etda5ZckbcpCOlA0VPWJqzoAH6ly5QZ6XYcGJLq4QnVDp+BN0r5Z/dsKSQ6r1A+PNZNoASi3mj6IYcpzHErxsDhqpYZXHAPdhBqPMUnGb+EIJ6yayvv1nxk4wxeOb/QoK/wM3i+csQgbLlaZIMcos7c1mtmLgTKQ/o7KmyRr440yJck4DmfTaMVt47drI26mphyLYyZl8tiRMUfDnrkBDwHPl7C8E2WOwbFaQXLMlqCs5HlSuYXnaOsZpr//s1+sXJCHU+NqmGNE52TUfeIcjRpxnfdZOt4f3B8botAP/M83UWC/lzdzcoCGZSOdQy1/ECPdFVooI7Y5mOQ/LPsPLhKekoKwE4gAAAAASUVORK5CYII=",body:"Tienes 1 nuevo mensajes de "+data[0].screen_name});notification.onclick=function(){window.open($scope.constant.host+"/#!/feeds/getMailBox?colec="+data[0].coleccion+"&mo_id="+data[0].mongo_id+"&not_id="+data[0]._id)}}}},document.addEventListener("DOMContentLoaded",function(){"granted"!==Notification.permission&&Notification.requestPermission()}),Socket.on("auxiliarNotificacion",function(data){data.cuenta===Authentication.user.cuenta.marca&&Socket.emit("eliminaNotificacion",data._id)}),Socket.on("notify",function(datos){for(var j=0;j<$scope.notificaciones.length;j++)if(datos[0]._id===$scope.notificaciones[j]._id)return;for(var i=0;i<datos[0].usuarios.length;i++)datos[0].usuarios[i]._id===$scope.authentication.user._id&&($scope.notificaciones.push(datos[0]),console.log("Notificando !!!!!"),console.log(datos),$scope.notificar(datos))}),Socket.on("sendNotify",function(items){$scope.notificaciones=items;for(var i in $scope.notificaciones)$scope.notificaciones[i].profile_image||($scope.notificaciones[i].profile_image="/modules/core/img/usuario-sem-imagem.png");for(var i in $scope.notificaciones)$scope.notificaciones[i]&&$scope.notificacion&&$scope.notificaciones[i].mongo_id===$scope.notificacion.mongo_id&&(existe_notificacion=!0);existe_notificacion&&($scope.notificacionesOcultas&&$scope.abrirNotificaciones(),$scope.showNotificacion($scope.notificacion)),$scope.notificacionesOcultas&&$scope.abrirNotificaciones()}),Socket.on("bloqueaNotificacion",function(id_notificacion){$scope.notificaciones_ocupadas.push(id_notificacion)}),Socket.on("quitaNotificacion",function(id_notificacion){NotificacionService["delete"](),console.log("Llamando a notificaciones"),console.log(id_notificacion);for(var i=0;i<$scope.notificaciones.length;i++)console.log($scope.notificaciones[i]),($scope.notificaciones[i]._id===id_notificacion||$scope.notificaciones[i].mongo_id===id_notificacion)&&(console.log($scope.notificaciones.length),$scope.notificaciones.splice(i,1),console.log($scope.notificaciones),$scope.notificaciones=$scope.notificaciones.filter(function(){return!0}),console.log($scope.notificaciones.length))}),Socket.on("tiempoRealFront",function(obj_actualizar){if(console.log("Actualizando tiempo Real Front"),console.log(obj_actualizar),obj_actualizar.cuenta===Authentication.user.cuenta.marca)switch($http.post("/totalPendientes",{coleccion:Authentication.user.cuenta.marca+"_consolidada",id_cuenta:Authentication.user.cuenta._id,filtro:$scope.tipo}).success(function(data){$scope.pendientes=parseInt(data),"nuevos"===$scope.tipoBuzon&&($scope.textoSelectorBandeja="Nuevos ("+$scope.pendientes+")"),console.log("TOTALES!!!"),console.log(_.size($scope.posts)),_.size($scope.posts)<3&&$scope.loadMoreUnificado()}),$scope.tipoBuzon){case"nuevos":if(obj_actualizar.regresa)console.log("El elemento se agrega en su fecha indicada");else for(var i in $scope.posts)$scope.posts[i]._id===obj_actualizar._id&&(delete $scope.posts[i],$scope.posts=$scope.posts.filter(function(){return!0}));break;case"asignados":for(var i in $scope.posts)$scope.posts[i]._id===obj_actualizar._id&&(delete $scope.posts[i],$scope.posts=$scope.posts.filter(function(){return!0}));break;case"descartados":var existe=!1;if(obj_actualizar.descartado){for(var i in $scope.posts)if($scope.posts[i]._id===obj_actualizar._id){if(existe=!0,$scope.posts[i].tipoMensaje="descartado",$scope.posts[i].descartado=obj_actualizar.descartado,Authentication.user.username===obj_actualizar.descartado.usuario){$scope.lote=new Array;var elem=angular.element(document.getElementById("selector_"+$scope.posts[i]._id));elem.attr("checked",!1)}$scope.posts=$scope.posts.filter(function(){return!0})}existe||console.log("No existe y debemos notificar un nuevo descartado")}for(var i in $scope.posts)$scope.posts[i]._id===obj_actualizar._id&&($scope.posts[i].clasificacion={tema:obj_actualizar.tema,subtema:obj_actualizar.subtema},$scope.posts[i].tipoMensaje="atendido",$scope.posts[i].sentiment=obj_actualizar.sentiment,$scope.posts=$scope.posts.filter(function(){return!0}));break;case"atendidos":if(obj_actualizar.regresa)for(var i in $scope.posts)$scope.posts[i]._id===obj_actualizar._id&&(delete $scope.posts[i],$scope.posts=$scope.posts.filter(function(){return!0}));break;case"todos":if(obj_actualizar.regresa){console.log("TODOS !!! con parametro regresa !!"),console.log(obj_actualizar);for(var i in $scope.posts)console.log($scope.posts[i]._id+"==="+obj_actualizar._id),$scope.posts[i]._id===obj_actualizar._id&&(console.log("Son iguales !"),$scope.posts[i].tipoMensaje="nuevo",console.log($scope.posts[i].atendido),$scope.posts[i].clasificacion&&delete $scope.posts[i].clasificacion,$scope.posts[i].atendido&&delete $scope.posts[i].atendido,console.log($scope.posts[i].atendido),$scope.posts[i].descartado&&delete $scope.posts[i].descartado);$scope.posts=$scope.posts.filter(function(){return!0})}if(obj_actualizar.descartado){for(var i in $scope.posts)if($scope.posts[i]._id===obj_actualizar._id){if($scope.posts[i].tipoMensaje="descartado",$scope.posts[i].descartado=obj_actualizar.descartado,Authentication.user.username===obj_actualizar.descartado.usuario){$scope.lote=new Array;var elem=angular.element(document.getElementById("selector_"+$scope.posts[i]._id));elem.attr("checked",!1)}$scope.posts=$scope.posts.filter(function(){return!0})}}else if(!obj_actualizar.regresa)for(var i in $scope.posts)$scope.posts[i]._id===obj_actualizar._id&&($scope.posts[i].clasificacion={tema:obj_actualizar.tema,subtema:obj_actualizar.subtema,user_name:obj_actualizar.username,user_id:obj_actualizar.user,imagen_usuario:obj_actualizar.user_image},console.log("ACTUALIZANDO USERNAME!"),console.log(obj_actualizar),console.log(obj_actualizar.username),$scope.posts[i].atendido={usuario_id:obj_actualizar.user,user_name:obj_actualizar.username},$scope.posts[i].sentiment=obj_actualizar.sentiment,$scope.posts[i].tipoMensaje="atendido",$scope.posts=$scope.posts.filter(function(){return!0}))}}),$scope.follow=function(twit){var obj={id_cuenta:Authentication.user.cuenta._id,screen_name:twit.user.screen_name,user_id:twit.user.id};$http.post("/follow",obj).success(function(data_follow){if(data_follow.code)alert("Error en follow");else{var obj_save={id_user_made_follow:Authentication.user._id,displayName_made_follow:Authentication.user.displayName,user_follow_id:data_follow.id,user_follow_name:data_follow.name,user_follow_screenname:data_follow.screen_name};$http.post("/guardaFollow",{obj:obj_save,coleccion:"followers_"+Authentication.user.cuenta.marca}).success(function(result_follow){for(var i in $scope.posts)twit._id===$scope.posts[i]._id&&($scope.posts[i].follower="true");alert("Siguiendo a @"+obj.screen_name)})}})},$scope.isFollow=function(index){var obj_compare={
user_follow_id:$scope.posts[index].user.id,user_follow_screenname:$scope.posts[index].user.screen_name,coleccion:"followers_"+Authentication.user.cuenta.marca};$http.post("/isFollow",obj_compare).success(function(result){return"error"===result?!1:"false"===result?!1:'"true"'===result?($scope.posts[index].follower="true",!0):void 0})},$scope.unFollow=function(twit){var obj={id_cuenta:Authentication.user.cuenta._id,screen_name:twit.user.screen_name,user_id:twit.user.id,coleccion:"followers_"+Authentication.user.cuenta.marca,obj_save:{id_user_made_follow:Authentication.user._id,displayName_made_follow:Authentication.user.displayName,user_follow_id:twit.user.id,user_follow_name:twit.user.name,user_follow_screenname:twit.user.screen_name}};$http.post("/unfollow",obj).success(function(data_unfollow){if(data_unfollow.code)alert("Error en unfollow");else{for(var i in $scope.posts)twit._id===$scope.posts[i]._id&&$scope.posts[i].follower&&delete $scope.posts[i].follower;alert("Dejaste de seguir a @"+twit.user.screen_name)}})},$scope.refreshUnificado=function(){if($scope.nuevosFiltered)$http.get("/nuevosPostsFiltered?lastct="+$scope.posts[0].created_time+"&tipo="+$scope.nuevosFiltered.tipo+"&obj="+$scope.nuevosFiltered.obj+"&id_cuenta="+Authentication.user.cuenta._id).success(function(data){console.log("Resultados narajas !!!"),console.log(data);for(var i in data.cuenta)console.log(data.cuenta[i]),data.cuenta[i].conv_cuenta=3,data.cuenta[i].conversacion=new Array,data.cuenta[i].tipoMensaje="nuevo",$scope.posts.unshift(data.cuenta[i]);$scope.posts=$scope.posts.filter(function(){return!0}),$scope.nuevos=0;var newHash="object-0";if($location.hash()!==newHash)$location.hash("object-0");else{$anchorScroll(),console.log("Removiendo el hash !");var url=window.location.href;console.log(url),url=url.replace("#object-0",""),console.log(url),window.location.href=url}});else{for(var i in $scope.mensajeAsignado)$scope.posts.unshift($scope.mensajeAsignado[i]);$scope.posts=$scope.posts.filter(function(){return!0}),$scope.mensajeAsignado=new Array,$scope.nuevos=0}},$scope.refresh=function(){console.log("Llamando naranja !!!!"),$http.get("/nuevosPosts?lastct="+$scope.posts[0].created_time+"&tipo="+$scope.tipo+"&id_cuenta="+Authentication.user.cuenta._id).success(function(data){console.log("Resultados narajas !!!"),console.log(data);for(var i in data.cuenta)console.log(data.cuenta[i]),$scope.posts.unshift(data.cuenta[i]);$scope.posts=$scope.posts.filter(function(){return!0}),$scope.nuevos=0;var newHash="object-0";$location.hash()!==newHash?$location.hash("object-0"):$anchorScroll()})},$scope.loadMore=function(servicio){if($scope.quita_scroll=!0,$scope.paginacion_busqueda)return $scope.paginacion_busqueda_skip+=15,void $http.get("buscar?criterio="+$scope.s+"&coleccion="+Authentication.user.cuenta.marca+"&tipo="+$scope.buzon+"&skip="+$scope.paginacion_busqueda_skip).success(function(mas_busqueda){for(var i in mas_busqueda)$scope.posts.push(mas_busqueda[i]);$scope.quita_scroll=!1,$scope.muestraLoading=!1});if("nuevo"===servicio)$http.get($scope.constant.host+"/nuevoBuzon?coleccion=facespa_consolidada&cuenta_id=167584559969748&inicio="+$scope.paginacion).success(function(data){$scope.paginacion+=15;for(var i in data)$scope.posts.push(data[i]);$scope.quita_scroll=!1}).error(function(error){console.log("ERROR !!!"),console.log(error)});else{var tipoFiltro="";"todos"!==$scope.tipo&&(tipoFiltro=$scope.tipo);var tipoOrganizacion="";if("desc"!==$scope.organizacion&&(tipoOrganizacion=$scope.organizacion),console.log(),$scope.fechas){var parametros=$scope.fechas.firstdate;delete $scope.fechas,$scope.muestraLoading=!0,$http.get("/"+servicio+"/"+$scope.authentication.user.cuenta._id+"?firstdate="+parametros+"&eltipo="+tipoFiltro+"&organizacion="+tipoOrganizacion).success(function(data){if(data){var cuentaData=0;cuentaData=data.length-1,"undefined"!=typeof data.length?$scope.masPost=!0:$scope.masPost=!1;var cuenta=cuentaData-1;if("undefined"!=typeof data[cuentaData]){$scope.fechas=data[cuentaData].fecha,delete data[cuentaData];for(var i=0;cuenta>=i;i++){if(delete data[i].conversacion,data[i].conv_cuenta++,data[i].conv_cuenta<1&&(data[i].conv_cuenta=" "),"undefined"!=typeof data[i].respuestas)for(var cont in data[i].respuestas)data[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto(data[w].respuestas[contador].user_id,function(conv){conv[0]&&conv[0].hasOwnProperty("imagen_src")===!0?data[w].respuestas[contador].foto=conv[0].imagen_src:data[w].respuestas[contador].foto=[]})}(i,cont);!function(w){data[w].atendido&&$scope.getUserPhoto(data[w].atendido.usuario_id,function(conv){data[w].atendido.usuario_foto=conv[0].imagen_src}),data[w].descartado&&$scope.getUserPhoto(data[w].descartado.idUsuario,function(conv){data[w].descartado.usuario_foto=conv[0].imagen_src})}(i),data[i].conversacion=[]}}var new_array=[],old_array=[],obj={};for(var h in data)new_array[h]=data[i];for(var j in $scope.posts)old_array[j]=$scope.posts[j];for(var k=0;k<new_array.length;k++)old_array[old_array.length]=new_array[k];for(var l=0;l<old_array.length;l++)obj[l]=old_array[l];var tam=_.size($scope.posts);$scope.posts=$scope.posts.filter(function(){return!0});var contador=0;for(var s in $scope.posts)$scope.posts[s].id||delete $scope.posts[s];for(var z in data)$scope.posts[tam+contador]=data[z],contador++;$scope.posts=$scope.posts.filter(function(){return!0}),$scope.muestraLoading=!1,$scope.quita_scroll=!1}})}else $scope.quita_scroll=!1}},$scope.loadMoreUnificado=function(servicio){$scope.quita_scroll=!0;var tipoFiltro="";"todos"!==$scope.tipo&&(tipoFiltro=$scope.tipo);var tipoOrganizacion="";"desc"!==$scope.organizacion&&(tipoOrganizacion=$scope.organizacion);var palabra="";"undefined"!=typeof $scope.palabra&&(palabra=$scope.palabra);var tipoBuzon=$scope.tipoBuzon;if($scope.fechas){var parametros=$scope.fechas.firstdate;delete $scope.fechas,$scope.muestraLoading=!0;var idUsuario=$scope.authentication.user._id;$http.get("/mailbox/?id="+$scope.authentication.user.cuenta._id+"&firstdate="+parametros+"&eltipo="+tipoFiltro+"&organizacion="+tipoOrganizacion+"&idUsuario="+idUsuario+"&tipoBuzon="+tipoBuzon+"&palabra="+palabra).success(function(data){if(data){var cuentaData=0;cuentaData=data.length-1,"undefined"!=typeof data.length?$scope.masPost=!0:$scope.masPost=!1;var cuenta=cuentaData-1;if("undefined"!=typeof data[cuentaData]){$scope.fechas=data[cuentaData].fecha,delete data[cuentaData];for(var i=0;cuenta>=i;i++)if("error"!==data[i]){if(delete data[i].conversacion,data[i].conv_cuenta++,data[i].conv_cuenta<1&&(data[i].conv_cuenta=" "),"undefined"!=typeof data[i].respuestas)for(var cont in data[i].respuestas)data[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto(data[w].respuestas[contador].user_id,function(conv){conv[0]&&conv[0].hasOwnProperty("imagen_src")===!0?data[w].respuestas[contador].foto=conv[0].imagen_src:data[w].respuestas[contador].foto=[]})}(i,cont);!function(w){data[w].atendido&&$scope.getUserPhoto(data[w].atendido.usuario_id,function(conv){data[w].atendido.usuario_foto=conv[0].imagen_src}),data[w].descartado&&$scope.getUserPhoto(data[w].descartado.idUsuario,function(conv){data[w].descartado.usuario_foto=conv[0].imagen_src})}(i),data[i].conversacion=[]}}var new_array=[],old_array=[],obj={};for(var h in data)new_array[h]=data[i];for(var j in $scope.posts)old_array[j]=$scope.posts[j];for(var k=0;k<new_array.length;k++)old_array[old_array.length]=new_array[k];for(var l=0;l<old_array.length;l++)obj[l]=old_array[l];var tam=_.size($scope.posts);$scope.posts&&($scope.posts=$scope.posts.filter(function(){return!0}));var contador=0;for(var s in $scope.posts)$scope.posts[s].id||delete $scope.posts[s];for(var z in data)$scope.posts[tam+contador]=data[z],contador++;$scope.posts=$scope.posts.filter(function(){return!0}),$scope.muestraLoading=!1,$scope.quita_scroll=!1}})}else $scope.quita_scroll=!1},$scope.ocupados=[],$scope.ocultos=[],Socket.on("bloquea",function(datos_a_bloquear){$scope.ocupados[$scope.ocupados.length]={_id:datos_a_bloquear._id,user:datos_a_bloquear.user,user_image:datos_a_bloquear.user_image}}),Socket.on("libera",function(libera){var libera_id=libera._id;if(libera.cuenta===$scope.authentication.user.cuenta.marca){for(var i in $scope.posts)$scope.posts[i]._id===libera_id._id&&(delete $scope.posts[i].conversacion,$scope.posts[i].conversacion=[],$scope.posts=$scope.posts.filter(function(){return!0}));var index=$scope.eval(libera_id);-1!==index&&$scope.ocupados.splice(index,1)}}),Socket.on("mensajeNuevo",function(mensaje){if(mensaje.cuenta===Authentication.user.cuenta.marca)switch($http.post("/totalPendientes",{coleccion:Authentication.user.cuenta.marca+"_consolidada",id_cuenta:Authentication.user.cuenta._id,filtro:$scope.tipo}).success(function(data){$scope.pendientes=parseInt(data),"nuevos"===$scope.tipoBuzon&&($scope.textoSelectorBandeja="Nuevos ("+$scope.pendientes+")")}),$scope.tipo){case"facebook":"facebook"!==mensaje.obj||"comment"!==mensaje.tipo&&"share"!==mensaje.tipo&&"post"!==mensaje.tipo&&"inbox"!==mensaje.tipo||$scope.setNuevos(mensaje.obj,mensaje.tipo);break;case"facebook_public":"facebook"!==mensaje.obj||"comment"!==mensaje.tipo&&"share"!==mensaje.tipo&&"post"!==mensaje.tipo&&"inbox"!==mensaje.tipo||$scope.setNuevos(mensaje.obj,mensaje.tipo);break;case"facebook_inbox":"facebook"===mensaje.obj&&"facebook_inbox"===mensaje.tipo&&$scope.setNuevos(mensaje.obj,mensaje.tipo);break;case"twitter":"twitter"!==mensaje.obj||"twit"!==mensaje.tipo&&"direct_message"!==mensaje.tipo&&"tracker"!==mensaje.tipo||$scope.setNuevos(mensaje.obj,mensaje.tipo);break;case"twitter_public":"twitter"===mensaje.obj&&"twit"===mensaje.tipo&&$scope.setNuevos(mensaje.obj,mensaje.tipo);break;case"direct_message":"twitter"===mensaje.obj&&"direct_message"===mensaje.tipo&&$scope.setNuevos(mensaje.obj,mensaje.tipo);break;case"tracker":"twitter"===mensaje.obj&&"tracker"===mensaje.tipo&&$scope.setNuevos(mensaje.obj,mensaje.tipo);break;default:$scope.setNuevos("todos","todos")}}),$scope.setNuevos=function(obj,tipo){$scope.nuevosFiltered=new Object,"facebook"===obj?($scope.nuevosFiltered.obj="facebook","facebook_inbox"!==tipo?$scope.nuevosFiltered.tipo=tipo:$scope.nuevosFiltered.tipo="facebook_inbox"):"twitter"===obj?($scope.nuevosFiltered.obj="twitter","tracker"===tipo?$scope.nuevosFiltered.tipo="tracker":"twit"===tipo?$scope.nuevosFiltered.tipo="twit":"direct_message"===tipo&&($scope.nuevosFiltered.tipo="direct_message")):"todos"===obj&&($scope.nuevosFiltered.obj="todos",$scope.nuevosFiltered.tipo="todos"),$scope.nuevos&&$scope.nuevos>0?$scope.nuevos++:$scope.nuevos=1},$scope.mensajeAsignado=new Array,Socket.on("iniciaSocket",function(elements){if(elements)for(var i in elements)Authentication.user.cuenta.marca===elements[i].cuenta&&($scope.ocupados=elements[i].ocupados)}),Socket.on("socketAsignaFront",function(data){var mensajes_asignados=new Array;if($scope.authentication.user.cuenta.marca===data.cuenta){for(var i in $scope.posts)for(var j in data.mensajes)$scope.posts[i]._id===data.mensajes[j]&&($scope.posts[i].asignado=data.asignado,mensajes_asignados.push($scope.posts[i]));if($scope.posts&&($scope.posts=$scope.posts.filter(function(){return!0})),"asignados"===$scope.tipoBuzon&&Authentication.user._id===data.asignado.usuario_asignado_id)for(var i in mensajes_asignados)$scope.nuevos&&$scope.nuevos>0?($scope.nuevos++,$scope.mensajeAsignado.push(mensajes_asignados[i])):($scope.mensajeAsignado.push(mensajes_asignados[i]),$scope.nuevos=1)}}),Socket.on("actualizaClasificacionFront",function(clasificacion){if(clasificacion.user===$scope.authentication.user._id&&NotificacionService.getDesempenio().success(function(data){$scope.totalDesempenioDiario=data}),clasificacion.cuenta===$scope.authentication.user.cuenta.marca&&$http.post("/totalPendientes",{coleccion:Authentication.user.cuenta.marca+"_consolidada",id_cuenta:Authentication.user.cuenta._id,filtro:$scope.tipo}).success(function(data){$scope.pendientes=parseInt(data)}),clasificacion.descartado)for(var i in $scope.posts)clasificacion._id===$scope.posts[i]&&(delete $scope.posts[i],$scope.posts=$scope.posts.filter(function(){return!0}));if(clasificacion.sentiment||"'Tema'"!==clasificacion.tema)for(var i in $scope.posts)$scope.posts[i]&&$scope.posts[i]._id===clasificacion._id&&("/feeds/getMailBox"===$location.$$path||"/home"===$location.$$path?(delete $scope.posts[i],$scope.posts=$scope.posts.filter(function(){return!0})):(delete $scope.posts[i].conversacion,$scope.posts[i].conversacion=[],$scope.posts[i].clasificacion?($scope.posts[i].clasificacion.tema=clasificacion.tema,$scope.posts[i].clasificacion.subtema=clasificacion.subtema,clasificacion.answer&&($scope.posts[i].respuestas?$scope.posts[i].respuestas.push(clasificacion.answer):($scope.posts[i].respuestas=[],$scope.posts[i].respuestas.push(clasificacion.answer)))):($scope.posts[i].clasificacion={tema:clasificacion.tema,subtema:clasificacion.subtema},clasificacion.answer&&($scope.posts[i].respuestas?$scope.posts[i].respuestas.push(clasificacion.answer):($scope.posts[i].respuestas=[],$scope.posts[i].respuestas.push(clasificacion.answer)))),$scope.posts[i].sentiment=clasificacion.sentiment));else console.log("Clasificacion invalida")}),Socket.on("ocultaPost",function(oculta_id){for(var i in $scope.posts)$scope.posts[i]._id===oculta_id&&delete $scope.posts[i];$scope.ocultos.push(oculta_id)}),$scope.evalOculto=function(id_ocultar){var existe=!1;for(var i in $scope.ocultos)$scope.ocultos[i]===id_ocultar&&(existe=!0);return existe?!0:!1},$scope.evalua_ocupado=function(id_twit){var existe=$scope.eval(id_twit);return-1!==existe?!0:!1},$scope.evalua_clasificacion=function(twit){return twit?twit.clasificacion&&"Tema"!==twit.clasificacion.tema&&twit.sentiment?!0:!1:void 0},$scope.eval=function(search){for(var searchTerm=search,index=-1,i=0;i<$scope.ocupados.length;i++)if($scope.ocupados[i]._id===searchTerm){index=i;break}return index};$scope.$on("finalizarCtrl",function(event,item){$scope.finalizar(item)}),$scope.finalizar=function(twit){if(twit.clasificacion&&(twit.clasificacion.tema===$scope.textos.tema?delete twit.clasificacion:twit.clasificacion.subtema===$scope.textos.subtema&&(twit.clasificacion.subtema="")),twit.clasificacion&&twit.sentiment){var auxiliar_twit=angular.copy(twit);delete auxiliar_twit.conversacion,$http.post("/finalizar",{twit:auxiliar_twit,user_id:$scope.authentication.user._id,user_name:$scope.authentication.user.username,coleccion:Authentication.user.cuenta.marca+"_consolidada"}).success(function(data){twit.conversacion=data;var obj_actualizar={tema:auxiliar_twit.clasificacion.tema,subtema:auxiliar_twit.clasificacion.subtema,user:$scope.authentication.user._id,username:$scope.authentication.user.username,user_image:Authentication.user.imagen_src,cuenta:Authentication.user.cuenta.marca};console.log("Actualizando los finalizados !!!+++"),console.log(data);for(var i=0;i<data.length;i++)obj_actualizar._id=data[i],Socket.emit("tiempoRealServer",obj_actualizar);NotificacionService.getDesempenio().success(function(data){$scope.totalDesempenioDiario=data})}).error(function(error_post){console.log("Eror en post!"),console.log(error_post)})}else console.log("Twit NO clasificado"),alert("Antes de completar, por favor clasifica esta conversación.")},$scope.remove=function(feed){if(feed){feed.$remove();for(var i in $scope.feeds)$scope.feeds[i]===feed&&$scope.feeds.splice(i,1)}else $scope.feed.$remove(function(){$location.path("feeds")})},$scope.tipoBuzon="todos",$scope.tipo="todos",$scope.organizacion="desc",$scope.cambioSelect=function(){"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getFb($scope.tipo,$scope.organizacion):$scope.getFb($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getFb("",$scope.organizacion):$scope.getFb()},$scope.cambioSelectProceso=function(){"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getMailboxProceso($scope.tipo,$scope.organizacion):$scope.getMailboxProceso($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getMailboxProceso("",$scope.organizacion):$scope.getMailboxProceso()},$scope.cambioSelectResueltos=function(){"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getResueltos($scope.tipo,$scope.organizacion):$scope.getResueltos($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getResueltos("",$scope.organizacion):$scope.getResueltos()},$scope.cambioSelectDescartados=function(){"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getDescartados($scope.tipo,$scope.organizacion):$scope.getDescartados($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getDescartados("",$scope.organizacion):$scope.getDescartados()},$scope.cambioOrganizacion=function(orden){$scope.organizacion=orden,"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getFb($scope.tipo,$scope.organizacion):$scope.getFb($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getFb("",$scope.organizacion):$scope.getFb()},$scope.cambioOrganizacionDescartados=function(orden){$scope.organizacion=orden,"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getDescartados($scope.tipo,$scope.organizacion):$scope.getDescartados($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getDescartados("",$scope.organizacion):$scope.getDescartados()},$scope.cambioOrganizacionResueltos=function(orden){$scope.organizacion=orden,"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getResueltos($scope.tipo,$scope.organizacion):$scope.getResueltos($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getResueltos("",$scope.organizacion):$scope.getResueltos()},$scope.cambioOrganizacionProceso=function(orden){$scope.organizacion=orden,"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.getMailboxProceso($scope.tipo,$scope.organizacion):$scope.getMailboxProceso($scope.tipo,""):"desc"!==$scope.organizacion?$scope.getMailboxProceso("",$scope.organizacion):$scope.getMailboxProceso()},$scope.cambioBuzon=function(tipo){switch($scope.tipoBuzon=tipo,$scope.mostrarSelectorBandeja=!1,$scope.tipoBuzon){case"nuevos":$scope.textoSelectorBandeja="Nuevos ("+$scope.pendientes+")";break;case"atendidos":$scope.textoSelectorBandeja="Atendidos";break;case"descartados":$scope.textoSelectorBandeja="Descartados";break;case"asignados":$scope.textoSelectorBandeja="Asignados";break;case"todos":$scope.textoSelectorBandeja="Todos";break;default:$scope.textoSelectorBandeja="Todos"}$scope.s?$scope.palabra=$scope.s:$scope.palabra="","todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,"",$scope.palabra):"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,"",$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,"","",$scope.palabra)},$scope.busqueda=function(){$scope.s?$scope.palabra=$scope.s:$scope.palabra="","todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,"",$scope.palabra):"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,"",$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,"","",$scope.palabra)},$scope.cambioTipoCuenta=function(tipo){switch($scope.tipo=tipo,$scope.mostrarSelectorRed=!1,console.log("Pendientes"),console.log($scope.tipo),$http.post("/totalPendientes",{coleccion:Authentication.user.cuenta.marca+"_consolidada",id_cuenta:Authentication.user.cuenta._id,filtro:$scope.tipo}).success(function(data){$scope.pendientes=parseInt(data),"nuevos"===$scope.tipoBuzon&&($scope.textoSelectorBandeja="Nuevos ("+$scope.pendientes+")")}),$scope.tipo){case"facebook":$scope.textoSelectorRed="<i class='fa fa-facebook' style='color:#375697;'></i>&nbsp;General";break;case"facebook_public":$scope.textoSelectorRed="<i class='fa fa-facebook' style='color:#375697;'></i>&nbsp;Público";break;case"facebook_inbox":$scope.textoSelectorRed="<i class='fa fa-facebook' style='color:#375697;'></i>&nbsp;Privado";break;case"rating":$scope.textoSelectorRed="<i class='fa fa-facebook' style='color:#375697;'></i>&nbsp;Rating";break;case"twitter":$scope.textoSelectorRed="<i class='fa fa-twitter' style='color:#375697;'></i>&nbsp;General";break;case"twitter_public":$scope.textoSelectorRed="<i class='fa fa-twitter' style='color:#375697;'></i>&nbsp;Público";break;case"direct_message":$scope.textoSelectorRed="<i class='fa fa-twitter' style='color:#375697;'></i>&nbsp;Privado";break;case"tracker":$scope.textoSelectorRed="<i class='fa fa-twitter' style='color:#375697;'></i>&nbsp;Trackers";break;default:$scope.textoSelectorRed="Todos"}$scope.s?$scope.palabra=$scope.s:$scope.palabra="","todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,"",$scope.palabra):"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,"",$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,"","",$scope.palabra)},$scope.cambioOrganizacionUnificado=function(organizacion){$scope.s?$scope.palabra=$scope.s:$scope.palabra="",$scope.organizacion=organizacion,"todos"!==$scope.tipo?"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,$scope.tipo,"",$scope.palabra):"desc"!==$scope.organizacion?$scope.obtieneBuzon($scope.tipoBuzon,"",$scope.organizacion,$scope.palabra):$scope.obtieneBuzon($scope.tipoBuzon,"","",$scope.palabra)},$scope.obtieneBuzon=function(tipoBuzon,filtro,organizacion,palabra){"undefined"==typeof palabra&&(palabra=""),"undefined"==typeof tipoBuzon&&(tipoBuzon="todos"),"undefined"==typeof organizacion&&(organizacion=""),"undefined"==typeof filtro&&(filtro=""),$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!0,$scope.MuestraListadoFeeds=!1,$scope.quita_scroll=!1,Socket.emit("getData");var id=$scope.authentication.user.cuenta._id,idUsuario=$scope.authentication.user._id,cuentaData=0;$http.get("/mailbox/?id="+id+"&eltipo="+filtro+"&organizacion="+organizacion+"&tipoBuzon="+tipoBuzon+"&idUsuario="+idUsuario+"&palabra="+palabra).success(function(data){$scope.posts=data,"undefined"!=typeof data.length?$scope.hayPost=!0:($scope.muestraLoadingPrimario=!1,$scope.hayPost=!1),"undefined"!=typeof data.length&&(cuentaData=data.length-1,$scope.fechas=data[cuentaData].fecha,delete $scope.posts[cuentaData],$scope.posts=$scope.posts.filter(function(){return!0}));for(var i in $scope.posts){if(function(w){"twitter"===$scope.posts[w].obj&&"twit"===$scope.posts[w].tipo&&($scope.isFollow(w),$scope.isInfluencer(w))}(i),"undefined"!=typeof $scope.posts[i].respuestas)for(var cont in $scope.posts[i].respuestas)$scope.posts[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto($scope.posts[w].respuestas[contador].user_id,function(conv){conv[0]&&($scope.posts[w].respuestas[contador].foto=conv[0].imagen_src)})}(i,cont);$scope.posts[i].conversacion&&(delete $scope.posts[i].conversacion,$scope.posts[i].conversacion=[],$scope.posts[i].conv_cuenta++,$scope.posts[i].conv_cuenta<1&&($scope.posts[i].conv_cuenta=""))}$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!1,$scope.quita_scroll=!1,id&&($scope.MuestraListadoFeeds=!0)})},$scope.getFb=function(filtro,organizacion){"undefined"==typeof organizacion&&(organizacion=""),"undefined"==typeof filtro&&(filtro=""),$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!0,$scope.MuestraListadoFeeds=!1,$scope.quita_scroll=!1,Socket.emit("getData");var id=$scope.authentication.user.cuenta._id,cuentaData=0;$http.get("/getMailbox/"+id+"?eltipo="+filtro+"&organizacion="+organizacion).success(function(data){$scope.posts=data,"undefined"!=typeof data.length?$scope.hayPost=!0:$scope.hayPost=!1,"undefined"!=typeof data.length&&(cuentaData=data.length-1,$scope.fechas=data[cuentaData].fecha,delete $scope.posts[cuentaData],$scope.posts=$scope.posts.filter(function(){return!0}),$scope.aux=$scope.posts);for(var i in $scope.posts){if(function(w){"twitter"===$scope.posts[w].obj&&"twit"===$scope.posts[w].tipo&&($scope.isFollow(w),$scope.isInfluencer(w))}(i),"undefined"!=typeof $scope.posts[i].respuestas)for(var cont in $scope.posts[i].respuestas)$scope.posts[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto($scope.posts[w].respuestas[contador].user_id,function(conv){$scope.posts[w].respuestas[contador].foto=conv[0].imagen_src})}(i,cont);delete $scope.posts[i].conversacion,$scope.posts[i].conversacion=[],$scope.posts[i].conv_cuenta++,$scope.posts[i].conv_cuenta<1&&($scope.posts[i].conv_cuenta="")}$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!1,$scope.quita_scroll=!1,id&&($scope.MuestraListadoFeeds=!0)})},$scope.getNConversacion=function(posts){var arr=[];for(var i in posts)arr[i]=posts[i],arr[i]._id&&(arr[i].n_conv=arr[i].conversacion[1]?arr[i].conversacion[1].conv_cuenta:arr[i].conversacion[0].conv_cuenta,arr[i].conversacion[1]?arr[i].conversacion.splice(1,1):arr[i].conversacion.splice(0,1))},$scope.getResueltos=function(filtro,organizacion){$scope.hayPost=!0,"undefined"==typeof organizacion&&(organizacion=""),"undefined"==typeof filtro&&(filtro=""),$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!0,$scope.MuestraListadoFeeds=!1,$scope.quita_scroll=!1;var id=$scope.authentication.user.cuenta._id,cuentaData=0;$http.get("/getMailboxResuelto/"+id+"?eltipo="+filtro+"&organizacion="+organizacion).success(function(data){$scope.posts=data,"undefined"!=typeof data.length?$scope.hayPost=!0:$scope.hayPost=!1,"undefined"!=typeof data.length&&(cuentaData=data.length-1,$scope.fechas=data[cuentaData].fecha,delete $scope.posts[cuentaData],$scope.posts=$scope.posts.filter(function(){return!0}),$scope.aux=$scope.posts);for(var i in $scope.posts)$scope.posts[i].conversacion&&$scope.posts[i].conversacion.splice(0,$scope.posts[i].conversacion.length),$scope.posts[i]._id&&($scope.posts[i].conv_cuenta++,$scope.posts[i].conv_cuenta<1&&($scope.posts[i].conv_cuenta="")),$scope.posts[i]._id?!function(w){$scope.getUserPhoto($scope.posts[w].atendido.usuario_id,function(conv){conv[0]&&conv[0].hasOwnProperty("imagen_src")===!0?$scope.posts[w].atendido.usuario_foto=conv[0].imagen_src:$scope.posts[w].atendido.usuario_foto=null})}(i):delete $scope.posts[i];$scope.muestraLoadingPrimario=!1})},$scope.$on("eventRegresaMailbox",function(e,item){console.log("regresando mailbox !!!"),console.log(item),item.descartado&&$scope.regresarDescartado(item._id),item.atendido&&$scope.regresarResuelto(item)}),$scope.regresarDescartado=function(id){console.log("Entro a regresarDescatado !"),Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:id}),$http.post("/regresarDescartado",{col:Authentication.user.cuenta.marca+"_consolidada",id:id}).success(function(data){console.log(data),data.ok&&$scope.muestraFlash("El mensaje está como nuevo"),console.log($scope.tipoBuzon);var obj_actualizar={_id:id,regresa:!0,cuenta:$scope.authentication.user.cuenta.marca,tipoBuzon:$scope.tipoBuzon};console.log("Llamando a tiempoRealServer"),Socket.emit("tiempoRealServer",obj_actualizar)}).error(function(err){console.log("ERROR !!!"),console.log(err)})},$scope.regresarResuelto=function(twit){console.log("Entro a regresarResuelto !"),Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:twit._id}),$http.post("/regresarResuelto",{col:Authentication.user.cuenta.marca+"_consolidada",twit:twit}).success(function(data){data.ok&&$scope.muestraFlash("El mensaje está como nuevo"),console.log($scope.tipoBuzon);var obj_actualizar={_id:twit._id,regresa:!0,cuenta:$scope.authentication.user.cuenta.marca,tipoBuzon:$scope.tipoBuzon};console.log("Llamando a tiempoRealServer"),Socket.emit("tiempoRealServer",obj_actualizar)})},$scope.getMailboxProceso=function(filtro,organizacion){"undefined"==typeof organizacion&&(organizacion=""),"undefined"==typeof filtro&&(filtro=""),$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!0;var cuentaData=0,id=$scope.authentication.user.cuenta._id;$http.get("/getMailboxProceso/"+id+"?eltipo="+filtro+"&organizacion="+organizacion).success(function(data){$scope.posts=data,"undefined"!=typeof data.length?$scope.hayPost=!0:$scope.hayPost=!1,"undefined"!=typeof data.length&&(cuentaData=data.length-1,$scope.fechas=data[cuentaData].fecha,delete $scope.posts[cuentaData],$scope.posts=$scope.posts.filter(function(){return!0}),$scope.aux=$scope.posts);for(var i in $scope.posts){if($scope.posts[i].conversacion&&$scope.posts[i].conversacion.splice(0,$scope.posts[i].conversacion.length),$scope.posts[i]._id&&($scope.posts[i].conv_cuenta++,$scope.posts[i].conv_cuenta<1&&($scope.posts[i].conv_cuenta="")),"undefined"!=typeof $scope.posts[i].respuestas)for(var cont in $scope.posts[i].respuestas)$scope.posts[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto($scope.posts[w].respuestas[contador].user_id,function(conv){conv[0]&&conv[0].hasOwnProperty("imagen_src")===!0?$scope.posts[w].respuestas[contador].foto=conv[0].imagen_src:$scope.posts[w].respuestas[contador].foto=[]})}(i,cont);$scope.posts[i]._id||delete $scope.posts[i]}$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!1})},$scope.getDescartados=function(filtro,organizacion){"undefined"==typeof organizacion&&(organizacion=""),"undefined"==typeof filtro&&(filtro=""),$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!0;var cuentaData=0,id=$scope.authentication.user.cuenta._id;$http.get("/getMailboxDescartados/"+id+"?eltipo="+filtro+"&organizacion="+organizacion).success(function(data){$scope.posts=data,"undefined"!=typeof data.length?$scope.hayPost=!0:$scope.hayPost=!1,"undefined"!=typeof data.length&&(cuentaData=data.length-1,$scope.fechas=data[cuentaData].fecha,delete $scope.posts[cuentaData],$scope.posts=$scope.posts.filter(function(){return!0}),$scope.aux=$scope.posts);for(var i in $scope.posts){if($scope.posts[i].conversacion&&$scope.posts[i].conversacion.splice(0,$scope.posts[i].conversacion.length),$scope.posts[i]._id&&($scope.posts[i].conv_cuenta++,$scope.posts[i].conv_cuenta<1&&($scope.posts[i].conv_cuenta="")),"undefined"!=typeof $scope.posts[i].respuestas)for(var cont in $scope.posts[i].respuestas)$scope.posts[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto($scope.posts[w].respuestas[contador].user_id,function(conv){"undefined"!=typeof conv[0].imagen_src?$scope.posts[w].respuestas[contador].foto=conv[0].imagen_src:$scope.posts[w].respuestas[contador].foto="/modules/core/img/usuario-sem-imagem.png"})}(i,cont);$scope.posts[i]._id?!function(w){$scope.getUserPhoto($scope.posts[w].descartado.idUsuario,function(conv){"undefined"!=typeof conv[0]?$scope.posts[w].descartado.usuario_foto=conv[0].imagen_src:$scope.posts[w].descartado.usuario_foto="/modules/core/img/usuario-sem-imagem.png"})}(i):delete $scope.posts[i]}$scope.muestraLoading=!1,$scope.muestraLoadingPrimario=!1})},$scope.$on("actualizaPost",function(event,selectedItem){$scope.act(selectedItem)}),$scope.act_nuevobuzon=function(twit){switch(twit.tipoMensaje){case"todos":break;case"asignados":break;case"atendidos":break;case"descartados":break;case"nuevos":}},$scope.act=function(twit){},$scope.clasesNotificaciones="",$scope.notificacionesOcultas=!0,$scope.abrirNotificaciones=function(){},$scope.mostrarSelectorRed=!1,$scope.textoSelectorRed="Redes",$scope.seleccionarRed=function(){$scope.mostrarSelectorRed===!0?$scope.mostrarSelectorRed=!1:$scope.mostrarSelectorRed=!0},$scope.mostrarSelectorBandeja=!1,$scope.textoSelectorBandeja="Bandejas",$scope.seleccionarBandeja=function(){$scope.mostrarSelectorBandeja===!0?$scope.mostrarSelectorBandeja=!1:$scope.mostrarSelectorBandeja=!0},$("body").click(function(e){
var id=e.target.id;""!==id?("comboBandeja"!==id&&($scope.mostrarSelectorBandeja=!1),"comboRedes"!==id&&($scope.mostrarSelectorRed=!1)):($scope.mostrarSelectorBandeja=!1,$scope.mostrarSelectorRed=!1)})}]).controller("ModalDemoCtrl",["$scope","$modal","$http","$location","$log","$resource","Authentication","Socket","$rootScope","CONSTANT",function($scope,$modal,$http,$location,$log,$resource,Authentication,Socket,$rootScope,CONSTANT){$scope.terminar=function(){$scope.close()},$scope.$on("finalizarCtrlLast",function(event,item){$scope.$emit("finalizarCtrl",item)}),$scope.textos={tema:"Tema",subtema:"Subtema"},$scope.constant=CONSTANT,$scope.getUserPhoto=function(id_usuario,callback){null===id_usuario&&(id_usuario=""),"direct-facebook"!==id_usuario&&""!==id_usuario&&$http.get("/getUserData?userId="+id_usuario).success(function(data){callback(data)})},$scope.asignarMensaje=function(tweet){console.log($scope.authentication.user);var modalInstance=$modal.open({templateUrl:"modalAsignar.html",controller:"ModalAsignarCtrl",windowClass:"modal fade in",size:"lg",backdrop:"static",keyboard:!1,backdropClick:!1,resolve:{mensaje:function(){return tweet},usuarios:function(){return $scope.authentication=Authentication,$http.get("/usuarios?cuenta="+$scope.authentication.user.cuenta.marca+"&user="+$scope.authentication.user._id).success(function(users){return console.log(users),$scope.usuarios_cuenta=users,$scope.usuarios_cuenta})}}});modalInstance.result.then(function(selectedUser){console.log("El usuario elegido es "),console.log(selectedUser),(selectedUser.influencers||selectedUser.asignado)&&(console.log("Eliminando notificacion"),Socket.emit("eliminaNotificacion",selectedUser._id))},function(selectedUser){Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:selectedUser._id}),$log.info("Modal dismissed at: "+new Date)})},$scope.open=function(tweet){console.log(tweet),$scope.tweet=[tweet];var modalInstance=$modal.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",windowClass:"modal fade in",size:"lg",backdrop:"static",keyboard:!1,backdropClick:!1,resolve:{items:function(){return $scope.tweet},temas:function(){$scope.authentication=Authentication;var service_temas=$resource("/cuentas/getTemas/:tema",{tema:"@tema"});return service_temas.get({tema:$scope.authentication.user.cuenta.marca},function(data){return $scope.temas=data[0],$scope.temas})}}});modalInstance.result.then(function(selectedItem){delete selectedItem.conversacion,selectedItem.conversacion=new Array,$scope.$emit("actualizaPost",selectedItem),$scope.selected=selectedItem,Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:selectedItem._id}),(selectedItem.influencer||selectedItem.asignado)&&(console.log("Eliminando notificacion"),Socket.emit("eliminaNotificacion",selectedItem._id))},function(selectedItem){Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:selectedItem._id}),$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}},$scope.openNuevo=function(tweet){$scope.items=[tweet];var modalInstance=$modal.open({templateUrl:"nuevoInfluencers.html",controller:"ModalInstanceCtrl",size:150,resolve:{items:function(){return $scope.items},temas:function(){$scope.authentication=Authentication;var service_temas=$resource("/cuentas/getTemas/:tema",{tema:"@tema"});return service_temas.get({tema:$scope.authentication.user.cuenta.marca},function(data){return $scope.temas=data[0],$scope.temas})}}});modalInstance.result.then(function(data){$scope.$emit("informacionInfluencers",data)},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.openNotificacion=function(notificacion){$scope.tweet=[notificacion];var modalInstance=$modal.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:150,backdrop:"static",keyboard:!1,backdropClick:!1,resolve:{items:function(){return $http.get("getOneContent?colec="+notificacion.coleccion+"&mo_id="+notificacion.mongo_id).success(function(data){return data.mo_id=notificacion._id,data})},temas:function(){$scope.authentication=Authentication;var service_temas=$resource("/cuentas/getTemas/:tema",{tema:"@tema"});return service_temas.get({tema:$scope.authentication.user.cuenta.marca},function(data){return $scope.temas=data[0],$scope.temas})}}});modalInstance.result.then(function(selectedItem){console.log("Entrando a resolve modal !!!!"),console.log(selectedItem),$scope.$emit("actualizaPost",selectedItem),(selectedItem.influencers||selectedItem.asignado)&&(console.log("Eliminando notificacion"),Socket.emit("eliminaNotificacion",selectedItem._id))},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.openDescartados=function(tweet){console.log(tweet),$scope.tweet=[tweet];var modalInstance=$modal.open({templateUrl:"descartados.html",controller:"ModalInstanceCtrl",size:150,resolve:{items:function(){return $scope.tweet},temas:function(){$scope.authentication=Authentication;var service_temas=$resource("/cuentas/getTemas/:tema",{tema:"@tema"});return service_temas.get({tema:$scope.authentication.user.cuenta.marca},function(data){return $scope.temas=data[0],$scope.temas})}}});modalInstance.result.then(function(selectedItem){$scope.$emit("actualizaPost",selectedItem),$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}},$scope.openRegresaDescartados=function(tweet){var modalInstance=$modal.open({templateUrl:"regresaDescartado.html",controller:"ModalInstanceCtrl",size:750,resolve:{items:function(){return[tweet]},temas:function(){return tweet}}});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.openOrigin=function(tweet){}}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance","items","temas","$resource","$http","Accounts","Authentication","Socket","$rootScope","$modal","$timeout","CONSTANT",function($scope,$modalInstance,items,temas,$resource,$http,Accounts,Authentication,Socket,$rootScope,$modal,$timeout,CONSTANT){function regexSupplant(regex,flags){return flags=flags||"","string"!=typeof regex&&(regex.global&&flags.indexOf("g")<0&&(flags+="g"),regex.ignoreCase&&flags.indexOf("i")<0&&(flags+="i"),regex.multiline&&flags.indexOf("m")<0&&(flags+="m"),regex=regex.source),new RegExp(regex.replace(/#\{(\w+)\}/g,function(match,name){var newRegex=$scope.regexen[name]||"";return"string"!=typeof newRegex&&(newRegex=newRegex.source),newRegex}),flags)}function stringSupplant(str,values){return str.replace(/#\{(\w+)\}/g,function(match,name){return values[name]||""})}function addCharsToCharClass(charClass,start,end){var s=String.fromCharCode(start);return end!==start&&(s+="-"+String.fromCharCode(end)),charClass.push(s),charClass}function clone(o){var r={};for(var k in o)o.hasOwnProperty(k)&&(r[k]=o[k]);return r}function isValidMatch(string,regex,optional){return optional?!string||string.match(regex)&&RegExp["$&"]===string:"string"==typeof string&&string.match(regex)&&RegExp["$&"]===string}$scope.textos={tema:"Tema",subtema:"Subtema"},$scope.listaIndustry=["Anuncios & Marketing","Artes & Entretenimiento","Auto","Negocios","Computadoras & Electronicos","Bienes de consumo envasados","Citas","Familia y Maternidad","Servicios Financieros","Fitness & Perdida de peso","Comida & Bebidas","Juegos","Hobbies / Intereses","Casa & Jardin","Trabajos & Educación","Ley, Gobierno & Politicas","Media","Sin fines de lucro","Regalos","Mascotas","Farmaceutica & Cuidado de la Salud","Real Estate","Religion & Espiritualidad","Retail","Software","Estilo, Moda & Belleza","Telecomunicaciones","Viajes","Deportes"],$scope.listaIndustry.sort(),$scope.listaIndustry.push("Otro"),$scope.constant=CONSTANT,$scope.items=items,$scope.authentication=Authentication,$scope.habilit=!0,$scope.nuevo_tema_activo=!0,$scope.nuevo_subtema_activo=!0,$scope.temas={},$scope.notSorted=function(obj){return obj?Object.keys(obj):[]},temas.$promise&&temas.$promise.then(function(data){var temas_ordenados=_.sortBy(data,"tema"),count=0;for(var i in temas_ordenados)temas_ordenados[i].tema&&($scope.temas[count]=temas_ordenados[i],count++)}),$scope.single={},$scope.cambio="Atender",$scope.texto_completar="Resolver",$scope.texto_aceptar="Aceptar",$scope.authentication=Authentication,$scope.statusLoginFacebook=!1,"undefined"!=typeof $scope.authentication.user.additionalProvidersData&&($scope.statusLoginFacebook=!0),items[0]&&items[0].conv_cuenta>1?items[0].conversacion.length>1?$scope.carga=!1:$scope.carga=!0:$scope.carga=!1,items.data?(items.data.origen="notificacion",$scope.items[0]=items.data,$scope.actual_sentiment=$scope.items[0].sentiment):$scope.actual_sentiment=items[0].sentiment,$scope.selected={item:$scope.items};var datos_bloqueo={};if(datos_bloqueo.cuenta=$scope.authentication.user.cuenta.marca,datos_bloqueo.user=$scope.authentication.user.displayName,datos_bloqueo._id=items[0]._id,datos_bloqueo.user_image=$scope.authentication.user.imagen_src,Socket.emit("idBloquea",datos_bloqueo),$scope.sentiment=function(sentiment,id,col,real){$scope.back_sentiment=$scope.items[0].sentiment,real||(real="");var elemento;$scope.authentication.user.cuenta.marca+"_consolidada";switch(sentiment){case"positivo":elemento=angular.element(document.querySelector("#positivo-"+id)),elemento.addClass("positivo-activo"),elemento=angular.element(document.querySelector("#neutro-"+id)),elemento.removeClass("neutro-activo"),elemento=angular.element(document.querySelector("#negativo-"+id)),elemento.removeClass("negativo-activo");break;case"negativo":elemento=angular.element(document.querySelector("#positivo-"+id)),elemento.removeClass("positivo-activo"),elemento=angular.element(document.querySelector("#neutro-"+id)),elemento.removeClass("neutro-activo"),elemento=angular.element(document.querySelector("#negativo-"+id)),elemento.addClass("negativo-activo");break;case"neutro":elemento=angular.element(document.querySelector("#positivo-"+id)),elemento.removeClass("positivo-activo"),elemento=angular.element(document.querySelector("#neutro-"+id)),elemento.addClass("neutro-activo"),elemento=angular.element(document.querySelector("#negativo-"+id)),elemento.removeClass("negativo-activo")}if("real"===real){({twit:id,sentiment:sentiment,coleccion:col,user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id})}$scope.items[0]._id===id&&($scope.items[0].sentiment_actualizado=!0,$scope.items[0].sentiment=sentiment)},$scope.items[0].clasificacion&&"null"!==$scope.items[0].clasificacion&&"null"!==$scope.items[0].clasificacion?($scope.themeDefault=null!==$scope.items[0].clasificacion.tema?$scope.items[0].clasificacion.tema:$scope.textos.tema,$scope.subthemeDefault=null!==$scope.items[0].clasificacion.subtema?$scope.items[0].clasificacion.subtema:$scope.textos.subtema):($scope.themeDefault=$scope.textos.tema,$scope.subthemeDefault=$scope.textos.subtema),$scope.seleccionaTema=function(idTema,nombreTema){$scope.themeDefault=nombreTema,idTema="",nombreTema=""},$scope.addTheme=!1,$scope.muestra_mas_temas=!0,$scope.muestra_mas_subtemas=!0,$scope.getUserPhoto=function(id_usuario,callback){null===id_usuario&&(id_usuario=""),"direct-facebook"!==id_usuario&&""!==id_usuario&&$http.get("/getUserData?userId="+id_usuario).success(function(data){callback(data)})},$scope.cargaConversacion=function(post){$scope.carga=!1;var tipo;tipo=post.tipo?post.tipo:post.type,console.log;var urlConv="getHistPend?cont_id="+post._id+"&colec="+post.coleccion+"&us_id="+post.from_user_id+"&created="+post.created_time+"&mtp="+tipo;if(post.parent_post){var parent=post.parent_post;urlConv="getHistPend?cont_id="+post._id+"&colec="+post.coleccion+"&us_id="+post.from_user_id+"&created="+post.created_time+"&mtp="+tipo+"&parent="+parent}$http.get(urlConv).success(function(data){console.log("Resultado de leer mas"),console.log(data);for(var i in data.conversacion)if(data.conversacion[i]._id!==$scope.items[0]._id&&$scope.items[0].conversacion.push(data.conversacion[i]),"undefined"!=typeof data.conversacion[i].respuestas)for(var cont in data.conversacion[i].respuestas)data.conversacion[i].respuestas[cont].tipo="respuesta",data.conversacion[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto(data.conversacion[w].respuestas[contador].user_id,function(conv){data.conversacion[w].respuestas[contador].foto=conv[0].imagen_src})}(i,cont)})},$scope.cargaConversacionCompletos=function(post){$scope.carga=!1;var tipo;tipo=post.type?post.type:post.tipo;var urlConv="getMoreComplete?cont_id="+post._id+"&colec="+post.coleccion+"&us_id="+post.from_user_id+"&created="+post.created_time+"&mtp="+tipo;if(post.parent_post){var parent=post.parent_post;urlConv="getMoreComplete?cont_id="+post._id+"&colec="+post.coleccion+"&us_id="+post.from_user_id+"&created="+post.created_time+"&mtp="+tipo+"&parent="+parent}$http.get(urlConv).success(function(data){for(var i in data.conversacion)if(data.conversacion[i]._id!==$scope.items[0]._id&&$scope.items[0].conversacion.push(data.conversacion[i]),"undefined"!=typeof data.conversacion[i].respuestas)for(var cont in data.conversacion[i].respuestas)data.conversacion[i].respuestas[cont].tipo="respuesta",data.conversacion[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto(data.conversacion[w].respuestas[contador].user_id,function(conv){data.conversacion[w].respuestas[contador].foto=conv[0].imagen_src})}(i,cont)})},$scope.cargaConversacionDescartados=function(post){$scope.carga=!1;var tipo;tipo=post.type?post.type:post.tipo;var urlConv="getMoreDescartados?cont_id="+post._id+"&colec="+post.coleccion+"&us_id="+post.from_user_id+"&created="+post.created_time+"&mtp="+tipo;if(post.parent_post){var parent=post.parent_post;urlConv="getMoreDescartados?cont_id="+post._id+"&colec="+post.coleccion+"&us_id="+post.from_user_id+"&created="+post.created_time+"&mtp="+tipo+"&parent="+parent}$http.get(urlConv).success(function(data){for(var i in data.conversacion)if(data.conversacion[i]._id!==$scope.items[0]._id&&$scope.items[0].conversacion.push(data.conversacion[i]),"undefined"!=typeof data.conversacion[i].respuestas)for(var cont in data.conversacion[i].respuestas)data.conversacion[i].respuestas[cont].tipo="respuesta",data.conversacion[i].respuestas[cont].foto="/modules/core/img/usuario-sem-imagem.png",function(w,contador){$scope.getUserPhoto(data.conversacion[w].respuestas[contador].user_id,function(conv){data.conversacion[w].respuestas[contador].foto=conv[0].imagen_src})}(i,cont)})},$scope.addThemeClick=function(){$scope.addTheme===!0?($scope.muestra_mas_temas=!0,$scope.addTheme=!1):($scope.addTheme=!0,$scope.muestra_mas_temas=!1,$timeout(function(){$(angular.element(document.querySelector("#txtTema"))).focus()}))},$scope.cerrarCrearTema=function(){$scope.addTheme=!1},$scope.addSubTheme=!1,$scope.addSubThemeClick=function(){$scope.addSubTheme===!0?($scope.muestra_mas_subtemas=!0,$scope.addSubTheme=!1):($scope.addSubTheme=!0,$timeout(function(){$(angular.element(document.querySelector("#txtSubTema"))).focus()}))},$scope.cerrarCrearSubtema=function(){$scope.addSubTheme=!1},$scope.mensajeRespuesta="",$scope.agregarRespuesta=function(){var tema="",subtema="";"Tema"!==$scope.themeDefault&&(tema=$scope.themeDefault),"Subtema"!==$scope.subthemeDefault&&(subtema=$scope.subthemeDefault);var response=$scope.respuesta.trim();0===response.length?$scope.mensajeRespuesta="No hay respuesta para añadir":$http.post("/cuentas/insertRespuesta",{tema:tema,subtema:subtema,respuesta:$scope.respuesta,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){1===data?$scope.mensajeRespuesta="La respuesta ya existe":2===data?$scope.mensajeRespuesta="No se ha seleccionado ningún tema para asignar la respuesta":3===data?$scope.mensajeRespuesta="Ocurrio un error al añadir la respuesta":4===data?$scope.mensajeRespuesta="Ocurrió un error al buscar el tema":5===data?$scope.mensajeRespuesta="Algo raro sucedió: pareciera que el subtema seleccionado no existe":($scope.responseThemes=data,$scope.mensajeRespuesta="La respuesta ha sido añadida")})},$scope.cambioSelect=function(req,res){$scope.respuesta="",$scope.themeDefault=req,$scope.tema=req,$scope.habilit=!1,$scope.nuevo_tema_activo=!0,$scope.nuevo_subtema_activo=!0;var id_selected=$scope.themeDefault;for(var i in $scope.temas)if($scope.temas[i].tema===id_selected){var subtemas=($scope.temas[i],{});for(var j in $scope.temas[i].subtemas)subtemas[j]={nombre:$scope.temas[i].subtemas[j].subtema};$scope.subtemas=_.sortBy(subtemas,"nombre")}$scope.subthemeDefault=$scope.textos.subtema,$scope.muestraRespuestasSubtemas=!1,$scope.respuestasTemas()},$scope.muestraRespuestasTemas=!1,$scope.responseThemes=[],$scope.resInfo="",$scope.respuesta="",$scope.informacionRespuesta=function(resp){$scope.respuesta?($scope.respuesta="",$scope.faltanteMensaje=140,"twitter"===$scope.items[0].obj&&($scope.respuesta+="@"+$scope.items[0].user.screen_name+" "),$scope.respuesta+=resp,$scope.faltanteMensaje=$scope.faltanteMensaje-$scope.respuesta.length):("twitter"===$scope.items[0].obj&&"twit"===$scope.items[0].tipo&&($scope.respuesta+="@"+$scope.items[0].user.screen_name+" "),$scope.respuesta+=resp,$scope.faltanteMensaje=$scope.faltanteMensaje-$scope.respuesta.length)},$scope.respuestasTemas=function(){var temaActual=$scope.themeDefault;$scope.muestraRespuestasTemas=!0,$http.post("/cuentas/getRespuestasTemas",{temaActual:temaActual,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){$scope.responseThemes=data})},$scope.muestraRespuestasSubtemas=!1,$scope.respuestasSubTemas=function(){var subtemaActual=$scope.subthemeDefault,temaActual=$scope.themeDefault;$scope.muestraRespuestasSubtemas=!0,$http.post("/cuentas/getRespuestasSubtemas",{subtemaActual:subtemaActual,temaActual:temaActual,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){var cuenta=data.length;0!==cuenta?$scope.muestraRespuestasTemas=!1:$scope.muestraRespuestasTemas=!0,$scope.responseSubThemes=data})},$scope.cambioRadioSubtema=function(nombreSubtema){$scope.subtema=nombreSubtema,$scope.subthemeDefault=nombreSubtema,$scope.subtema=nombreSubtema,$scope.respuestasSubTemas()},$scope.agregarTema=function(req,res){var temaNuevo=$scope.tema_nuevo;"undefined"==typeof temaNuevo&&(temaNuevo=""),temaNuevo=temaNuevo.trim(),0===temaNuevo.length?$scope.mensaje_server="El tema ingresado está vacío":$http.post("/cuentas/getTemas",{tema:$scope.tema_nuevo,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){var contador=0;data._id?(contador=Object.keys($scope.temas).length,$scope.temas[contador]={_id:data._id,tema:data.tema},$scope.nuevo_tema_activo=!0,$scope.nuevo_subtema_activo=!0,$scope.mensaje_server="Tema creado correctamente",$scope.addTheme=!1,$scope.tema_nuevo="",$scope.themeDefault=data.tema,$scope.cambioSelect(data.tema)):($scope.mensaje_server="El tema "+temaNuevo+" ya existe",$scope.tema_nuevo="")})},$scope.agregarSubtema=function(req,res){var newSubtema=$scope.subtema_nuevo;if("undefined"==typeof newSubtema&&(newSubtema=""),newSubtema.trim(),0===newSubtema.length)$scope.mensaje_server_subtema="El subtema ingresado está vacío";else{var subtemas={};$scope.subtemas={};var guardado,existe=!1;for(var i in $scope.temas)if($scope.temas[i].tema===$scope.themeDefault){if(void 0===$scope.temas[i].subtemas)$scope.temas[i].subtemas=[{subtema:$scope.subtema_nuevo}],$scope.subthemeDefault=$scope.subtema_nuevo,$scope.addSubTheme=!1;else{for(var k in $scope.temas[i].subtemas)$scope.temas[i].subtemas[k].subtema===$scope.subtema_nuevo&&(existe=!0);existe?$scope.mensaje_server_subtema="El subtema ya existe":($scope.temas[i].subtemas.push({subtema:$scope.subtema_nuevo}),$scope.subthemeDefault=$scope.subtema_nuevo,$scope.addSubTheme=!1)}for(var j in $scope.temas[i].subtemas)subtemas[j]={nombre:$scope.temas[i].subtemas[j].subtema};guardado=$scope.temas[i],$scope.subtemas=subtemas}$http.post("/setSub",{_id:guardado.tema,subtema_nuevo:$scope.subtema_nuevo,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){}),$scope.subtema_nuevo=""}},$scope.ok=function(req){$modalInstance.close()},$scope.close=function(req){Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:req._id}),$modalInstance.close()},$scope.faltanteMensaje=140,$scope.advertenciaLimiteMensaje=!1,$scope.focus_area=function(){"twitter"===$scope.items[0].obj&&("direct_message"!==$scope.items[0].tipo&&($scope.respuesta||($scope.respuesta+="@"+$scope.items[0].user.screen_name+" ",$scope.faltanteMensaje=$scope.faltanteMensaje-($scope.items[0].user.screen_name.length+1))),$scope.faltanteMensaje<0?$scope.advertenciaLimiteMensaje=!0:$scope.advertenciaLimiteMensaje=!1)},$scope.faceConnect=function(id){Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:id})},"undefined"==typeof twttr||null===twttr)var twttr={};twttr.txt={},$scope.regexen={};var HTML_ENTITIES={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};$scope.htmlEscape=function(text){return text&&text.replace(/[&"'><]/g,function(character){return HTML_ENTITIES[character]})},$scope.regexSupplant=regexSupplant,$scope.stringSupplant=stringSupplant,$scope.addCharsToCharClass=addCharsToCharClass;var fromCode=String.fromCharCode,UNICODE_SPACES=[fromCode(32),fromCode(133),fromCode(160),fromCode(5760),fromCode(6158),fromCode(8232),fromCode(8233),fromCode(8239),fromCode(8287),fromCode(12288)];addCharsToCharClass(UNICODE_SPACES,9,13),addCharsToCharClass(UNICODE_SPACES,8192,8202);var INVALID_CHARS=[fromCode(65534),fromCode(65279),fromCode(65535)];addCharsToCharClass(INVALID_CHARS,8234,8238),$scope.regexen.spaces_group=regexSupplant(UNICODE_SPACES.join("")),$scope.regexen.spaces=regexSupplant("["+UNICODE_SPACES.join("")+"]"),$scope.regexen.invalid_chars_group=regexSupplant(INVALID_CHARS.join("")),$scope.regexen.punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/,$scope.regexen.rtl_chars=/[\u0600-\u06FF]|[\u0750-\u077F]|[\u0590-\u05FF]|[\uFE70-\uFEFF]/gm,$scope.regexen.non_bmp_code_pairs=/[\uD800-\uDBFF][\uDC00-\uDFFF]/gm;var latinAccentChars=[];addCharsToCharClass(latinAccentChars,192,214),addCharsToCharClass(latinAccentChars,216,246),addCharsToCharClass(latinAccentChars,248,255),addCharsToCharClass(latinAccentChars,256,591),addCharsToCharClass(latinAccentChars,595,596),addCharsToCharClass(latinAccentChars,598,599),addCharsToCharClass(latinAccentChars,601,601),addCharsToCharClass(latinAccentChars,603,603),addCharsToCharClass(latinAccentChars,611,611),addCharsToCharClass(latinAccentChars,616,616),addCharsToCharClass(latinAccentChars,623,623),addCharsToCharClass(latinAccentChars,626,626),addCharsToCharClass(latinAccentChars,649,649),addCharsToCharClass(latinAccentChars,651,651),addCharsToCharClass(latinAccentChars,699,699),addCharsToCharClass(latinAccentChars,768,879),addCharsToCharClass(latinAccentChars,7680,7935),$scope.regexen.latinAccentChars=regexSupplant(latinAccentChars.join(""));var unicodeLettersAndMarks="A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ̀-ͯ҃-҉֑-ׇֽֿׁׂׅׄؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࣤ-ःऺ-़ा-ॏ॑-ॗॢॣঁ-ঃ়া-ৄেৈো-্ৗৢৣਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑੰੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣஂா-ூெ-ைொ-்ௗఀ-ఃా-ౄె-ైొ-్ౕౖౢౣಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣഁ-ഃാ-ൄെ-ൈൊ-്ൗൢൣංඃ්ා-ුූෘ-ෟෲෳัิ-ฺ็-๎ັິ-ູົຼ່-ໍ༹༘༙༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᦰ-ᧀᧈᧉᨗ-ᨛᩕ-ᩞ᩠-᩿᩼᪰-᪾ᬀ-ᬄ᬴-᭄᭫-᭳ᮀ-ᮂᮡ-ᮭ᯦-᯳ᰤ-᰷᳐-᳔᳒-᳨᳭ᳲ-᳴᳸᳹᷀-᷵᷼-᷿⃐-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꙯-꙲ꙴ-꙽ꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-꣄꣠-꣱ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀ꧥꨩ-ꨶꩃꩌꩍꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭ﬞ︀-️︠-︭",unicodeNumbers="0-9٠-٩۰-۹߀-߉०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯෦-෯๐-๙໐-໙༠-༩၀-၉႐-႙០-៩᠐-᠙᥆-᥏᧐-᧙᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙꘠-꘩꣐-꣙꤀-꤉꧐-꧙꧰-꧹꩐-꩙꯰-꯹０-９",hashtagSpecialChars="_‌‍꙾־׳״゛゜゠・〃་༌·";$scope.regexen.hashSigns=/[#＃]/,$scope.regexen.hashtagAlpha=new RegExp("["+unicodeLettersAndMarks+"]"),$scope.regexen.hashtagAlphaNumeric=new RegExp("["+unicodeLettersAndMarks+unicodeNumbers+hashtagSpecialChars+"]"),$scope.regexen.endHashtagMatch=regexSupplant(/^(?:#{hashSigns}|:\/\/)/),$scope.regexen.hashtagBoundary=new RegExp("(?:^|$|[^&"+unicodeLettersAndMarks+unicodeNumbers+hashtagSpecialChars+"])"),$scope.regexen.validHashtag=regexSupplant(/(#{hashtagBoundary})(#{hashSigns})(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi),$scope.regexen.validMentionPrecedingChars=/(?:^|[^a-zA-Z0-9_!#$%&*@＠]|(?:^|[^a-zA-Z0-9_+~.-])(?:rt|RT|rT|Rt):?)/,$scope.regexen.atSigns=/[@＠]/,$scope.regexen.validMentionOrList=regexSupplant("(#{validMentionPrecedingChars})(#{atSigns})([a-zA-Z0-9_]{1,20})(/[a-zA-Z][a-zA-Z0-9_-]{0,24})?","g"),$scope.regexen.validReply=regexSupplant(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/),$scope.regexen.endMentionMatch=regexSupplant(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/),$scope.regexen.validUrlPrecedingChars=regexSupplant(/(?:[^A-Za-z0-9@＠$#＃#{invalid_chars_group}]|^)/),$scope.regexen.invalidUrlWithoutProtocolPrecedingChars=/[-_.\/]$/,$scope.regexen.invalidDomainChars=stringSupplant("#{punct}#{spaces_group}#{invalid_chars_group}",$scope.regexen),$scope.regexen.validDomainChars=regexSupplant(/[^#{invalidDomainChars}]/),$scope.regexen.validSubdomain=regexSupplant(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/),$scope.regexen.validDomainName=regexSupplant(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/),$scope.regexen.validGTLD=regexSupplant(RegExp("(?:(?:abbott|abogado|academy|accountant|accountants|active|actor|ads|adult|aero|afl|agency|airforce|allfinanz|alsace|amsterdam|android|apartments|aquarelle|archi|army|arpa|asia|associates|attorney|auction|audio|autos|axa|band|bank|bar|barclaycard|barclays|bargains|bauhaus|bayern|bbc|beer|berlin|best|bid|bike|bingo|bio|biz|black|blackfriday|bloomberg|blue|bmw|bnpparibas|boats|bond|boo|boutique|brussels|budapest|build|builders|business|buzz|bzh|cab|cafe|cal|camera|camp|cancerresearch|canon|capetown|capital|caravan|cards|care|career|careers|cartier|casa|cash|casino|cat|catering|cbn|center|ceo|cern|cfd|channel|chat|cheap|chloe|christmas|chrome|church|citic|city|claims|cleaning|click|clinic|clothing|club|coach|codes|coffee|college|cologne|com|community|company|computer|condos|construction|consulting|contractors|cooking|cool|coop|country|courses|credit|creditcard|cricket|crs|cruises|cuisinella|cymru|cyou|dabur|dad|dance|date|dating|datsun|day|dclk|deals|degree|delivery|democrat|dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dnp|docs|doha|domains|doosan|download|durban|dvag|eat|edu|education|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|erni|esq|estate|eurovision|eus|events|everbank|exchange|expert|exposed|express|fail|faith|fan|fans|farm|fashion|feedback|film|finance|financial|firmdale|fish|fishing|fit|fitness|flights|florist|flowers|flsmidth|fly|foo|football|forex|forsale|foundation|frl|frogans|fund|furniture|futbol|gal|gallery|garden|gbiz|gdn|gent|ggee|gift|gifts|gives|glass|gle|global|globo|gmail|gmo|gmx|gold|goldpoint|golf|goo|goog|google|gop|gov|graphics|gratis|green|gripe|guge|guide|guitars|guru|hamburg|hangout|haus|healthcare|help|here|hermes|hiphop|hiv|holdings|holiday|homes|horse|host|hosting|house|how|ibm|ifm|immo|immobilien|industries|infiniti|info|ing|ink|institute|insure|int|international|investments|irish|iwc|java|jcb|jetzt|jewelry|jobs|joburg|juegos|kaufen|kddi|kim|kitchen|kiwi|koeln|komatsu|krd|kred|kyoto|lacaixa|land|lat|latrobe|lawyer|lds|lease|leclerc|legal|lgbt|lidl|life|lighting|limited|limo|link|loan|loans|london|lotte|lotto|love|ltda|luxe|luxury|madrid|maif|maison|management|mango|market|marketing|markets|marriott|media|meet|melbourne|meme|memorial|menu|miami|mil|mini|mma|mobi|moda|moe|monash|money|mormon|mortgage|moscow|motorcycles|mov|movie|mtn|mtpc|museum|nagoya|name|navy|net|network|neustar|new|news|nexus|ngo|nhk|nico|ninja|nissan|nra|nrw|ntt|nyc|okinawa|one|ong|onl|online|ooo|org|organic|osaka|otsuka|ovh|page|panerai|paris|partners|parts|party|pharmacy|photo|photography|photos|physio|piaget|pics|pictet|pictures|pink|pizza|place|plumbing|plus|pohl|poker|porn|post|praxi|press|pro|prod|productions|prof|properties|property|pub|qpon|quebec|racing|realtor|recipes|red|redstone|rehab|reise|reisen|reit|ren|rentals|repair|report|republican|rest|restaurant|review|reviews|rich|rio|rip|rocks|rodeo|rsvp|ruhr|ryukyu|saarland|sale|samsung|sap|sarl|saxo|sca|scb|schmidt|scholarships|school|schule|schwarz|science|scot|seat|services|sew|sex|sexy|shiksha|shoes|show|shriram|singles|site|sky|social|software|sohu|solar|solutions|sony|soy|space|spiegel|spreadbetting|study|style|sucks|supplies|supply|support|surf|surgery|suzuki|sydney|systems|taipei|tatar|tattoo|tax|team|tech|technology|tel|temasek|tennis|tickets|tienda|tips|tires|tirol|today|tokyo|tools|top|toshiba|tours|town|toys|trade|trading|training|travel|trust|tui|university|uno|uol|vacations|vegas|ventures|vermögensberater|vermögensberatung|versicherung|vet|viajes|video|villas|vision|vlaanderen|vodka|vote|voting|voto|voyage|wales|wang|watch|webcam|website|wed|wedding|weir|whoswho|wien|wiki|williamhill|win|wme|work|works|world|wtc|wtf|xerox|xin|xxx|xyz|yachts|yandex|yodobashi|yoga|yokohama|youtube|zip|zone|zuerich|дети|москва|онлайн|орг|рус|сайт|بازار|شبكة|موقع|संगठन|みんな|グーグル|世界|中信|中文网|企业|佛山|信息|健康|八卦|公司|公益|商城|商店|商标|在线|广东|慈善|我爱你|手机|政务|政府|时尚|机构|淡马锡|游戏|移动|组织机构|网址|网店|网络|谷歌|集团|飞利浦|삼성|onion)(?=[^0-9a-zA-Z@]|$))")),$scope.regexen.validCCTLD=regexSupplant(RegExp("(?:(?:ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bl|bm|bn|bo|bq|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mf|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|бел|мкд|мон|рф|срб|укр|қаз|հայ|الاردن|الجزائر|السعودية|المغرب|امارات|ایران|بھارت|تونس|سودان|سورية|عراق|عمان|فلسطين|قطر|مصر|مليسيا|پاکستان|भारत|বাংলা|ভারত|ਭਾਰਤ|ભારત|இந்தியா|இலங்கை|சிங்கப்பூர்|భారత్|ලංකා|ไทย|გე|中国|中國|台湾|台灣|新加坡|澳門|香港|한국)(?=[^0-9a-zA-Z@]|$))")),$scope.regexen.validPunycode=regexSupplant(/(?:xn--[0-9a-z]+)/),$scope.regexen.validSpecialCCTLD=regexSupplant(RegExp("(?:(?:co|tv)(?=[^0-9a-zA-Z@]|$))")),$scope.regexen.validDomain=regexSupplant(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/),$scope.regexen.validAsciiDomain=regexSupplant(/(?:(?:[\-a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi),$scope.regexen.invalidShortDomain=regexSupplant(/^#{validDomainName}#{validCCTLD}$/i),$scope.regexen.validSpecialShortDomain=regexSupplant(/^#{validDomainName}#{validSpecialCCTLD}$/i),$scope.regexen.validPortNumber=regexSupplant(/[0-9]+/),$scope.regexen.validGeneralUrlPathChars=regexSupplant(/[a-z0-9!\*';:=\+,\.\$\/%#\[\]\-_~@|&#{latinAccentChars}]/i),
$scope.regexen.validUrlBalancedParens=regexSupplant("\\((?:#{validGeneralUrlPathChars}+|(?:#{validGeneralUrlPathChars}*\\(#{validGeneralUrlPathChars}+\\)#{validGeneralUrlPathChars}*))\\)","i"),$scope.regexen.validUrlPathEndingChars=regexSupplant(/[\+\-a-z0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i),$scope.regexen.validUrlPath=regexSupplant("(?:(?:#{validGeneralUrlPathChars}*(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*#{validUrlPathEndingChars})|(?:@#{validGeneralUrlPathChars}+/))","i"),$scope.regexen.validUrlQueryChars=/[a-z0-9!?\*'@\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i,$scope.regexen.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i,$scope.regexen.extractUrl=regexSupplant("((#{validUrlPrecedingChars})((https?:\\/\\/)?(#{validDomain})(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?))","gi"),$scope.regexen.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i,$scope.regexen.urlHasProtocol=/^https?:\/\//i,$scope.regexen.urlHasHttps=/^https:\/\//i,$scope.regexen.cashtag=/[a-z]{1,6}(?:[._][a-z]{1,2})?/i,$scope.regexen.validCashtag=regexSupplant("(^|#{spaces})(\\$)(#{cashtag})(?=$|\\s|[#{punct}])","gi"),$scope.regexen.validateUrlUnreserved=/[a-z0-9\-._~]/i,$scope.regexen.validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i,$scope.regexen.validateUrlSubDelims=/[!$&'()*+,;=]/i,$scope.regexen.validateUrlPchar=regexSupplant("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|[:|@])","i"),$scope.regexen.validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i,$scope.regexen.validateUrlUserinfo=regexSupplant("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|:)*","i"),$scope.regexen.validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i,$scope.regexen.validateUrlIpv4=regexSupplant(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i),$scope.regexen.validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i,$scope.regexen.validateUrlIp=regexSupplant("(?:#{validateUrlIpv4}|#{validateUrlIpv6})","i"),$scope.regexen.validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i,$scope.regexen.validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i,$scope.regexen.validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i,$scope.regexen.validateUrlDomain=regexSupplant(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i),$scope.regexen.validateUrlHost=regexSupplant("(?:#{validateUrlIp}|#{validateUrlDomain})","i"),$scope.regexen.validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,$scope.regexen.validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,$scope.regexen.validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,$scope.regexen.validateUrlUnicodeDomain=regexSupplant(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i),$scope.regexen.validateUrlUnicodeHost=regexSupplant("(?:#{validateUrlIp}|#{validateUrlUnicodeDomain})","i"),$scope.regexen.validateUrlPort=/[0-9]{1,5}/,$scope.regexen.validateUrlUnicodeAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?(#{validateUrlUnicodeHost})(?::(#{validateUrlPort}))?","i"),$scope.regexen.validateUrlAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?(#{validateUrlHost})(?::(#{validateUrlPort}))?","i"),$scope.regexen.validateUrlPath=regexSupplant(/(\/#{validateUrlPchar}*)*/i),$scope.regexen.validateUrlQuery=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i),$scope.regexen.validateUrlFragment=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i),$scope.regexen.validateUrlUnencoded=regexSupplant("^(?:([^:/?#]+):\\/\\/)?([^/?#]*)([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$","i");var DEFAULT_LIST_CLASS="tweet-url list-slug",DEFAULT_USERNAME_CLASS="tweet-url username",DEFAULT_HASHTAG_CLASS="tweet-url hashtag",DEFAULT_CASHTAG_CLASS="tweet-url cashtag",OPTIONS_NOT_ATTRIBUTES={urlClass:!0,listClass:!0,usernameClass:!0,hashtagClass:!0,cashtagClass:!0,usernameUrlBase:!0,listUrlBase:!0,hashtagUrlBase:!0,cashtagUrlBase:!0,usernameUrlBlock:!0,listUrlBlock:!0,hashtagUrlBlock:!0,linkUrlBlock:!0,usernameIncludeSymbol:!0,suppressLists:!0,suppressNoFollow:!0,targetBlank:!0,suppressDataScreenName:!0,urlEntities:!0,symbolTag:!0,textWithSymbolTag:!0,urlTarget:!0,invisibleTagAttrs:!0,linkAttributeBlock:!0,linkTextBlock:!0,htmlEscapeNonEntities:!0},BOOLEAN_ATTRIBUTES={disabled:!0,readonly:!0,multiple:!0,checked:!0};$scope.tagAttrs=function(attributes){var htmlAttrs="";for(var k in attributes){var v=attributes[k];BOOLEAN_ATTRIBUTES[k]&&(v=v?k:null),null!=v&&(htmlAttrs+=" "+$scope.htmlEscape(k)+'="'+$scope.htmlEscape(v.toString())+'"')}return htmlAttrs},$scope.linkToText=function(entity,text,attributes,options){options.suppressNoFollow||(attributes.rel="nofollow"),options.linkAttributeBlock&&options.linkAttributeBlock(entity,attributes),options.linkTextBlock&&(text=options.linkTextBlock(entity,text));var d={text:text,attr:$scope.tagAttrs(attributes)};return stringSupplant("<a#{attr}>#{text}</a>",d)},$scope.linkToTextWithSymbol=function(entity,symbol,text,attributes,options){var taggedSymbol=options.symbolTag?"<"+options.symbolTag+">"+symbol+"</"+options.symbolTag+">":symbol;text=$scope.htmlEscape(text);var taggedText=options.textWithSymbolTag?"<"+options.textWithSymbolTag+">"+text+"</"+options.textWithSymbolTag+">":text;return options.usernameIncludeSymbol||!symbol.match($scope.regexen.atSigns)?$scope.linkToText(entity,taggedSymbol+taggedText,attributes,options):taggedSymbol+$scope.linkToText(entity,taggedText,attributes,options)},$scope.linkToHashtag=function(entity,text,options){var hash=text.substring(entity.indices[0],entity.indices[0]+1),hashtag=$scope.htmlEscape(entity.hashtag),attrs=clone(options.htmlAttrs||{});return attrs.href=options.hashtagUrlBase+hashtag,attrs.title="#"+hashtag,attrs["class"]=options.hashtagClass,hashtag.charAt(0).match($scope.regexen.rtl_chars)&&(attrs["class"]+=" rtl"),options.targetBlank&&(attrs.target="_blank"),$scope.linkToTextWithSymbol(entity,hash,hashtag,attrs,options)},$scope.linkToCashtag=function(entity,text,options){var cashtag=$scope.htmlEscape(entity.cashtag),attrs=clone(options.htmlAttrs||{});return attrs.href=options.cashtagUrlBase+cashtag,attrs.title="$"+cashtag,attrs["class"]=options.cashtagClass,options.targetBlank&&(attrs.target="_blank"),$scope.linkToTextWithSymbol(entity,"$",cashtag,attrs,options)},$scope.linkToMentionAndList=function(entity,text,options){var at=text.substring(entity.indices[0],entity.indices[0]+1),user=$scope.htmlEscape(entity.screenName),slashListname=$scope.htmlEscape(entity.listSlug),isList=entity.listSlug&&!options.suppressLists,attrs=clone(options.htmlAttrs||{});return attrs["class"]=isList?options.listClass:options.usernameClass,attrs.href=isList?options.listUrlBase+user+slashListname:options.usernameUrlBase+user,isList||options.suppressDataScreenName||(attrs["data-screen-name"]=user),options.targetBlank&&(attrs.target="_blank"),$scope.linkToTextWithSymbol(entity,at,isList?user+slashListname:user,attrs,options)},$scope.linkToUrl=function(entity,text,options){var url=entity.url,displayUrl=url,linkText=$scope.htmlEscape(displayUrl),urlEntity=options.urlEntities&&options.urlEntities[url]||entity;urlEntity.display_url&&(linkText=$scope.linkTextWithEntity(urlEntity,options));var attrs=clone(options.htmlAttrs||{});return url.match($scope.regexen.urlHasProtocol)||(url="http://"+url),attrs.href=url,options.targetBlank&&(attrs.target="_blank"),options.urlClass&&(attrs["class"]=options.urlClass),options.urlTarget&&(attrs.target=options.urlTarget),!options.title&&urlEntity.display_url&&(attrs.title=urlEntity.expanded_url),$scope.linkToText(entity,linkText,attrs,options)},$scope.linkTextWithEntity=function(entity,options){var displayUrl=entity.display_url,expandedUrl=entity.expanded_url,displayUrlSansEllipses=displayUrl.replace(/…/g,"");if(-1!=expandedUrl.indexOf(displayUrlSansEllipses)){var displayUrlIndex=expandedUrl.indexOf(displayUrlSansEllipses),v={displayUrlSansEllipses:displayUrlSansEllipses,beforeDisplayUrl:expandedUrl.substr(0,displayUrlIndex),afterDisplayUrl:expandedUrl.substr(displayUrlIndex+displayUrlSansEllipses.length),precedingEllipsis:displayUrl.match(/^…/)?"…":"",followingEllipsis:displayUrl.match(/…$/)?"…":""};for(var k in v)v.hasOwnProperty(k)&&(v[k]=$scope.htmlEscape(v[k]));return v.invisible=options.invisibleTagAttrs,stringSupplant("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>",v)}return displayUrl},$scope.autoLinkEntities=function(text,entities,options){options=clone(options||{}),options.hashtagClass=options.hashtagClass||DEFAULT_HASHTAG_CLASS,options.hashtagUrlBase=options.hashtagUrlBase||"https://twitter.com/#!/search?q=%23",options.cashtagClass=options.cashtagClass||DEFAULT_CASHTAG_CLASS,options.cashtagUrlBase=options.cashtagUrlBase||"https://twitter.com/#!/search?q=%24",options.listClass=options.listClass||DEFAULT_LIST_CLASS,options.usernameClass=options.usernameClass||DEFAULT_USERNAME_CLASS,options.usernameUrlBase=options.usernameUrlBase||"https://twitter.com/",options.listUrlBase=options.listUrlBase||"https://twitter.com/",options.htmlAttrs=$scope.extractHtmlAttrsFromOptions(options),options.invisibleTagAttrs=options.invisibleTagAttrs||"style='position:absolute;left:-9999px;'";var urlEntities,i,len;if(options.urlEntities){for(urlEntities={},i=0,len=options.urlEntities.length;len>i;i++)urlEntities[options.urlEntities[i].url]=options.urlEntities[i];options.urlEntities=urlEntities}var result="",beginIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});for(var nonEntity=options.htmlEscapeNonEntities?$scope.htmlEscape:function(text){return text},i=0;i<entities.length;i++){var entity=entities[i];result+=nonEntity(text.substring(beginIndex,entity.indices[0])),entity.url?result+=$scope.linkToUrl(entity,text,options):entity.hashtag?result+=$scope.linkToHashtag(entity,text,options):entity.screenName?result+=$scope.linkToMentionAndList(entity,text,options):entity.cashtag&&(result+=$scope.linkToCashtag(entity,text,options)),beginIndex=entity.indices[1]}return result+=nonEntity(text.substring(beginIndex,text.length))},$scope.autoLinkWithJSON=function(text,json,options){if(json.user_mentions)for(var i=0;i<json.user_mentions.length;i++)json.user_mentions[i].screenName=json.user_mentions[i].screen_name;if(json.hashtags)for(var i=0;i<json.hashtags.length;i++)json.hashtags[i].hashtag=json.hashtags[i].text;if(json.symbols)for(var i=0;i<json.symbols.length;i++)json.symbols[i].cashtag=json.symbols[i].text;var entities=[];for(var key in json)entities=entities.concat(json[key]);return $scope.modifyIndicesFromUnicodeToUTF16(text,entities),$scope.autoLinkEntities(text,entities,options)},$scope.extractHtmlAttrsFromOptions=function(options){var htmlAttrs={};for(var k in options){var v=options[k];OPTIONS_NOT_ATTRIBUTES[k]||(BOOLEAN_ATTRIBUTES[k]&&(v=v?k:null),null!=v&&(htmlAttrs[k]=v))}return htmlAttrs},$scope.autoLink=function(text,options){var entities=$scope.extractEntitiesWithIndices(text,{extractUrlsWithoutProtocol:!1});return $scope.autoLinkEntities(text,entities,options)},$scope.autoLinkUsernamesOrLists=function(text,options){var entities=$scope.extractMentionsOrListsWithIndices(text);return $scope.autoLinkEntities(text,entities,options)},$scope.autoLinkHashtags=function(text,options){var entities=$scope.extractHashtagsWithIndices(text);return $scope.autoLinkEntities(text,entities,options)},$scope.autoLinkCashtags=function(text,options){var entities=$scope.extractCashtagsWithIndices(text);return $scope.autoLinkEntities(text,entities,options)},$scope.autoLinkUrlsCustom=function(text,options){var entities=$scope.extractUrlsWithIndices(text,{extractUrlsWithoutProtocol:!1});return $scope.autoLinkEntities(text,entities,options)},$scope.removeOverlappingEntities=function(entities){entities.sort(function(a,b){return a.indices[0]-b.indices[0]});for(var prev=entities[0],i=1;i<entities.length;i++)prev.indices[1]>entities[i].indices[0]?(entities.splice(i,1),i--):prev=entities[i]},$scope.extractEntitiesWithIndices=function(text,options){var entities=$scope.extractUrlsWithIndices(text,options).concat($scope.extractMentionsOrListsWithIndices(text)).concat($scope.extractHashtagsWithIndices(text,{checkUrlOverlap:!1})).concat($scope.extractCashtagsWithIndices(text));return 0==entities.length?[]:($scope.removeOverlappingEntities(entities),entities)},$scope.extractMentions=function(text){for(var screenNamesOnly=[],screenNamesWithIndices=$scope.extractMentionsWithIndices(text),i=0;i<screenNamesWithIndices.length;i++){var screenName=screenNamesWithIndices[i].screenName;screenNamesOnly.push(screenName)}return screenNamesOnly},$scope.extractMentionsWithIndices=function(text){for(var mentionOrList,mentions=[],mentionsOrLists=$scope.extractMentionsOrListsWithIndices(text),i=0;i<mentionsOrLists.length;i++)mentionOrList=mentionsOrLists[i],""==mentionOrList.listSlug&&mentions.push({screenName:mentionOrList.screenName,indices:mentionOrList.indices});return mentions},$scope.extractMentionsOrListsWithIndices=function(text){if(!text||!text.match($scope.regexen.atSigns))return[];var possibleNames=[];return text.replace($scope.regexen.validMentionOrList,function(match,before,atSign,screenName,slashListname,offset,chunk){var after=chunk.slice(offset+match.length);if(!after.match($scope.regexen.endMentionMatch)){slashListname=slashListname||"";var startPosition=offset+before.length,endPosition=startPosition+screenName.length+slashListname.length+1;possibleNames.push({screenName:screenName,listSlug:slashListname,indices:[startPosition,endPosition]})}}),possibleNames},$scope.extractReplies=function(text){if(!text)return null;var possibleScreenName=text.match($scope.regexen.validReply);return!possibleScreenName||RegExp.rightContext.match($scope.regexen.endMentionMatch)?null:possibleScreenName[1]},$scope.extractUrls=function(text,options){for(var urlsOnly=[],urlsWithIndices=$scope.extractUrlsWithIndices(text,options),i=0;i<urlsWithIndices.length;i++)urlsOnly.push(urlsWithIndices[i].url);return urlsOnly},$scope.extractUrlsWithIndices=function(text,options){if(options||(options={extractUrlsWithoutProtocol:!0}),!text||(options.extractUrlsWithoutProtocol?!text.match(/\./):!text.match(/:/)))return[];for(var urls=[];$scope.regexen.extractUrl.exec(text);){var before=RegExp.$2,url=RegExp.$3,protocol=RegExp.$4,domain=RegExp.$5,path=RegExp.$7,endPosition=$scope.regexen.extractUrl.lastIndex,startPosition=endPosition-url.length;if(protocol)url.match($scope.regexen.validTcoUrl)&&(url=RegExp.lastMatch,endPosition=startPosition+url.length),urls.push({url:url,indices:[startPosition,endPosition]});else{if(!options.extractUrlsWithoutProtocol||before.match($scope.regexen.invalidUrlWithoutProtocolPrecedingChars))continue;var lastUrl=null,asciiEndPosition=0;if(domain.replace($scope.regexen.validAsciiDomain,function(asciiDomain){var asciiStartPosition=domain.indexOf(asciiDomain,asciiEndPosition);asciiEndPosition=asciiStartPosition+asciiDomain.length,lastUrl={url:asciiDomain,indices:[startPosition+asciiStartPosition,startPosition+asciiEndPosition]},(path||asciiDomain.match($scope.regexen.validSpecialShortDomain)||!asciiDomain.match($scope.regexen.invalidShortDomain))&&urls.push(lastUrl)}),null==lastUrl)continue;path&&(lastUrl.url=url.replace(domain,lastUrl.url),lastUrl.indices[1]=endPosition)}}return urls},$scope.extractHashtags=function(text){for(var hashtagsOnly=[],hashtagsWithIndices=$scope.extractHashtagsWithIndices(text),i=0;i<hashtagsWithIndices.length;i++)hashtagsOnly.push(hashtagsWithIndices[i].hashtag);return hashtagsOnly},$scope.extractHashtagsWithIndices=function(text,options){if(options||(options={checkUrlOverlap:!0}),!text||!text.match($scope.regexen.hashSigns))return[];var tags=[];if(text.replace($scope.regexen.validHashtag,function(match,before,hash,hashText,offset,chunk){var after=chunk.slice(offset+match.length);if(!after.match($scope.regexen.endHashtagMatch)){var startPosition=offset+before.length,endPosition=startPosition+hashText.length+1;tags.push({hashtag:hashText,indices:[startPosition,endPosition]})}}),options.checkUrlOverlap){var urls=$scope.extractUrlsWithIndices(text);if(urls.length>0){var entities=tags.concat(urls);$scope.removeOverlappingEntities(entities),tags=[];for(var i=0;i<entities.length;i++)entities[i].hashtag&&tags.push(entities[i])}}return tags},$scope.extractCashtags=function(text){for(var cashtagsOnly=[],cashtagsWithIndices=$scope.extractCashtagsWithIndices(text),i=0;i<cashtagsWithIndices.length;i++)cashtagsOnly.push(cashtagsWithIndices[i].cashtag);return cashtagsOnly},$scope.extractCashtagsWithIndices=function(text){if(!text||-1==text.indexOf("$"))return[];var tags=[];return text.replace($scope.regexen.validCashtag,function(match,before,dollar,cashtag,offset,chunk){var startPosition=offset+before.length,endPosition=startPosition+cashtag.length+1;tags.push({cashtag:cashtag,indices:[startPosition,endPosition]})}),tags},$scope.modifyIndicesFromUnicodeToUTF16=function(text,entities){$scope.convertUnicodeIndices(text,entities,!1)},$scope.modifyIndicesFromUTF16ToUnicode=function(text,entities){$scope.convertUnicodeIndices(text,entities,!0)},$scope.getUnicodeTextLength=function(text){return text.replace($scope.regexen.non_bmp_code_pairs," ").length},$scope.convertUnicodeIndices=function(text,entities,indicesInUTF16){if(0!=entities.length){var charIndex=0,codePointIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});for(var entityIndex=0,entity=entities[0];charIndex<text.length;){if(entity.indices[0]==(indicesInUTF16?charIndex:codePointIndex)){var len=entity.indices[1]-entity.indices[0];if(entity.indices[0]=indicesInUTF16?codePointIndex:charIndex,entity.indices[1]=entity.indices[0]+len,entityIndex++,entityIndex==entities.length)break;entity=entities[entityIndex]}var c=text.charCodeAt(charIndex);c>=55296&&56319>=c&&charIndex<text.length-1&&(c=text.charCodeAt(charIndex+1),c>=56320&&57343>=c&&charIndex++),codePointIndex++,charIndex++}}},$scope.splitTags=function(text){for(var secondSplits,split,firstSplits=text.split("<"),allSplits=[],i=0;i<firstSplits.length;i+=1)if(split=firstSplits[i]){secondSplits=split.split(">");for(var j=0;j<secondSplits.length;j+=1)allSplits.push(secondSplits[j])}else allSplits.push("");return allSplits},$scope.hitHighlight=function(text,hits,options){var defaultHighlightTag="em";if(hits=hits||[],options=options||{},0===hits.length)return text;var i,j,index,hit,tag,placed,hitSpot,tagName=options.tag||defaultHighlightTag,tags=["<"+tagName+">","</"+tagName+">"],chunks=$scope.splitTags(text),result="",chunkIndex=0,chunk=chunks[0],prevChunksLen=0,chunkCursor=0,startInChunk=!1,chunkChars=chunk,flatHits=[];for(i=0;i<hits.length;i+=1)for(j=0;j<hits[i].length;j+=1)flatHits.push(hits[i][j]);for(index=0;index<flatHits.length;index+=1){for(hit=flatHits[index],tag=tags[index%2],placed=!1;null!=chunk&&hit>=prevChunksLen+chunk.length;)result+=chunkChars.slice(chunkCursor),startInChunk&&hit===prevChunksLen+chunkChars.length&&(result+=tag,placed=!0),chunks[chunkIndex+1]&&(result+="<"+chunks[chunkIndex+1]+">"),prevChunksLen+=chunkChars.length,chunkCursor=0,chunkIndex+=2,chunk=chunks[chunkIndex],chunkChars=chunk,startInChunk=!1;placed||null==chunk?placed||(placed=!0,result+=tag):(hitSpot=hit-prevChunksLen,result+=chunkChars.slice(chunkCursor,hitSpot)+tag,chunkCursor=hitSpot,startInChunk=index%2===0?!0:!1)}if(null!=chunk)for(chunkCursor<chunkChars.length&&(result+=chunkChars.slice(chunkCursor)),index=chunkIndex+1;index<chunks.length;index+=1)result+=index%2===0?chunks[index]:"<"+chunks[index]+">";return result};var MAX_LENGTH=140,INVALID_CHARACTERS=[fromCode(65534),fromCode(65279),fromCode(65535),fromCode(8234),fromCode(8235),fromCode(8236),fromCode(8237),fromCode(8238)];$scope.getTweetLength=function(text,options){options||(options={short_url_length:22,short_url_length_https:23});var textLength=$scope.getUnicodeTextLength(text),urlsWithIndices=$scope.extractUrlsWithIndices(text);$scope.modifyIndicesFromUTF16ToUnicode(text,urlsWithIndices);for(var i=0;i<urlsWithIndices.length;i++)textLength+=urlsWithIndices[i].indices[0]-urlsWithIndices[i].indices[1],textLength+=urlsWithIndices[i].url.toLowerCase().match($scope.regexen.urlHasHttps)?options.short_url_length_https:options.short_url_length;return textLength},$scope.isInvalidTweet=function(text){return text?$scope.getTweetLength(text)>MAX_LENGTH?"too_long":$scope.hasInvalidCharacters(text)?"invalid_characters":!1:"empty"},$scope.hasInvalidCharacters=function(text){for(var i=0;i<INVALID_CHARACTERS.length;i++)if(text.indexOf(INVALID_CHARACTERS[i])>=0)return!0;return!1},$scope.isValidTweetText=function(text){return!$scope.isInvalidTweet(text)},$scope.isValidUsername=function(username){if(!username)return!1;var extracted=$scope.extractMentions(username);return 1===extracted.length&&extracted[0]===username.slice(1)};var VALID_LIST_RE=regexSupplant(/^#{validMentionOrList}$/);if($scope.isValidList=function(usernameList){var match=usernameList.match(VALID_LIST_RE);return!(!match||""!=match[1]||!match[4])},$scope.isValidHashtag=function(hashtag){if(!hashtag)return!1;var extracted=$scope.extractHashtags(hashtag);return 1===extracted.length&&extracted[0]===hashtag.slice(1)},$scope.isValidUrl=function(url,unicodeDomains,requireProtocol){if(null==unicodeDomains&&(unicodeDomains=!0),null==requireProtocol&&(requireProtocol=!0),!url)return!1;var urlParts=url.match($scope.regexen.validateUrlUnencoded);if(!urlParts||urlParts[0]!==url)return!1;var scheme=urlParts[1],authority=urlParts[2],path=urlParts[3],query=urlParts[4],fragment=urlParts[5];return(!requireProtocol||isValidMatch(scheme,$scope.regexen.validateUrlScheme)&&scheme.match(/^https?$/i))&&isValidMatch(path,$scope.regexen.validateUrlPath)&&isValidMatch(query,$scope.regexen.validateUrlQuery,!0)&&isValidMatch(fragment,$scope.regexen.validateUrlFragment,!0)?unicodeDomains&&isValidMatch(authority,$scope.regexen.validateUrlUnicodeAuthority)||!unicodeDomains&&isValidMatch(authority,$scope.regexen.validateUrlAuthority):!1},"undefined"!=typeof module&&module.exports&&(module.exports=twttr.txt),"function"==typeof define&&define.amd&&define([],twttr.txt),"undefined"!=typeof window)if(window.twttr)for(var prop in twttr)window.twttr[prop]=twttr[prop];else window.twttr=twttr;$scope.textChange=function(req,res){var limite=140;$scope.faltanteMensaje=limite-$scope.getTweetLength($scope.respuesta),$scope.faltanteMensaje<0?($scope.advertenciaLimiteMensaje=!0,$scope.deshabilita=!0):($scope.advertenciaLimiteMensaje=!1,$scope.deshabilita=!1)},$scope.respondeMensaje=function(tipoCuenta,tipoRespuesta){if($scope.items[0].descartado)return void($scope.respuesta_server="No puedes clasificar un descartado");var coleccion=Authentication.user.cuenta.marca+"_consolidada";$scope.items[0].clasificacion={tema:$scope.themeDefault,subtema:$scope.subthemeDefault},$scope.items[0].clasificacion.tema===$scope.textos.tema?delete $scope.items[0].clasificacion:$scope.items[0].clasificacion.subtema===$scope.textos.subtema&&($scope.items[0].clasificacion.subtema=""),("undefined"==typeof $scope.respuesta||null===$scope.respuesta)&&($scope.respuesta="");var criterio={coleccion:coleccion,mensaje:items[0],clasificacion:$scope.items[0].clasificacion,sentiment:$scope.items[0].sentiment,usuario:Authentication.user,imagenUsuario:Authentication.user.imagen_src,idMensaje:$scope.items[0]._id,tipoRedSocial:tipoCuenta,tipoMensajeRedSocial:tipoRespuesta,respuesta:$scope.respuesta,timestamp:new Date,nombreSistema:Authentication.user.cuenta.marca,account_id:Authentication.user.cuenta._id};console.log("Criterio de respuesta !"),console.log(criterio),$scope.items[0].clasificacion&&$scope.items[0].sentiment?(console.log(items[0]),$http.post("/respondeMailbox",criterio).success(function(data){if(data.error||data.errorface)if(data.error){if("facebook"===data.tipo)if(100===data.error.code||1705===data.error.code)$scope.respuesta_server="Este post ya fue eliminado por el usuario";else if(190===data.error.code)$scope.respuesta_server="No tienes permiso para contestar esta publicacion";else switch(data.error.message){case"The access token could not be decrypted":$scope.respuesta_server="Error de acceso: Favor de volverte a firmar en Facebook";break;case"No administras esta pagina":$scope.respuesta_server="No cuentas con permisos para administrar esta página y no puedes responder";break;case"Error en respuesta de facebook, intenta mas tarde":$scope.respuesta_server="Error en respuesta de facebook, intenta mas tarde";break;case"(#200) Permissions error":$scope.respuesta_server="El mensaje no se ha podido responder tal vez haya sido eliminado de Facebook";break;default:$scope.respuesta_server="Error desconocido favor de contactar al administrador"}else if("twitter"===data.tipo&&data.error.code)switch(data.error.code.toString()){case"187":console.log("error code 187"),$scope.respuesta_server="No se pudo responder: Respuesta duplicada";break;case"186":console.log("error code 186");break;case"32":console.log("error code 32"),$scope.respuesta_server="No pudimos conectar con Twitter, favor de revisar la conexión de la cuenta";break;case"151":console.log("error code 151"),$scope.respuesta_server="El mensaje que se trata de enviar está vacío, favor de verificarlo";break;default:$scope.respuesta_server=data.error.message}}else data.errorface&&($scope.respuesta_server=data.errorface);else{$scope.items[0].imagenUsuario=Authentication.user.imagen_src,$rootScope.$broadcast("finalizarCtrl",$scope.items[0]),($scope.items[0].influencers||$scope.items[0].asignado)&&(console.log("Eliminando la notificacion !!! "),Socket.emit("eliminaNotificacion",$scope.items[0]._id));var answer={texto:$scope.respuesta,user_name:Authentication.user.displayName,user_id:Authentication.user._id,timestamp:new Date};console.log("AUTHENTICACION !!!!"),console.log(Authentication.user);var obj_actualizar={_id:$scope.items[0]._id,mensajeBuzon:$scope.items[0].tipoMensaje,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,answer:answer,user:$scope.authentication.user._id,username:Authentication.user.username,user_image:Authentication.user.imagen_src,cuenta:$scope.authentication.user.cuenta.marca,tipoBuzon:$scope.tipoBuzon};Socket.emit("tiempoRealServer",obj_actualizar),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])}})):($scope.error_post="No se puede completar sin clasificación",console.log("No tiene clasificacion"))},$scope.responder=function(param){$scope.deshabilita=!0,$scope.items[0].clasificacion={tema:$scope.themeDefault,subtema:$scope.subthemeDefault},$scope.items[0].clasificacion.tema===$scope.textos.tema?delete $scope.items[0].clasificacion:$scope.items[0].clasificacion.subtema===$scope.textos.subtema&&($scope.items[0].clasificacion.subtema="");var cerrar=!0,elemento=angular.copy($scope.items[0]);delete elemento.conversacion;var clas={};if(param){if(!$scope.items[0].clasificacion||!$scope.items[0].sentiment)return $scope.items[0].clasificacion?$scope.items[0].sentiment?$scope.error_post="No tiene clasificacion":$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",$scope.deshabilita=!1,0;console.log("Contesta sin problemas")}if(""!==$scope.respuesta&&"undefined"!==$scope.respuesta&&null!==$scope.respuesta){clas={tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id,hora:new Date};var respuesta=$scope.respuesta;$http.post("/respTwit",{item_id:elemento._id,respuesta:respuesta,coleccion:Authentication.user.cuenta.marca+"_consolidada",clas:clas,id_cuenta:Authentication.user.cuenta._id,id_str:elemento.id_str}).success(function(data){var response=data;if(console.log("status del envío en twitter"),console.log(response),response.code)switch(response.code.toString()){case"187":console.log("error code 187"),$scope.respuesta_server="No se pudo responder: Respuesta duplicada",cerrar=!1;break;case"186":console.log("error code 186"),$scope.respuesta_server="No se pudo responder: Sobrepasas los 140 caracteres permitidos",cerrar=!1;break;default:$scope.respuesta_server=response.message,cerrar=!1}if(cerrar){if(param){if($scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),!$scope.items[0].clasificacion||!$scope.items[0].sentiment)return $scope.items[0].clasificacion?$scope.error_post="No tiene clasificacion":$scope.items[0].sentiment?$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",void($scope.deshabilita=!1);$rootScope.$broadcast("finalizarCtrl",$scope.items[0]),($scope.items[0].influencers||$scope.items[0].asignado)&&Socket.emit("eliminaNotificacion",$scope.items[0]._id)}$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){});var answer={texto:respuesta,user_name:Authentication.user.displayName,user_id:Authentication.user._id,timestamp:new Date},obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,answer:answer,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:items[0]._id}),($scope.items[0].sentiment||$scope.items[0].clasificacion)&&($scope.items[0].influencers||$scope.items[0].asignado)&&Socket.emit("eliminaNotificacion",$scope.items[0]._id),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])}})}else{param&&($http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),$rootScope.$broadcast("finalizarCtrl",$scope.items[0]),($scope.items[0].influencers||$scope.items[0].asignado)&&Socket.emit("eliminaNotificacion",$scope.items[0]._id)),clas={tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id},$scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),"Tema"!==$scope.themeDefault&&$http.post("/insertaClasificacion",{id:$scope.items[0]._id,coleccion:Authentication.user.cuenta.marca+"_consolidada",clas:clas}).success(function(data){var obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:items[0]._id}),($scope.items[0].influencers||$scope.items[0].asignado)&&Socket.emit("eliminaNotificacion",$scope.items[0]._id),$modalInstance.close($scope.items[0])}).error(function(resp){console.log("Error!"),
console.log(resp)});var obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:items[0]._id}),($scope.items[0].sentiment||$scope.items[0].clasificacion)&&($scope.items[0].influencers||$scope.items[0].asignado)&&Socket.emit("eliminaNotificacion",$scope.items[0]._id),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])}},$scope.respondeDMTwitter=function(param){$scope.deshabilita=!0,$scope.items[0].clasificacion={tema:$scope.themeDefault,subtema:$scope.subthemeDefault},$scope.items[0].clasificacion.tema===$scope.textos.tema?delete $scope.items[0].clasificacion:$scope.items[0].clasificacion.subtema===$scope.textos.subtema&&($scope.items[0].clasificacion.subtema="");var elemento=angular.copy($scope.items[0]);delete elemento.conversacion;var cerrar=!0,clas={};if(param&&(!$scope.items[0].clasificacion||!$scope.items[0].sentiment))return $scope.items[0].clasificacion?$scope.items[0].sentiment?$scope.error_post="No tiene clasificacion":$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",void($scope.deshabilita=!1);if(""!==$scope.respuesta&&"undefined"!==$scope.respuesta&&null!==$scope.respuesta)clas={tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id,tiempo:new Date},$http.post("/respDM",{clas:clas,respuesta:$scope.respuesta,coleccion:Authentication.user.cuenta.marca+"_consolidada",item:elemento,sentiment:$scope.items[0].sentiment,cuenta:Authentication.user.cuenta._id}).success(function(data){if($scope.items[0].clasificacion={tema:$scope.themeDefault,subtema:$scope.subthemeDefault},data.code&&(cerrar=!1,$scope.respuesta_server=data.message),cerrar){$scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),param&&$rootScope.$broadcast("finalizarCtrl",$scope.items[0]);var answer={texto:$scope.respuesta,user_name:Authentication.user.displayName,user_id:Authentication.user._id,timestamp:new Date},obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,answer:answer,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:$scope.items[0]._id}),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])}});else{if(param){if($scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),!$scope.items[0].clasificacion||!$scope.items[0].sentiment)return $scope.items[0].clasificacion?$scope.error_post="No tiene clasificacion":$scope.items[0].sentiment?$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",void($scope.deshabilita=!1);$rootScope.$broadcast("finalizarCtrl",$scope.items[0])}clas={tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id},"Tema"!==$scope.themeDefault&&$http.post("/insertaClasificacion",{id:$scope.items[0]._id,coleccion:Authentication.user.cuenta.marca+"_consolidada",clas:clas}).success(function(data){var obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar)}).error(function(resp){console.log("Error!"),console.log(resp)}),$scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){});var obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),cerrar&&(Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:$scope.items[0]._id}),$scope.deshabilita=!1,$modalInstance.close($scope.items[0]))}},$scope.respondeInboxFb=function(param){$scope.deshabilita=!0,$scope.items[0].clasificacion={tema:$scope.themeDefault,subtema:$scope.subthemeDefault},$scope.items[0].clasificacion.tema===$scope.textos.tema?delete $scope.items[0].clasificacion:$scope.items[0].clasificacion.subtema===$scope.textos.subtema&&($scope.items[0].clasificacion.subtema="");var elemento=angular.copy($scope.items[0]);if(delete elemento.conversacion,param&&(!$scope.items[0].clasificacion||!$scope.items[0].sentiment))return $scope.items[0].clasificacion?$scope.items[0].sentiment?$scope.error_post="No tiene clasificacion":$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",void($scope.deshabilita=!1);if(""!==$scope.respuesta&&"undefined"!==$scope.respuesta&&null!==$scope.respuesta){var data_extra={tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id,nombreSistema:Authentication.user.cuenta.marca};if(Authentication.user.additionalProvidersData.facebook.accessToken){console.log("Entro con accessToken");var fbobject=Authentication.user.additionalProvidersData.facebook;data_extra.fb_usid=fbobject.id;var a_t=fbobject.accessToken,colectione=Authentication.user.cuenta.marca+"_consolidada",account_id=Authentication.user.cuenta._id;$http.post("/respondeInbox",{obj:elemento,respuesta:$scope.respuesta,coleccion:colectione,id:account_id,access_user:a_t,extra:data_extra}).success(function(data){if(data.error||data.errorface)data.errorface?$scope.respuesta_server=data.errorface:$scope.respuesta_server="El usuario no tiene permisos para responder";else{$scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),param&&$rootScope.$broadcast("finalizarCtrl",$scope.items[0]);var answer={texto:$scope.respuesta,user_name:Authentication.user.displayName,user_id:Authentication.user._id,timestamp:new Date},obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,answer:answer,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:$scope.items[0]._id}),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])}})}else console.log("no tiene accessToken")}else{if($scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),param){if(!$scope.items[0].clasificacion||!$scope.items[0].sentiment)return $scope.items[0].clasificacion?$scope.error_post="No tiene clasificacion":$scope.items[0].sentiment?$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",void($scope.deshabilita=!1);$rootScope.$broadcast("finalizarCtrl",$scope.items[0])}var clas={tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id,sentiment:$scope.items[0].sentiment};"Tema"!==$scope.themeDefault&&$http.post("/insertaClasificacion",{id:$scope.items[0]._id,coleccion:Authentication.user.cuenta.marca+"_consolidada",clas:clas}).success(function(data){});var obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:$scope.items[0].sentiment,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:$scope.items[0]._id}),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])}},$scope.respondePostFb=function(param){$scope.deshabilita=!0;var acceso;$scope.items[0].clasificacion={tema:$scope.themeDefault,subtema:$scope.subthemeDefault},$scope.items[0].clasificacion.tema===$scope.textos.tema?delete $scope.items[0].clasificacion:$scope.items[0].clasificacion.subtema===$scope.textos.subtema&&($scope.items[0].clasificacion.subtema="");var elemento=angular.copy($scope.items[0]);if(delete elemento.conversacion,param){if(!$scope.items[0].clasificacion||!$scope.items[0].sentiment)return $scope.items[0].clasificacion?$scope.items[0].sentiment?$scope.error_post="No tiene clasificacion":$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",void($scope.deshabilita=!1);console.log("Contesta sin problemas")}if(""!==$scope.respuesta&&"undefined"!==$scope.respuesta&&null!==$scope.respuesta){var id_cuenta=$scope.authentication.user.cuenta._id,service=$resource("/accounts/:accountId",{accountId:"@id"});service.get({accountId:id_cuenta},function(data){var id_page=data.datosPage.id,url="https://graph.facebook.com"+$scope.constant.fbapiversion+"me/accounts?access_token="+$scope.authentication.user.additionalProvidersData.facebook.accessToken;$http.get(url).success(function(respuesta){for(var i=($scope.items[0].id.split("_"),0);i<respuesta.data.length;i++)respuesta.data[i].id===id_page&&(acceso=respuesta.data[i].access_token);console.log("Accesos de la cuenta de Facebook para responder!"),console.log(acceso);var parent,respuesta_scope=$scope.respuesta;parent=$scope.items[0].parent_comment===$scope.items[0].parent_post?$scope.items[0].id:$scope.items[0].parent_comment?$scope.items[0].parent_comment:$scope.items[0].id,respuesta_scope=encodeURIComponent(respuesta_scope);var url_responder="https://graph.facebook.com"+$scope.constant.fbapiversion+parent+"/comments?message="+respuesta_scope+"&access_token="+acceso;$http.post(url_responder).success(function(resp){console.log("Respuesta de la solicitud de respuesta post"),console.log(resp);var obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar),param&&$rootScope.$broadcast("finalizarCtrl",$scope.items[0]);var hora=new Date,clas={tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id};$http.post("/respFb",{id:elemento.id,resp:$scope.respuesta,coleccion:Authentication.user.cuenta.marca+"_consolidada",clas:clas,tiempo:hora,id_cuenta:$scope.authentication.user.cuenta._id,id_str:resp.id,id_post:$scope.items[0]._id}).success(function(data){$scope.response="Respuesta enviada correctamente.";var answer={texto:respuesta_scope,user_name:Authentication.user.displayName,user_id:Authentication.user._id,timestamp:new Date},obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:items[0].sentiment,answer:answer,user:$scope.authentication.user._id,cuenta:$scope.authentication.user.cuenta.marca};$scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),Socket.emit("actualizaClasificacion",obj_actualizar),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])})}).error(function(resp){console.log("Error de facebook !! "),console.log(resp),$scope.deshabilita=!1,100===resp.error.code||1705===resp.error.code?$scope.respuesta_server="Este post ya fue eliminado por el usuario":190===resp.error.code?$scope.respuesta_server="No tienes permiso para contestar esta publicacion":$scope.respuesta_server=resp.error.message})})})}else{if(param){if(!$scope.items[0].clasificacion||!$scope.items[0].sentiment)return $scope.items[0].clasificacion?$scope.items[0].sentiment?$scope.error_post="No tiene clasificacion":$scope.error_post="No tiene sentiment":$scope.error_post="No tiene clasificacion",void($scope.deshabilita=!1);$rootScope.$broadcast("finalizarCtrl",$scope.items[0])}var obj_actualizar={_id:$scope.items[0]._id,tema:$scope.themeDefault,subtema:$scope.subthemeDefault,sentiment:$scope.items[0].sentiment};Socket.emit("actualizaClasificacion",obj_actualizar);var beto={id:elemento._id,coleccion:Authentication.user.cuenta.marca+"_consolidada",tema:$scope.themeDefault,subtema:$scope.subthemeDefault,clas:{tema:$scope.themeDefault,subtema:$scope.subthemeDefault,username:Authentication.user.displayName,userid:Authentication.user._id}};"Tema"!==$scope.themeDefault&&$http.post("/insertaClasificacion",beto),$scope.deshabilita=!1,$modalInstance.close($scope.items[0])}$scope.items[0].clasificacion={tema:$scope.themeDefault,subtema:$scope.subthemeDefault},$scope.items[0].sentiment&&$http.post("/sentiment",{twit:$scope.items[0]._id,sentiment:$scope.items[0].sentiment,coleccion:Authentication.user.cuenta.marca+"_consolidada",user_name:$scope.authentication.user.displayName,user_id:$scope.authentication.user._id}).success(function(data){}),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:$scope.items[0]._id})},$scope.elimina_post=!1,$scope.deletePost=function(){console.log("Checked !!!"),console.log($scope.elimina_post),$scope.mensajeDescartado=""},$scope.cambiaMotivo=function(motivo){$scope.descarte=motivo,"spam"===$scope.descarte?($scope.elimina_post=!0,$scope.mensajeDescartado=""):($scope.elimina_post=!1,$scope.mensajeDescartado="")},$scope.guardaDescarte=function(red,tipo){var cerrar=!1,descartado=$scope.descarte,idUsuario=$scope.authentication.user._id,username=$scope.authentication.user.username,imagenUsuario=$scope.authentication.user.imagen_src,idPost=$scope.items[0]._id,idFbPost=$scope.items[0].id,idFacebook="",accessToken="",elimina="";elimina="facebook"===red&&"facebook_inbox"!==tipo?$scope.elimina_post:!1,Authentication.user.additionalProvidersData?(idFacebook=Authentication.user.additionalProvidersData.facebook.id,accessToken=Authentication.user.additionalProvidersData.facebook.accessToken):(idFacebook="",accessToken="");var criterio={descartado:descartado,idUsuario:idUsuario,username:username,cuenta:$scope.authentication.user.cuenta.id,coleccion:$scope.authentication.user.cuenta.marca+"_consolidada",idPost:idPost,eliminar:elimina,razon_eliminar:$scope.texto_eliminado,fb_usid:idFacebook,fb_usat:accessToken,nombreSistema:Authentication.user.cuenta.marca,id_fb_post:idFbPost,imagenUsuario:imagenUsuario};"undefined"==typeof descartado?$scope.mensajeDescartado="No se ha seleccionado ninguna razón":""===idFacebook&&""===accessToken&&elimina===!0?$scope.mensajeDescartado="Para descartar el mensaje debes administrar la fan page":$scope.items[0].length?(console.log("Accion por lote"),delete criterio.idPost,delete criterio.eliminar,delete criterio.id_fb_post,delete criterio.razon_eliminar,delete criterio.fb_usid,delete criterio.fb_usa,criterio.lote=$scope.items[0],$http.post("/descartadoLote",criterio).success(function(data){if(console.log(data),data.length>0&&(cerrar=!0),cerrar){for(var i=0;i<data.length;i++){console.log("Liberando ocupado "),console.log(data),Socket.emit("eliminaNotificacion",data[i]),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:data[i]});var obj_actualizar_descartado={username:Authentication.user.displayName,cuenta:Authentication.user.cuenta.marca,_id:data[i],descartado:{idUsuario:idUsuario,motivo:descartado,usuario:username,usuario_foto:Authentication.user.imagen_src}};Socket.emit("tiempoRealServer",obj_actualizar_descartado);var obj_actualizar={descartado:!0,_id:data[i],user:Authentication.user._id,cuenta:Authentication.user.cuenta.marca};Socket.emit("actualizaClasificacion",obj_actualizar)}$modalInstance.close(data)}})):(console.log("Accion individual"),$http.post("/descartado",criterio).success(function(data){if(($scope.items[0].influencers||$scope.items[0].asignado)&&(console.log("Eliminando la notificacion !!! "),Socket.emit("eliminaNotificacion",idPost)),console.log("EL RRETORNO DE DESCARTE"),console.log(data),"noPage_access_token"===data.error?($scope.mensajeDescartado="Necesitas ser administrador para eliminar el mensaje",cerrar=!1,$scope.elimina_post=!1):"mensajeEliminado_facebook"===data.error?($scope.mensajeDescartado="El mensaje ha sido eliminado directamente en Faceboook",cerrar=!1,$scope.elimina_post=!1):"post_noEncontrado"===data.error?($scope.mensajeDescartado="El mensaje no ha sido encontrado para poder eliminarlo en Faceboook",cerrar=!1,$scope.elimina_post=!1):"contenido_noEncontrado"===data.error?($scope.mensajeDescartado="Contenido no encontrado, favor de verificarlo",cerrar=!1,$scope.elimina_post=!1):"sinPermisos"===data.error?($scope.mensajeDescartado="No cuentas con permisos suficientes para eliminar el mensaje en Facebook",cerrar=!1,$scope.elimina_post=!1):1===data?($scope.mensajeDescartado="Error con la conexión de la base de datos",cerrar=!1):2===data?($scope.mensajeDescartado="No se pudo actualizar la razón",cerrar=!1):3===data&&(cerrar=!0),cerrar){$scope.items[0].descartado={idUsuario:idUsuario,motivo:descartado,usuario:username,usuario_foto:Authentication.user.imagen_src},Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:idPost});var obj_actualizar_descartado={username:Authentication.user.displayName,cuenta:Authentication.user.cuenta.marca,_id:$scope.items[0]._id,descartado:$scope.items[0].descartado};Socket.emit("tiempoRealServer",obj_actualizar_descartado),$modalInstance.close($scope.items[0])}}))},$scope.regresarMailbox=function(item){console.log("Evento multiple !!!"),console.log(item),$rootScope.$broadcast("eventRegresaMailbox",item),$modalInstance.dismiss(item)},$scope.cancel=function(item){delete item.conversacion,item.conversacion=new Array,console.log(item),item.sentiment_actualizado&&(delete item.sentiment,item.sentiment=$scope.back_sentiment),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:item._id}),$modalInstance.dismiss(item)},$scope.cancelaDescarte=function(item){$modalInstance.dismiss("cancel"),Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:item._id})},$scope.guardaInfluencer=function(item){var nombreInfluencer=$scope.nombre,apellidoInfluencer=$scope.apellido,descripcionInfluencer=$scope.descripcion,categoriaInfluencer=$scope.categoria,usernameInfluencer=$scope.username,error=0;if($scope.mensajeErrores="","undefined"==typeof nombreInfluencer&&(nombreInfluencer=""),"undefined"==typeof apellidoInfluencer&&(apellidoInfluencer=""),"undefined"==typeof categoriaInfluencer&&(categoriaInfluencer=""),"undefined"==typeof descripcionInfluencer&&(descripcionInfluencer=""),"undefined"==typeof usernameInfluencer&&(usernameInfluencer=""),0===nombreInfluencer.length?($scope.errorNombre="Por favor llene el campo NOMBRE",error++):$scope.errorNombre="",0===apellidoInfluencer.length?($scope.errorApellido="Por favor llene el campo APELLIDOS",error++):$scope.errorApellido="",0===categoriaInfluencer.length||"#"===categoriaInfluencer?($scope.errorCategoria="Por favor seleccione una CATEGORÍA",error++):$scope.errorCategoria="",0===usernameInfluencer.length?($scope.errorUsername="Por favor llene el USERNAME",error++):$scope.errorUsername="",0!==error)$scope.mensajeErrores="Favor de llenar los campos requeridos";else{var nombreUsuario=usernameInfluencer.replace("@","");$scope.muestraBarra=!0,$http.post("/addInfluencer/",{apellido:apellidoInfluencer,nombre:nombreInfluencer,categoria:categoriaInfluencer,username:nombreUsuario,cuenta:$scope.authentication.user.cuenta.marca,descripcion:descripcionInfluencer}).success(function(data){1===data?window.alert("El usuario de twitter no existe"):2===data?window.alert("Ocurrió un error al validar la información"):3===data?window.alert("Ocurrió un error al agregar el influencer"):5===data?window.alert("El influencer ya existe"):(Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:item._id}),$modalInstance.close())})}}}]).controller("ModalAsignarCtrl",["$scope","$modalInstance","mensaje","usuarios","$resource","$http","Authentication","Socket","$rootScope","$modal","$timeout","CONSTANT",function($scope,$modalInstance,mensaje,usuarios,$resource,$http,Authentication,Socket,$rootScope,$modal,$timeout,CONSTANT){$scope.usuarios_cuenta=usuarios,$scope.mensaje=mensaje,$scope.authentication=Authentication,$scope.constant=CONSTANT;var datos_bloqueo={};datos_bloqueo.cuenta=$scope.authentication.user.marca,datos_bloqueo.user=$scope.authentication.user.displayName,datos_bloqueo._id=$scope.mensaje._id,datos_bloqueo.user_image=$scope.authentication.user.imagen_src,console.log("Bloqueando el twit !"),console.log(datos_bloqueo),Socket.emit("idBloquea",datos_bloqueo),$scope.evaluaActivo=function(id){return id===$scope.usuario_seleccionado?!0:!1},$scope.asignaMensaje=function(user){$scope.asigna_usuario=user,$scope.usuario_seleccionado=user._id},$scope.asignaMensajeService=function(){if(!$scope.asigna_usuario)return void($scope.error_asignacion="Selecciona un usuario");var obj={id:$scope.mensaje._id,tipo:$scope.mensaje.tipo,obj:$scope.mensaje.obj,from_id:$scope.mensaje.from_user_id,created_time:$scope.mensaje.created_time,usuario_asignador_foto:Authentication.user.imagen_src,coleccion:Authentication.user.cuenta.marca,asignado:{de_id:$scope.authentication.user._id,de_name:$scope.authentication.user.displayName,usuario_asignado_id:$scope.asigna_usuario._id,usuario_asignado_displayName:$scope.asigna_usuario.displayName,usuario_asignado_image:$scope.asigna_usuario.imagen_src,timestamp:new Date}};$http.post("/asignaMensaje",obj).success(function(data){if(console.log("Respuesta de asgina mensajes !"),console.log(data),data.code)return void($scope.error_asignacion="Hubo un error en la asignacion");console.log("Mensajes asignados !!! "),console.log(data),console.log("EL MENSAJE"),console.log($scope.mensaje),Socket.emit("liberaOcupado",{cuenta:$scope.authentication.user.cuenta.marca,_id:$scope.mensaje._id}),data.ok?data=[$scope.mensaje._id]:data.push($scope.mensaje._id);var obj_atendido={mensajes:data,cuenta:Authentication.user.cuenta.marca,asignado:obj.asignado};Socket.emit("socketAsignaServer",obj_atendido),console.log($scope.mensaje),$scope.mensaje.influencers&&(console.log("Eliminando notificacion"),console.log($scope.mensaje),Socket.emit("eliminaNotificacion",$scope.mensaje._id)),$rootScope.$broadcast("muestraFlash","Mensaje asignado correctamente"),$modalInstance.dismiss($scope.mensaje)})},$scope.cancelAsignacion=function(item){Socket.emit("liberaOcupado",{cuenta:Authentication.user.cuenta.marca,_id:item._id}),$modalInstance.dismiss(item)}}]).directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight+5>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}}),angular.module("feeds").controller("FeedsTooltip",["$scope",function($scope){console.log($scope),$scope.htmlTooltip='<a data-ng-controller="ModalDemoCtrl" data-ng-click="open({{twit}})">Responder</a><br><a>Descartar</a>'}]),angular.module("feeds").factory("Feeds",["$resource",function($resource){return $resource("feeds/:feedId",{feedId:"@_id"},{update:{method:"PUT"}})}]),angular.module("influencers").config(["$stateProvider",function($stateProvider){$stateProvider.state("listInfluencers",{url:"/influencers",templateUrl:"modules/influencers/views/list-influencers.client.view.html"}).state("createInfluencer",{url:"/influencers/create",templateUrl:"modules/influencers/views/create-influencer.client.view.html"}).state("viewInfluencer",{url:"/influencers/:influencerId",templateUrl:"modules/influencers/views/view-influencer.client.view.html"}).state("ModalInfluencer",{url:"/influencers/modal",templateUrl:"modules/influencers/views/modal.html"}).state("editInfluencer",{url:"/influencers/:influencerId/edit",templateUrl:"modules/influencers/views/edit-influencer.client.view.html"})}]),angular.module("influencers").controller("InfluencersController",["$scope","$stateParams","$http","$resource","$location","Authentication","Influencers",function($scope,$stateParams,$http,$resource,$location,Authentication,Influencers){$scope.authentication=Authentication,$scope.statusLoginFacebook=!1,"undefined"!=typeof $scope.authentication.user.additionalProvidersData&&($scope.statusLoginFacebook=!0),$scope.imagen=function(){},$scope.listaIndustry=["Anuncios & Marketing","Artes & Entretenimiento","Auto","Negocios","Computadoras & Electronicos","Bienes de consumo envasados","Citas","Familia y Maternidad","Servicios Financieros","Fitness & Perdida de peso","Comida & Bebidas","Juegos","Hobbies / Intereses","Casa & Jardin","Trabajos & Educación","Ley, Gobierno & Politicas","Media","Sin fines de lucro","Regalos","Mascotas","Farmaceutica & Cuidado de la Salud","Real Estate","Religion & Espiritualidad","Retail","Software","Estilo, Moda & Belleza","Telecomunicaciones","Viajes","Deportes"],$scope.listaIndustry.sort(),$scope.listaIndustry.push("Otro"),$scope.formInfluencer=!1,$scope.muestraFormInfluencer=function(){$scope.formInfluencer=!0},$scope.ocultaFormInfluencer=function(){$scope.formInfluencer=!1},$scope.getInfluencers=function(){$http.post("/getInfluencer/",{cuenta:$scope.authentication.user.cuenta.marca}).success(function(data,status,headers,config){$scope.influencers=data,$scope.descripcion=data[0].descripcion,$scope.nombreCompleto=data[0].nombre+" "+data[0].apellidos,$scope.categoria=data[0].categoria,$scope.idInf=data[0].idUser,$scope.username=data[0].username,$scope.nombre=data[0].nombre,$scope.apellido=data[0].apellidos,$scope.imagen_influencer=data[0].imagen_influencer})},$scope.recibeID=function(idInfluencer){$scope.idSeleccionado=idInfluencer},$scope.activaForm=function(infoUsuario){"community-manager"!==$scope.authentication.user.roles[0]&&"directivo"!==$scope.authentication.user.roles[0]?$scope.idEdicion=infoUsuario:console.log($scope.authentication.user.roles[0]+" no tiene permisos")},$scope.desactivaForm=function(){$scope.idEdicion=""},$scope.informacionInfluencer=function(infoInfluencer){$scope.descripcion=infoInfluencer.descripcion,$scope.nombreCompleto=infoInfluencer.nombre+" "+infoInfluencer.apellidos,$scope.categoria=infoInfluencer.categoria,$scope.idInf=infoInfluencer.idUser,$scope.username=infoInfluencer.username,$scope.nombre=infoInfluencer.nombre,$scope.apellido=infoInfluencer.apellidos,$scope.imagen_influencer=infoInfluencer.imagen_influencer},$scope.guardaDatos=function(){var idInfluencer=$scope.idInf,nombre=$scope.nombre,apellido=$scope.apellido,categoria=$scope.categoria,username=$scope.username,descripcion=$scope.descripcion;$http.post("/updateInfluencer/",{cuenta:$scope.authentication.user.cuenta.marca,idInfluencer:idInfluencer,nombre:nombre,categoria:categoria,username:username,apellido:apellido,descripcion:descripcion}).success(function(data){$scope.influencers=data,$scope.idEdicion=""})},$scope.guardaInfluencer=function(){var nombreInfluencer=$scope.nombre,apellidoInfluencer=$scope.apellido,descripcionInfluencer=$scope.descripcion,categoriaInfluencer=$scope.categoria,usernameInfluencer=$scope.username,error=0;if($scope.mensajeErrores="","undefined"==typeof nombreInfluencer&&(nombreInfluencer=""),"undefined"==typeof apellidoInfluencer&&(apellidoInfluencer=""),"undefined"==typeof categoriaInfluencer&&(categoriaInfluencer=""),"undefined"==typeof descripcionInfluencer&&(descripcionInfluencer=""),"undefined"==typeof usernameInfluencer&&(usernameInfluencer=""),0===nombreInfluencer.length?($scope.errorNombre="Por favor llene el campo NOMBRE",error++):$scope.errorNombre="",0===apellidoInfluencer.length?($scope.errorApellido="Por favor llene el campo APELLIDOS",error++):$scope.errorApellido="",0===categoriaInfluencer.length||"#"===categoriaInfluencer?($scope.errorCategoria="Por favor seleccione una CATEGORÍA",error++):$scope.errorCategoria="",0===usernameInfluencer.length?($scope.errorUsername="Por favor llene el USERNAME",error++):$scope.errorUsername="",0!==error)$scope.mensajeErrores="Favor de llenar los campos requeridos";else{var nombreUsuario=usernameInfluencer.replace("@","");$scope.muestraBarra=!0,$http.post("/addInfluencer/",{apellido:apellidoInfluencer,nombre:nombreInfluencer,categoria:categoriaInfluencer,username:nombreUsuario,cuenta:$scope.authentication.user.cuenta.marca,descripcion:descripcionInfluencer}).success(function(data,status,headers,config){1===data?window.alert("El usuario de twitter no existe"):2===data?window.alert("Ocurrió un error al validar la información"):3===data?window.alert("Ocurrió un error al agregar el influencer"):5===data?window.alert("El influencer ya existe"):($scope.$emit("someEvent",data),$scope.muestraBarra=!1)})}},$scope.$on("informacionInfluencers",function(event,message){$scope.influencers=message,$scope.descripcion="",$scope.nombreCompleto="",$scope.categoria="",$scope.idInf="",$scope.username="",$scope.nombre="",$scope.apellido=""})}]).controller("ModalInfluencers",["$scope","$modal","$log","$resource","Authentication","Influencers",function($scope,$modal,$log,$resource,Authentication,Influencers){$scope.open=function(idInfluencer){$scope.idInfluencer=idInfluencer;var modalInstance=$modal.open({templateUrl:"modalInfluencers.html",controller:"ModalInstanceInfluencers",size:150,resolve:{idInfluencer:function(){return $scope.idInfluencer}}});modalInstance.result.then(function(data){$scope.$emit("informacionInfluencers",data)},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.openNuevo=function(idInfluencer){$scope.idInfluencer=idInfluencer;var modalInstance=$modal.open({templateUrl:"nuevoInfluencers.html",controller:"ModalInstanceInfluencers",size:150,resolve:{idInfluencer:function(){return $scope.idInfluencer}}});modalInstance.result.then(function(data){$scope.$emit("informacionInfluencers",data)},function(){$log.info("Modal dismissed at: "+new Date)})}}]).controller("ModalInstanceInfluencers",["idInfluencer","$scope","$modalInstance","$resource","$http","Accounts","Authentication","Influencers",function(idInfluencer,$scope,$modalInstance,$resource,$http,Accounts,Authentication,Influencers){$scope.listaIndustry=["Anuncios & Marketing","Artes & Entretenimiento","Auto","Negocios","Computadoras & Electronicos","Bienes de consumo envasados","Citas","Familia y Maternidad","Servicios Financieros","Fitness & Perdida de peso","Comida & Bebidas","Juegos","Hobbies / Intereses","Casa & Jardin","Trabajos & Educación","Ley, Gobierno & Politicas","Media","Sin fines de lucro","Regalos","Mascotas","Farmaceutica & Cuidado de la Salud","Real Estate","Religion & Espiritualidad","Retail","Software","Estilo, Moda & Belleza","Telecomunicaciones","Viajes","Deportes"],$scope.listaIndustry.sort(),$scope.listaIndustry.push("Otro"),$scope.$on("someEvent",function(event,args){$modalInstance.close(args)}),$scope.idInfluencer=idInfluencer,$scope.eliminaInfluencer=function(){$http.post("/deleteInfluencer/",{cuenta:$scope.authentication.user.cuenta.marca,
idInfluencer:$scope.idInfluencer}).success(function(data,status,headers,config){$scope.ok(data)})},$scope.authentication=Authentication,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(req){$modalInstance.close(req)}}]),angular.module("influencers").factory("Influencers",["$resource",function($resource){return $resource("influencers/:influencerId",{influencerId:"@_id"},{update:{method:"PUT"}})}]),angular.module("themes").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Themes","themes","dropdown","/themes(/create)?"),Menus.addSubMenuItem("topbar","themes","List Themes","themes"),Menus.addSubMenuItem("topbar","themes","New Theme","themes/create")}]),angular.module("themes").config(["$stateProvider",function($stateProvider){$stateProvider.state("listThemes",{url:"/themes",templateUrl:"modules/themes/views/list-themes.client.view.html"}).state("createTheme",{url:"/themes/create",templateUrl:"modules/themes/views/create-theme.client.view.html"}).state("viewTheme",{url:"/themes/:themeId",templateUrl:"modules/themes/views/view-theme.client.view.html"}).state("editTheme",{url:"/themes/:themeId/edit",templateUrl:"modules/themes/views/edit-theme.client.view.html"})}]),angular.module("themes").directive("autofocus",["$timeout",function($timeout){return{restrict:"A",link:function($scope,$element){$timeout(function(){$element[0].focus()})}}}]).controller("ThemesController",["$scope","$stateParams","$http","$resource","$timeout","$location","Authentication","Themes",function($scope,$stateParams,$http,$resource,$timeout,$location,Authentication,Themes){$scope.authentication=Authentication,$scope.statusLoginFacebook=!1,"undefined"!=typeof $scope.authentication.user.additionalProvidersData&&($scope.statusLoginFacebook=!0),$scope.subtemasPagina=[],$scope.temaEscogido="",$scope.subtemaEscogido="",$scope.resTemas="",$scope.resSubtemas="",$scope.MuestraTemas="",$scope.getTemas=function(){var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/getTemasPantalla/",{cuenta:cuenta}).success(function(data){$scope.temasActuales=data})},$scope.obtenerSubtemas=function(temaAhora,idTemaAhora){$scope.idtemaSeleccionado=idTemaAhora,$scope.muestraDivAddTema=!1,$scope.tema_nuevo="",$scope.mensajeTema="",$scope.muestraDivRes=!1,$scope.muestraDivAddSub=!1,$scope.mensajeRespuesta="",$scope.subtema_nuevo="",$scope.mensajeSubtema="",$scope.obtieneResTemas(temaAhora),$scope.temaEscogido=temaAhora;var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/getSubtemasPantalla/",{tema:temaAhora,cuenta:cuenta}).success(function(data){var subtemas=[];for(var j in data)subtemas[j]={idSubtema:data[j].idSubtema,nombre:data[j].subtema};$scope.subtemasPagina=subtemas})},$scope.obtieneResTemas=function(tema){var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/getResTemas/",{temaActual:tema,cuenta:cuenta}).success(function(data){$scope.resTemas=data,$scope.MuestraTemas=data,$scope.subtemaEscogido=""})},$scope.obtieneResSubtemas=function(otraVariable){$scope.mensajeRespuesta="",$scope.muestraDivRes=!1,$scope.muestraDivAddSub=!1,$scope.subtemaEscogido="",$scope.subtemaEscogido=otraVariable;var temaEscogido=$scope.temaEscogido,cuenta=$scope.authentication.user.cuenta.marca;$http.post("/getResSubtemas",{temaActual:temaEscogido,subtemaActual:otraVariable,cuenta:cuenta}).success(function(data){0===data.length?$scope.MuestraTemas="":$scope.MuestraTemas=data})},$scope.muestraDivRes=!1,$scope.showResponse=function(){$scope.muestraDivRes=!0,$scope.respuesta="",$scope.mensajeRespuesta=""},$scope.hideResponse=function(){$scope.muestraDivRes=!1,$scope.respuesta="",$scope.mensajeRespuesta=""},$scope.muestraDivAddSub=!1,$scope.showAddSub=function(){$scope.muestraDivAddSub=!0,$scope.subtema_nuevo="",$scope.mensajeSubtema=""},$scope.hideAddSub=function(){$scope.muestraDivAddSub=!1,$scope.subtema_nuevo="",$scope.mensajeSubtema=""},$scope.muestraDivAddTema=!1,$scope.showAddTema=function(){$scope.muestraDivAddTema=!0,$scope.tema_nuevo="",$scope.mensajeTema=""},$scope.hideAddTema=function(){$scope.muestraDivAddTema=!1,$scope.tema_nuevo="",$scope.mensajeTema=""},$scope.showEditTema=function(idCampo){var idTema="edita_"+this.themesNow._id,ocultaTema="ocultaTema_"+this.themesNow._id;$scope[ocultaTema]=!0,$scope[idTema]=!0,$scope.formData={},$scope.mensajeEdicionTema="",$timeout(function(){$(angular.element(document.querySelector("#input_"+idCampo))).focus()})},$scope.hideEditTema=function(idT){var idTema="edita_"+idT,ocultaTema="ocultaTema_"+idT;$scope[ocultaTema]=!1,$scope[idTema]=!1,$scope.formData={},$scope.mensajeEdicionTema=""},$scope.formData={},$scope.editaTema=function(){var idTema=this.themesNow._id,tema=this.themesNow.tema;console.log(this);var cambioTema=this.edita;if(console.log(cambioTema),"undefined"==typeof cambioTema&&(cambioTema=""),0===cambioTema.length)$scope.comodin=idTema,$scope.mensajeEdicionTema="The entered topic is empty";else{var cuenta=$scope.authentication.user.cuenta.marca;console.log("POST"),console.log(tema),console.log(cambioTema),console.log(idTema),console.log(cuenta),$http.post("/editaTema",{tema:tema,edicion:cambioTema,idTema:idTema,cuenta:cuenta}).success(function(data){if(1===data)$scope.comodin=idTema,$scope.mensajeEdicionTema="Error en la conexión";else if(2===data)$scope.comodin=idTema,$scope.mensajeEdicionTema="El tema ya existe";else if(3===data)$scope.comodin=idTema,$scope.mensajeEdicionTema="Error al realizar la actualización";else{$scope.temasActuales=data;var identificador="edita_"+idTema,ocultaTema="ocultaTema_"+idTema;$scope[ocultaTema]=!1,$scope[identificador]=!1,$scope.formData={},$scope.comodin=idTema,$scope.mensajeEdicionTema="Tema actualizado correctamente"}})}},$scope.showEditSubtema=function(idCampo){var idSubtema="editaSubtema_"+this.subthemesNow.idSubtema,ocultaSubtema="ocultaSubtema_"+this.subthemesNow.idSubtema;$scope[ocultaSubtema]=!0,$scope[idSubtema]=!0,$scope.mensajeEdicionSubtema="",$scope.textoSubtema={},$timeout(function(){$(angular.element(document.querySelector("#input_"+idCampo))).focus()})},$scope.hideEditSubtema=function(idT){var idSubtema="editaSubtema_"+idT,ocultaSubtema="ocultaSubtema_"+idT;$scope[ocultaSubtema]=!1,$scope[idSubtema]=!1,$scope.mensajeEdicionSubtema="",$scope.textoSubtema={}},$scope.textoSubtema={},$scope.editaSubtema=function(){var idTema=$scope.idtemaSeleccionado,idSubtema=this.subthemesNow.idSubtema,tema=$scope.temaEscogido,cambioSubtema=this.editasub;if("undefined"==typeof cambioSubtema&&(cambioSubtema=""),0===cambioSubtema.length)$scope.comodinSubtema=idSubtema,$scope.mensajeEdicionSubtema="El subtema está vacío";else{var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/editaSubtema",{tema:tema,edicion:cambioSubtema,idTema:idTema,idSubtema:idSubtema,cuenta:cuenta}).success(function(data){if(1===data)$scope.comodinSubtema=idSubtema,$scope.mensajeEdicionSubtema="Error en la conexión";else if(2===data)$scope.comodinSubtema=idSubtema,$scope.mensajeEdicionSubtema="El subtema ya existe";else if(3===data)$scope.comodinSubtema=idSubtema,$scope.mensajeEdicionSubtema="Error al realizar la actualización";else{var subtemas={};for(var j in data)subtemas[j]={idSubtema:data[j].idSubtema,nombre:data[j].subtema};$scope.subtemasPagina=subtemas;var identificador="editaSubtema_"+idSubtema,ocultaSubtema="ocultaSubtema_"+idSubtema;$scope[ocultaSubtema]=!1,$scope[identificador]=!1,$scope.textoSubtema={},$scope.comodinSubtema=idSubtema,$scope.mensajeEdicionSubtema="Subtema actualizado correctamente"}})}},$scope.showRespuestas=function(idCampo){var idRespuesta="editaRespuesta_"+this.respuestas.idRespuesta,ocultaRes="ocultaRespuestas_"+this.respuestas.idRespuesta;$scope[ocultaRes]=!0,$scope[idRespuesta]=!0,$timeout(function(){$(angular.element(document.querySelector("#id_"+idCampo))).focus()})},$scope.hideRespuestas=function(){var idRespuesta="editaRespuesta_"+this.respuestas.idRespuesta,ocultaRes="ocultaRespuestas_"+this.respuestas.idRespuesta;$scope[ocultaRes]=!1,$scope[idRespuesta]=!1,$scope.textoRespuesta[this.respuestas.idRespuesta]="",$scope.mensajeEdicionRespuesta=""},$scope.textoRespuesta={},$scope.editaRespuestas=function(){var temaSeleccionado=$scope.temaEscogido,subtemaSeleccionado=$scope.subtemaEscogido,idRespuesta=this.respuestas.idRespuesta,cambioRespuesta=this.editaresp;if("undefined"==typeof cambioRespuesta&&(cambioRespuesta=""),0===cambioRespuesta.length)$scope.comodinRes=idRespuesta,$scope.mensajeEdicionRespuesta="La respuesta ingresada esta vacía";else{var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/editaRespuesta",{tema:temaSeleccionado,subtema:subtemaSeleccionado,edicion:cambioRespuesta,idRespuesta:idRespuesta,cuenta:cuenta}).success(function(data){if(1===data)$scope.comodinRes=idRespuesta,$scope.mensajeEdicionRespuesta="Error en la conexión";else if(2===data)$scope.comodinRes=idRespuesta,$scope.mensajeEdicionRespuesta="La respuesta ya existe";else if(3===data)$scope.comodinRes=idRespuesta,$scope.mensajeEdicionRespuesta="Error al realizar la actualización";else{$scope.MuestraTemas=data;var Resp="editaRespuesta_"+idRespuesta,ocultaRes="ocultaRespuestas_"+idRespuesta;$scope[ocultaRes]=!1,$scope[Resp]=!1,$scope.textoRespuesta={},$scope.comodinRes=idRespuesta,$scope.mensajeEdicionRespuesta="Respuesta actualizada correctamente"}})}},$scope.eliminaRespuesta=function(respuesta){var tema=$scope.temaEscogido,subtema=$scope.subtemaEscogido,cuenta=$scope.authentication.user.cuenta.marca;$http.post("/eliminaRespuesta",{tema:tema,subtema:subtema,respuesta:respuesta,cuenta:cuenta}).success(function(data){$scope.MuestraTemas=data,window.alert("Respuesta Eliminada")})},$scope.$on("agregaThemes",function(event,message){var separaArreglo=message.split("||");$scope.getTemas(),$scope.idtemaSeleccionado="",$scope.subtemasPagina="",$scope.respuestas="",$scope.temaEscogido="",$scope.subtemaEscogido="",$scope.resTemas="",$scope.resSubtemas="",$scope.MuestraTemas="",$scope.temaEscogido=separaArreglo[1]}),$scope.$on("agregaSubthemes",function(event,message){$scope.obtenerSubtemas(message)}),$scope.$on("agregaResponse",function(event,message){var separaArreglo=message.split("||");""===separaArreglo[1]?$scope.obtieneResTemas(separaArreglo[0]):"Null"===separaArreglo[1]?$scope.obtieneResTemas(separaArreglo[0]):$scope.obtieneResSubtemas(separaArreglo[1])})}]).controller("ModalTema",["$scope","$modal","$log","$resource","Authentication","Themes",function($scope,$modal,$log,$resource,Authentication,Themes){$scope.open=function(opcion){var opciones=opcion.split("|");"tema"===opciones[0]?($scope.agregaTema=!0,$scope.agregaSubtema=!1,$scope.agregaRespuesta=!1,$scope.deleteTema=!1,$scope.deleteSubtema=!1,$scope.deleteRespuesta=!1):"subtema"===opciones[0]?($scope.agregaTema=!1,$scope.agregaSubtema=!0,$scope.agregaRespuesta=!1,$scope.deleteTema=!1,$scope.deleteSubtema=!1,$scope.deleteRespuesta=!1):"respuesta"===opciones[0]?($scope.agregaTema=!1,$scope.agregaSubtema=!1,$scope.agregaRespuesta=!0,$scope.deleteTema=!1,$scope.deleteSubtema=!1,$scope.deleteRespuesta=!1):"eliminaTema"===opciones[0]?($scope.agregaTema=!1,$scope.agregaSubtema=!1,$scope.agregaRespuesta=!1,$scope.deleteTema=!0,$scope.deleteSubtema=!1,$scope.deleteRespuesta=!1):"eliminaSubtema"===opciones[0]?($scope.agregaTema=!1,$scope.agregaSubtema=!1,$scope.agregaRespuesta=!1,$scope.deleteTema=!1,$scope.deleteSubtema=!0,$scope.deleteRespuesta=!1):"eliminaRespuesta"===opciones[0]&&($scope.agregaTema=!1,$scope.agregaSubtema=!1,$scope.agregaRespuesta=!1,$scope.deleteTema=!1,$scope.deleteSubtema=!1,$scope.deleteRespuesta=!0),$scope.opcion=opcion;var modalInstance=$modal.open({templateUrl:"modalTema.html",controller:"ModalInstanceThemes",size:150,resolve:{agregaTema:function(){return $scope.agregaTema},agregaSubtema:function(){return $scope.agregaSubtema},agregaRespuesta:function(){return $scope.agregaRespuesta},temaEscogido:function(){return opciones[1]},subtemaEscogido:function(){return opciones[2]},respuestaEliminada:function(){return opciones[3]},deleteTema:function(){return $scope.deleteTema},deleteSubtema:function(){return $scope.deleteSubtema},deleteRespuesta:function(){return $scope.deleteRespuesta}}});modalInstance.result.then(function(data){var separacion=data.split("|");if("tema"===separacion[0]){var concatTemas=separacion[0]+"||"+separacion[3];$scope.$emit("agregaThemes",concatTemas)}else if("subtema"===separacion[0])$scope.$emit("agregaSubthemes",separacion[1]);else if("respuesta"===separacion[0]){var concatena=separacion[1]+"||"+separacion[2];$scope.$emit("agregaResponse",concatena)}else if("eliminaTema"===separacion[0])$scope.$emit("agregaThemes",separacion[0]);else if("eliminaSubtema"===separacion[0])$scope.$emit("agregaSubthemes",separacion[1]);else if("eliminaRespuesta"===separacion[0]){var concatenacion=separacion[1]+"||"+separacion[2];$scope.$emit("agregaResponse",concatenacion)}},function(){$log.info("Modal dismissed at: "+new Date)})}}]).controller("ModalInstanceThemes",["$scope","$modalInstance","agregaTema","agregaSubtema","agregaRespuesta","temaEscogido","subtemaEscogido","respuestaEliminada","deleteTema","deleteSubtema","deleteRespuesta","$resource","$http","Accounts","Authentication","Themes",function($scope,$modalInstance,agregaTema,agregaSubtema,agregaRespuesta,temaEscogido,subtemaEscogido,respuestaEliminada,deleteTema,deleteSubtema,deleteRespuesta,$resource,$http,Accounts,Authentication,Themes){$scope.temaEscogido=temaEscogido,$scope.deleteTema=deleteTema,$scope.deleteSubtema=deleteSubtema,$scope.deleteRespuesta=deleteRespuesta,$scope.respuestaEliminada=respuestaEliminada,$scope.subtemaEscogido=subtemaEscogido,$scope.seleccionTema=agregaTema,$scope.seleccionSubtema=agregaSubtema,$scope.seleccionRespuesta=agregaRespuesta,$scope.authentication=Authentication,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(opcion,datos,subtema,seleccion){var concatenacion="";concatenacion=""!==subtema?opcion+"|"+datos+"|"+subtema:opcion+"|"+datos+"||"+seleccion,$modalInstance.close(concatenacion)},$scope.agregarTema=function(){var temaNuevo=$scope.tema_nuevo;if("undefined"==typeof temaNuevo&&(temaNuevo=""),temaNuevo=temaNuevo.trim(),0===temaNuevo.length)$scope.mensajeTema="El tema ingresado esta vacío";else{var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/agregaTema",{tema:temaNuevo,cuenta:cuenta}).success(function(data){1===data?$scope.mensajeTema="No se conectó a la base de datos":2===data?$scope.mensajeTema="Error en la búsqueda de la base de datos":3===data?$scope.mensajeTema="El tema ingresado ya existe":4===data?$scope.mensajeTema="Error al añadir el tema":$scope.ok("tema",data,"",temaNuevo)})}},$scope.eliminaTema=function(){var temaEliminar=$scope.temaEscogido;if("undefined"==typeof temaEliminar&&(temaEliminar=""),temaEliminar.length>0){var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/eliminaTema",{tema:temaEliminar,cuenta:cuenta}).success(function(data){$scope.ok("eliminaTema",data)})}},$scope.agregarSubtema=function(req,res){var temaActual=$scope.temaEscogido,subtemaNuevo=$scope.subtema_nuevo;if(0===$scope.temaEscogido.length)$scope.mensajeSubtema="Por favor seleccione un tema antes de agregar un subtema";else{var newSubtema=$scope.subtema_nuevo;if("undefined"==typeof newSubtema&&(newSubtema=""),newSubtema.trim(),0===newSubtema.length)$scope.mensajeSubtema="El subtema ingresado esta vacío";else{var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/agregaSubtema",{tema:temaActual,subtema_nuevo:subtemaNuevo,cuenta:cuenta}).success(function(data){if(1===data)$scope.mensajeSubtema="Error en la conexión";else if(2===data)$scope.mensajeSubtema="El subtema ya existe";else if(3===data)$scope.mensajeSubtema="Error al realizar la actualización";else{var subtemas={};for(var j in data)subtemas[j]={idSubtema:data[j].idSubtema,nombre:data[j].subtema};$scope.ok("subtema",temaActual)}})}}},$scope.eliminaSubtema=function(){var tema=$scope.temaEscogido,subtema=$scope.subtemaEscogido;if(0===tema.length)console.log("No se ha seleccionado ningun tema");else if(0===subtema.length)console.log("No se ha seleccionado ningun subtema");else{var cuenta=$scope.authentication.user.cuenta.marca;$http.post("/eliminaSubtema",{tema:tema,subtema:subtema,cuenta:cuenta}).success(function(data){$scope.ok("eliminaSubtema",tema)})}},$scope.agregarRespuesta=function(){var tema="",subtema="";tema=0===$scope.temaEscogido.length?"Null":$scope.temaEscogido,subtema=0===$scope.subtemaEscogido.length?"Null":$scope.subtemaEscogido,"undefined"==typeof $scope.respuesta&&($scope.respuesta="");var response=$scope.respuesta.trim();0===response.length?$scope.mensajeRespuesta="No answer to add":""===$scope.temaEscogido?$scope.mensajeRespuesta="Please select a Topic and a Subtopic before creating an Answer":$http.post("/insertRespuesta",{tema:tema,subtema:subtema,respuesta:response,cuenta:$scope.authentication.user.cuenta.marca}).success(function(data){1===data?($scope.mensajeRespuesta="The answer already exists",$scope.respuesta=""):2===data?($scope.mensajeRespuesta="Is not selected topic to assign the answer",$scope.respuesta=""):3===data?($scope.mensajeRespuesta="There was an error adding response",$scope.respuesta=""):($scope.mensajeRespuesta="The response has been added",$scope.ok("respuesta",$scope.temaEscogido,$scope.subtemaEscogido))})},$scope.eliminaRespuesta=function(){var tema=$scope.temaEscogido,subtema=$scope.subtemaEscogido,respuesta=$scope.respuestaEliminada,cuenta=$scope.authentication.user.cuenta.marca;$http.post("/eliminaRespuesta",{tema:tema,subtema:subtema,respuesta:respuesta,cuenta:cuenta}).success(function(data){0===subtema.length&&(subtema="Null"),$scope.ok("eliminaRespuesta",tema,subtema)})}}]),angular.module("themes").factory("Themes",["$resource",function($resource){return $resource("themes/:themeId",{themeId:"@_id"},{update:{method:"PUT"}})}]),exports=[{rol:"app-manager",permisos:[1,2]},{rol:"account-manager",permisos:[1]},{rol:"user",permisos:[0]}],angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]);var user,permisos=[{rol:"app-manager",permisos:[1,2]},{rol:"account-manager",permisos:[1]},{rol:"user",permisos:[0]}];angular.module("users").controller("SettingsController",["$scope","Authentication",function($scope,Authentication){user=Authentication.user}]).config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("list",{url:"/usuarios/listado",templateUrl:function(){for(var permiso in permisos)if(user.roles[0]===permisos[permiso].rol)return permisos[permiso].permisos.indexOf(1)<=0?"modules/users/views/user.client.view.html":"modules/users/views/404.html"}}).state("listbyaccount",{url:"/equipo",templateUrl:"modules/users/views/userbc.client.view.html"}).state("listaUsuarios",{url:"/users",templateUrl:"modules/users/views/view-user.list.view.html"}).state("muestraUsuario",{url:"/profile/:usuarioID",templateUrl:"modules/users/views/list/view-user.list.view.html"}).state("crearUsuario",{url:"/users/create",templateUrl:"modules/users/views/list/create-user.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invlaid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("editUser",{url:"/user/:usuarioID/edit",templateUrl:"modules/users/views/list/edit-user.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("resetPassword-success",{url:"/password/message",templateUrl:"modules/users/views/password/response-reset.cliente.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/home"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.login=function(){$scope.muestraForm=!0,$scope.error=""},$scope.muestraForm=!0,$scope.mensajeInicio="",$scope.signin=function(){$scope.mensajeInicio="",$scope.error="",$http.post("/auth/signin",$scope.credentials).success(function(response){if(response.message)"Missing credentials"===response.message?($scope.mensajeInicio="¡Oops!",$scope.error="Usuario y/o Contraseña Incorrectos"):($scope.mensajeInicio="¡Oops!",$scope.error=response.message);else{response.hasOwnProperty("additionalProvidersData");$scope.authentication.user=response,$location.path("/home")}})},$scope.$on("respuestaPassword",function(event,message){$scope.muestraForm=!1,$scope.error=message})}]).controller("modalForgotPassword",["$scope","$modal","$log","$http",function($scope,$modal,$log,$http){$scope.open=function(){var modalInstance=$modal.open({templateUrl:"modalForgotPassword.html",controller:"ModalInstanceForgotPassword",size:200,resolve:{datosInfluencer:function(){}}});modalInstance.result.then(function(data){$scope.$emit("respuestaPassword",data)},function(){console.log("Modal dismissed at: "+new Date)})}}]).controller("ModalInstanceForgotPassword",["$scope","$modalInstance","$http",function($scope,$modalInstance,$http){$scope.askForPasswordReset=function(){var usuario={username:this.username};console.log(this.username),$scope.success=$scope.error=null,$http.post("/auth/forgot",usuario).success(function(response){$scope.credentials=null,$scope.ok(response.message)}).error(function(response){$scope.tieneError=!0,$scope.credentials=null,$scope.error=response.message})},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(req){$modalInstance.close(req)}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){console.log($scope.credentials),$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){console.log(response),$scope.credentials=null,$scope.success=response.message,$location.path("/password/message")}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){console.log($scope.passwordDetails),console.log($stateParams),$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").directive("backImg",["$http",function($http){return function(scope,element,attrs){var url=attrs.backImg,imagenDefecto="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAMAAAAL34HQAAACB1BMVEXt7/CSnKOTnaTy8/Spsbfr7e6UnqWVn6a0u8CXoKfp7O3a3uCgqa+fqK65wMTo6+zJztKbpKu7wcWmrrSyub7e4eOrs7i2vcK1vMGstLm4v8O7wsbh5Obl6OnGy8/p6+2/xcmao6rm6Ord4OKZoqmwuL28wseep66dpqzBx8ujq7LX292hqrGutbvk5+mZoaiep63T19qkrLLo6uynsLaWoKfs7vCapKqWn6bj5ujf4+Xf4uScpqzL0NOhqrDc3+GvtrzU2NulrLOcpavj5ufV2dy4v8S2vcHZ3d/M0dTa3eCqsriqsrepsbaosLa9w8e6wMTN0tWnr7XAxsrHzdC+xcmdpq3g4+WXoaettLrGzM/s7u/Y3N/c4OK9xMi3vsKUnaTc3+Kiq7G2vMGosLWzur/R1djR1tjb3uGutruWoKaYoajDycy4wMSjq7GlrrSbpKrKz9OZo6nIzdHr7e/i5eawt7yxuL3q7O6utbqmr7SXoajDyc3m6eqpsLajrLKbpau6wcWkrbPi5ee2vMKvt7zQ1diYoqjP1NfQ1Ne+xMixub3O0tWcpay8w8fk5+ittbrL0NSzur6dp63n6uuvtruxub7V2tzq7O3S1tm7wcbT2NqlrbOcpqvEys7Fy87CyMy9w8jEyc3S19mzu7/U2duhqa/Eys3W2ty6wMWVnqW3vcPHzNAqBf/EAAAEl0lEQVR4nO3cB1cUVxTA8bmTZQe2ggqu7iIsEpSYEIqFIoKgRIMItlhiT7HXWKLRJJpoeu9VExNTP2TeyAEpOzv33Z17X85x/p/gd3Z2Z968spYVFhYWFhYWFhYWFvYI11Hdl3veNGJG1aNJUDmR7XWmKQ9bfMWGiSp+6TDNGS825yBMrbHStMhtXwJmFukyjbJ6nVkqgPxaw6qmAiiVnX3VIOrC14VVqtbKMlOqWI2nyv3q/9VjRFX3YjGVeykXbJBXdcz1UbmwlPSNP33GX6WKxERVsa0oFUDNSkHV9c1IFcB+OVXParQKDj4rpeqqwqsAzkixEL/Bqb0ro1qkp4LTIqpvV2my4AcJVqWuCjZJsK5qs2Axv6rW9mfMrJyf9aG+CpwGdlaKwIJmdlaEwmplZw1SWMA98lpJ+MardjCzWkgqGGFmddNY7zCz+mgsYB6lxomslkeSdYjIYr6IxK/8Ll6V9QmN1c7MKqOxMsws6ziJ9Qo3K0lidXOzRiiq57hV1ksUVoqdVU9hLeNWxXcQVIPcqjbScKtp/bWdrKxyigrUC28V61xqhsRy+5OTRfrCP2gLJ0v/TX+ilzlZa8ks1tm3i1SVzTvgeo3IeoNVZfmtEXjVxMv6nsiK87LaaKoEr8oqW0FiLWJm0R4/jexL60cprD+4VZZ1RV+VFFjzfEv71mWzjwLd2qKarG0SKvVgPK+lmiejsqyG+RqqhXIrimm8SnQTSSeaxfzUmV7r/5OFn52vlmS9gGbVSrLuYlWOpMq6h2Vxz7dNbx2WNSTKsrArw9/Ism7hVDdlVdjl/V5hVg7HYp8zndkaFOukNOskirU/LcxqQQ0Go06bsOs31McFg8L7iXuQ85X8q/rTewbHOiu81bMW+arBOg84u2acSmbnz2QN2IGzfVGShd9dVi/Jwm+m5F+IeljZ32gWfCfHWoZXQY0c64AGyz4kpbpeocGCT6VYyFv85GXMblwnoOrVUz0omeXeR3yHtosLkj9/yYfaQNqIN15niuVi5rakDtNRbtEDwb7/597b9tXZ0kjjVTQHNdZJ79lKWycoXGJ9EKidQ1p3KUzlJR+B67tM/N0V7aPSPrDuSxwolf0+fa43PaQ7Ca/RCHWr8+03+VCq1UcpqBh+KpJYJ2G9P4ebZigpe4+uKt7IrwLtBaG9u0RUAFkd1b4TQiqAj/GqWo3jWCVXj1VdwB6oC6btSJbmkLjU7CMo1WeyKjXUwawMVdO2vJZS0n8ys272wXL+LvuyjhlQAfzuoxo1ooIbxVX/mlH5nGLcyDTo8y1a7LXjnClV0dOCxj4rlfctNc44QvbNe8NEu0EV/Oql0pngC756L1bWKMtzq38JEzEB5LlxCb9DhaPNXqwgJz/0y3uoiCeLAsvj72+6DLN2F2btNczy2DN7zjTLKfhYJB0sCrQ1U/4s6LGJro02zXEbGxs7tVD1z3zV25lMptzt83mqDx5XXerv7z/2lGr3AlXN8PDwpojq9eWqq3NVPw4MDLQ/oTr8pOp+IpFILlF9sVT1U5VqVT6fP/+06kSFaoXjOFHbDU5NYv4DNmGQyGoNSpAAAAAASUVORK5CYII=";$http.get(url).success(function(data,status,headers,config){element.css({"background-image":"url("+url+")","background-size":"cover"})}).error(function(data,status,headers,config){element.css({"background-image":"url("+imagenDefecto+")","background-size":"cover"})})}}]).controller("SettingsController",["$scope","$stateParams","$http","$resource","$location","Users","Lista","Authentication","Cuenta","Listabycuenta",function($scope,$stateParams,$http,$resource,$location,Users,Lista,Authentication,Cuenta,Listabycuenta){$scope.authentication=Authentication;var tieneSesion=$scope.authentication.user.hasOwnProperty("_id");switch(tieneSesion===!1&&$location.path("/"),$scope.statusLoginFacebook2=!1,"undefined"!=typeof $scope.authentication.user.additionalProvidersData&&($scope.statusLoginFacebook2=!0),$scope.imagenDefecto="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAMAAAAL34HQAAACB1BMVEXt7/CSnKOTnaTy8/Spsbfr7e6UnqWVn6a0u8CXoKfp7O3a3uCgqa+fqK65wMTo6+zJztKbpKu7wcWmrrSyub7e4eOrs7i2vcK1vMGstLm4v8O7wsbh5Obl6OnGy8/p6+2/xcmao6rm6Ord4OKZoqmwuL28wseep66dpqzBx8ujq7LX292hqrGutbvk5+mZoaiep63T19qkrLLo6uynsLaWoKfs7vCapKqWn6bj5ujf4+Xf4uScpqzL0NOhqrDc3+GvtrzU2NulrLOcpavj5ufV2dy4v8S2vcHZ3d/M0dTa3eCqsriqsrepsbaosLa9w8e6wMTN0tWnr7XAxsrHzdC+xcmdpq3g4+WXoaettLrGzM/s7u/Y3N/c4OK9xMi3vsKUnaTc3+Kiq7G2vMGosLWzur/R1djR1tjb3uGutruWoKaYoajDycy4wMSjq7GlrrSbpKrKz9OZo6nIzdHr7e/i5eawt7yxuL3q7O6utbqmr7SXoajDyc3m6eqpsLajrLKbpau6wcWkrbPi5ee2vMKvt7zQ1diYoqjP1NfQ1Ne+xMixub3O0tWcpay8w8fk5+ittbrL0NSzur6dp63n6uuvtruxub7V2tzq7O3S1tm7wcbT2NqlrbOcpqvEys7Fy87CyMy9w8jEyc3S19mzu7/U2duhqa/Eys3W2ty6wMWVnqW3vcPHzNAqBf/EAAAEl0lEQVR4nO3cB1cUVxTA8bmTZQe2ggqu7iIsEpSYEIqFIoKgRIMItlhiT7HXWKLRJJpoeu9VExNTP2TeyAEpOzv33Z17X85x/p/gd3Z2Z968spYVFhYWFhYWFhYWFvYI11Hdl3veNGJG1aNJUDmR7XWmKQ9bfMWGiSp+6TDNGS825yBMrbHStMhtXwJmFukyjbJ6nVkqgPxaw6qmAiiVnX3VIOrC14VVqtbKMlOqWI2nyv3q/9VjRFX3YjGVeykXbJBXdcz1UbmwlPSNP33GX6WKxERVsa0oFUDNSkHV9c1IFcB+OVXParQKDj4rpeqqwqsAzkixEL/Bqb0ro1qkp4LTIqpvV2my4AcJVqWuCjZJsK5qs2Axv6rW9mfMrJyf9aG+CpwGdlaKwIJmdlaEwmplZw1SWMA98lpJ+MardjCzWkgqGGFmddNY7zCz+mgsYB6lxomslkeSdYjIYr6IxK/8Ll6V9QmN1c7MKqOxMsws6ziJ9Qo3K0lidXOzRiiq57hV1ksUVoqdVU9hLeNWxXcQVIPcqjbScKtp/bWdrKxyigrUC28V61xqhsRy+5OTRfrCP2gLJ0v/TX+ilzlZa8ks1tm3i1SVzTvgeo3IeoNVZfmtEXjVxMv6nsiK87LaaKoEr8oqW0FiLWJm0R4/jexL60cprD+4VZZ1RV+VFFjzfEv71mWzjwLd2qKarG0SKvVgPK+lmiejsqyG+RqqhXIrimm8SnQTSSeaxfzUmV7r/5OFn52vlmS9gGbVSrLuYlWOpMq6h2Vxz7dNbx2WNSTKsrArw9/Ism7hVDdlVdjl/V5hVg7HYp8zndkaFOukNOskirU/LcxqQQ0Go06bsOs31McFg8L7iXuQ85X8q/rTewbHOiu81bMW+arBOg84u2acSmbnz2QN2IGzfVGShd9dVi/Jwm+m5F+IeljZ32gWfCfHWoZXQY0c64AGyz4kpbpeocGCT6VYyFv85GXMblwnoOrVUz0omeXeR3yHtosLkj9/yYfaQNqIN15niuVi5rakDtNRbtEDwb7/597b9tXZ0kjjVTQHNdZJ79lKWycoXGJ9EKidQ1p3KUzlJR+B67tM/N0V7aPSPrDuSxwolf0+fa43PaQ7Ca/RCHWr8+03+VCq1UcpqBh+KpJYJ2G9P4ebZigpe4+uKt7IrwLtBaG9u0RUAFkd1b4TQiqAj/GqWo3jWCVXj1VdwB6oC6btSJbmkLjU7CMo1WeyKjXUwawMVdO2vJZS0n8ys272wXL+LvuyjhlQAfzuoxo1ooIbxVX/mlH5nGLcyDTo8y1a7LXjnClV0dOCxj4rlfctNc44QvbNe8NEu0EV/Oql0pngC756L1bWKMtzq38JEzEB5LlxCb9DhaPNXqwgJz/0y3uoiCeLAsvj72+6DLN2F2btNczy2DN7zjTLKfhYJB0sCrQ1U/4s6LGJro02zXEbGxs7tVD1z3zV25lMptzt83mqDx5XXerv7z/2lGr3AlXN8PDwpojq9eWqq3NVPw4MDLQ/oTr8pOp+IpFILlF9sVT1U5VqVT6fP/+06kSFaoXjOFHbDU5NYv4DNmGQyGoNSpAAAAAASUVORK5CYII=",$scope.user=Authentication.user,Cuenta.query(function(){}).$promise.then(function(data){$scope.cuentas=data}),$scope.user.roles[0]){case"app-manager":$scope.losroles=[{name:"App Manager",value:"app-manager"},{name:"Account Manager",value:"account-manager"},{name:"Community Manager",value:"community-manager"},{name:"Directivo",value:"directivo"}];break;case"account-manager":$scope.losroles=[{name:"Account Manager",value:"account-manager"},{name:"Community Manager",value:"community-manager"},{name:"Directivo",value:"directivo"}];break;default:$scope.losroles=null}$scope.editeduser={},$scope.solicitaNameCuenta=function(idCuenta){$http.post("/nombreCuenta/",{idCuenta:idCuenta}).success(function(data,status,headers,config){var variable=data.replace(/"/g,"");$scope.marcaCuenta=variable})},$scope.listAccounts=function(){$http.post("/listAccounts/",{}).success(function(data,status,headers,config){if(0===data)console.log("Ha ocurrido un error con la carga de cuentas");else{for(var imagenDefecto="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAMAAAAL34HQAAACB1BMVEXt7/CSnKOTnaTy8/Spsbfr7e6UnqWVn6a0u8CXoKfp7O3a3uCgqa+fqK65wMTo6+zJztKbpKu7wcWmrrSyub7e4eOrs7i2vcK1vMGstLm4v8O7wsbh5Obl6OnGy8/p6+2/xcmao6rm6Ord4OKZoqmwuL28wseep66dpqzBx8ujq7LX292hqrGutbvk5+mZoaiep63T19qkrLLo6uynsLaWoKfs7vCapKqWn6bj5ujf4+Xf4uScpqzL0NOhqrDc3+GvtrzU2NulrLOcpavj5ufV2dy4v8S2vcHZ3d/M0dTa3eCqsriqsrepsbaosLa9w8e6wMTN0tWnr7XAxsrHzdC+xcmdpq3g4+WXoaettLrGzM/s7u/Y3N/c4OK9xMi3vsKUnaTc3+Kiq7G2vMGosLWzur/R1djR1tjb3uGutruWoKaYoajDycy4wMSjq7GlrrSbpKrKz9OZo6nIzdHr7e/i5eawt7yxuL3q7O6utbqmr7SXoajDyc3m6eqpsLajrLKbpau6wcWkrbPi5ee2vMKvt7zQ1diYoqjP1NfQ1Ne+xMixub3O0tWcpay8w8fk5+ittbrL0NSzur6dp63n6uuvtruxub7V2tzq7O3S1tm7wcbT2NqlrbOcpqvEys7Fy87CyMy9w8jEyc3S19mzu7/U2duhqa/Eys3W2ty6wMWVnqW3vcPHzNAqBf/EAAAEl0lEQVR4nO3cB1cUVxTA8bmTZQe2ggqu7iIsEpSYEIqFIoKgRIMItlhiT7HXWKLRJJpoeu9VExNTP2TeyAEpOzv33Z17X85x/p/gd3Z2Z968spYVFhYWFhYWFhYWFvYI11Hdl3veNGJG1aNJUDmR7XWmKQ9bfMWGiSp+6TDNGS825yBMrbHStMhtXwJmFukyjbJ6nVkqgPxaw6qmAiiVnX3VIOrC14VVqtbKMlOqWI2nyv3q/9VjRFX3YjGVeykXbJBXdcz1UbmwlPSNP33GX6WKxERVsa0oFUDNSkHV9c1IFcB+OVXParQKDj4rpeqqwqsAzkixEL/Bqb0ro1qkp4LTIqpvV2my4AcJVqWuCjZJsK5qs2Axv6rW9mfMrJyf9aG+CpwGdlaKwIJmdlaEwmplZw1SWMA98lpJ+MardjCzWkgqGGFmddNY7zCz+mgsYB6lxomslkeSdYjIYr6IxK/8Ll6V9QmN1c7MKqOxMsws6ziJ9Qo3K0lidXOzRiiq57hV1ksUVoqdVU9hLeNWxXcQVIPcqjbScKtp/bWdrKxyigrUC28V61xqhsRy+5OTRfrCP2gLJ0v/TX+ilzlZa8ks1tm3i1SVzTvgeo3IeoNVZfmtEXjVxMv6nsiK87LaaKoEr8oqW0FiLWJm0R4/jexL60cprD+4VZZ1RV+VFFjzfEv71mWzjwLd2qKarG0SKvVgPK+lmiejsqyG+RqqhXIrimm8SnQTSSeaxfzUmV7r/5OFn52vlmS9gGbVSrLuYlWOpMq6h2Vxz7dNbx2WNSTKsrArw9/Ism7hVDdlVdjl/V5hVg7HYp8zndkaFOukNOskirU/LcxqQQ0Go06bsOs31McFg8L7iXuQ85X8q/rTewbHOiu81bMW+arBOg84u2acSmbnz2QN2IGzfVGShd9dVi/Jwm+m5F+IeljZ32gWfCfHWoZXQY0c64AGyz4kpbpeocGCT6VYyFv85GXMblwnoOrVUz0omeXeR3yHtosLkj9/yYfaQNqIN15niuVi5rakDtNRbtEDwb7/597b9tXZ0kjjVTQHNdZJ79lKWycoXGJ9EKidQ1p3KUzlJR+B67tM/N0V7aPSPrDuSxwolf0+fa43PaQ7Ca/RCHWr8+03+VCq1UcpqBh+KpJYJ2G9P4ebZigpe4+uKt7IrwLtBaG9u0RUAFkd1b4TQiqAj/GqWo3jWCVXj1VdwB6oC6btSJbmkLjU7CMo1WeyKjXUwawMVdO2vJZS0n8ys272wXL+LvuyjhlQAfzuoxo1ooIbxVX/mlH5nGLcyDTo8y1a7LXjnClV0dOCxj4rlfctNc44QvbNe8NEu0EV/Oql0pngC756L1bWKMtzq38JEzEB5LlxCb9DhaPNXqwgJz/0y3uoiCeLAsvj72+6DLN2F2btNczy2DN7zjTLKfhYJB0sCrQ1U/4s6LGJro02zXEbGxs7tVD1z3zV25lMptzt83mqDx5XXerv7z/2lGr3AlXN8PDwpojq9eWqq3NVPw4MDLQ/oTr8pOp+IpFILlF9sVT1U5VqVT6fP/+06kSFaoXjOFHbDU5NYv4DNmGQyGoNSpAAAAAASUVORK5CYII=",cuentas=[],i=0;i<data.length;i++)cuentas[i]=data[i],
(""===data[i].imagen_src||"undefined"==typeof data[i].imagen_src)&&(cuentas[i].imagen_src=imagenDefecto);var byName=cuentas.slice(0);byName.sort(function(a,b){var x=a.marca.toLowerCase(),y=b.marca.toLowerCase();return y>x?-1:x>y?1:0}),$scope.cuentasTeam=byName}})},$scope.usuariosTeam=function(idCuenta,nombreCuenta){$scope.idCuentaSelect=idCuenta,$scope.nombreCuentadefault=nombreCuenta,$http.post("/listadoEquipo/",{cuenta:nombreCuenta,idCuenta:idCuenta}).success(function(data){$scope.usersbyaccount=data}),$scope.imagenPerfil="",$scope.idUsuario="",$scope.nombreCompleto="",$scope.nombreUsuario="",$scope.apellidosUsuario="",$scope.correoUsuario="",$scope.rolUsuario="",$scope.nicknameUsuario="",$scope.mensajeActualizacion=""},$scope.create=function(){var cuentaid=this.cuenta._id,obj_cuenta={},nombre=this.firstName,apellido=this.lastName,completo=this.firstName+" "+this.lastName,correo=this.email,login=this.username,passwd=this.password,elrol=this.rol;$resource("/marca/:marcaId",{marcaId:"@id"}).get({marcaId:cuentaid},function(data){obj_cuenta={_id:data._id,marca:data.marca}}).$promise.then(function(){var user=new Lista({firstName:nombre,lastName:apellido,displayName:completo,email:correo,username:login,password:passwd,provider:"local",roles:elrol,cuenta:obj_cuenta});user.$save(function(response){$location.path("equipo/"),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})})},$scope.activaForm=function(infoUsuario){"community-manager"!==$scope.user.roles[0]&&"directivo"!==$scope.user.roles[0]&&($scope.idEdicion=infoUsuario)},$scope.desactivaForm=function(){$scope.idEdicion=""},$scope.updateProfile=function(idUsuario){var nombre=$scope.nombreUsuario,apellidos=$scope.apellidosUsuario,rol=$scope.rolUsuario,email=$scope.correoUsuario,nickname=$scope.nicknameUsuario;$scope.enable_notifications;console.log("Updeteando profile"),console.log($scope.enable_notifications),$http.post("/actualizaPerfil/",{nombre:nombre,apellido:apellidos,correo:email,rol:rol,idUsuario:idUsuario,nickname:nickname,notificaciones:$scope.enable_notifications}).success(function(data){0===data?$scope.mensajeActualizacion="Ha ocurrido un error al actualizar":(delete data[0].password,delete data[0].salt,$scope.mensajeActualizacion="Perfil Actualizado",$scope.muestraAct=!0,Authentication.user=data[0],$scope.user=Authentication.user)})},$scope.actualizaUsuarioAdmin=function(){var nombreActualizado=$scope.nombreUsuario,apellidoActualizado=$scope.apellidosUsuario,correoActualizado=$scope.correoUsuario,rolActualizado=$scope.rolUsuario,nickActualizado=$scope.nicknameUsuario;$scope.idUsuario;$http.post("/actualizaEquipo/",{nombre:nombreActualizado,apellido:apellidoActualizado,correo:correoActualizado,rol:rolActualizado,idUsuario:$scope.idUsuario,nickname:nickActualizado}).success(function(data){0===data?$scope.mensajeActualizacion="Ocurrio un error al eliminar el usuario":1===data&&($scope.mensajeActualizacion="Usuario Actualizado",$scope.listadoUsuarios(),$scope.idEdicion="")})},$scope.actualizaUsuario=function(){var nombreActualizado=$scope.nombreUsuario,apellidoActualizado=$scope.apellidosUsuario,correoActualizado=$scope.correoUsuario,rolActualizado=$scope.rolUsuario,nickActualizado=$scope.nicknameUsuario;$scope.idUsuario;$http.post("/actualizaEquipo/",{nombre:nombreActualizado,apellido:apellidoActualizado,correo:correoActualizado,rol:rolActualizado,idUsuario:$scope.idUsuario,nickname:nickActualizado}).success(function(data,status,headers,config){0===data?$scope.mensajeActualizacion="Ocurrio un error al eliminar el usuario":1===data&&($scope.mensajeActualizacion="Usuario Actualizado",$scope.listadoEquipo(),$scope.usuariosTeam($scope.idCuentaSelect,$scope.nombreCuentadefault),$scope.idEdicion="")})},$scope.update=function(){var id_marca=$scope.editeduser.cuenta._id,obj_cuenta={};delete $scope.editeduser.password,delete $scope.editeduser.salt,$scope.editeduser.cuenta={},$resource("/marca/:marcaId",{marcaId:"@id"}).get({marcaId:id_marca},function(data){obj_cuenta={_id:data._id,marca:data.nombreSistema}}).$promise.then(function(){$scope.editeduser.cuenta=obj_cuenta;var usuario=new Users($scope.editeduser);usuario.$update(function(){$location.path("usuario/"+usuario._id)},function(errorResponse){$scope.error=errorResponse.data.message})})},$scope.findOne=function(){delete $scope.editeduser,$scope.editeduser={},Lista.get({userId:$stateParams.usuarioID},function(data){$scope.editeduser=data})},$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){console.log("removeUserSocialAccount"),$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response,$scope.statusLoginFacebook2=!1,console.log("success")}).error(function(response){$scope.error=response.message,$scope.statusLoginFacebook2=!0,console.log("error")}),console.log("status facebook"),console.log($scope.statusLoginFacebook2)},$scope.getMarca=function(){return Cuenta.query()},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.submit=function(idUsuario){var elemento1=angular.element(document.querySelector("#foto-perfil"));elemento1.addClass("loader_image");var elemento2=angular.element(document.querySelector("#foto-perfil-lateral"));elemento2.addClass("loader_image");var idUser=$scope.user._id,fd=new FormData,f=document.getElementById("file").files[0];fd.append("idUsuario",idUser),fd.append("file",f),fd.append("nombre",$scope.nombre),fd.append("nombre_corto",$scope.nombre_corto),$http.post("/actualizaFoto",fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(response){1===response?$scope.errorImagen="No se pudo cargar la imagen":2===response?$scope.errorImagen="No se pudo actualizar la imagen":(Authentication.user=response[0],$scope.user=Authentication.user,elemento1.removeClass("loader_image"),elemento2.removeClass("loader_image"))})},$scope.cambiaImagen=function(){var f=document.getElementById("file").files[0],r=new FileReader;r.onloadend=function(e){var data=e.target.result;$scope.image=data;var fileDisplayArea=document.getElementById("fileDisplayArea");fileDisplayArea.innerHTML="";var img=new Image;img.src=r.result;var aux=r.result,image=aux.replace("data:image/jpeg;base64,","");image=image.replace(" ","+"),fileDisplayArea.appendChild(img)},r.readAsDataURL(f)},$scope.find=function(){$scope.users=Lista.query()},$scope.findByCuenta=function(){Listabycuenta.get({accId:$scope.user.cuenta._id},function(data){$scope.usersbyaccount=data})},$scope.listadoEquipo=function(){$http.post("/listadoEquipo/",{cuenta:$scope.user.cuenta.marca,idCuenta:$scope.user.cuenta._id}).success(function(data,status,headers,config){$scope.usersbyaccount=data})},$scope.listadoUsuarios=function(){$http.post("/listadoUsuarios/",{}).success(function(data,status,headers,config){$scope.usersbyaccount=data})},$scope.informacionEquipo=function(infoUsuario){$scope.idEdicion="",$scope.infoUser=infoUsuario,$scope.imagenPerfil=infoUsuario.imagen_src,""===infoUsuario.imagen_src||"undefined"==typeof infoUsuario.imagen_src?$scope.imagenPerfil=$scope.imagenDefecto:$http.get($scope.imagenPerfil).success(function(data){}).error(function(data){$scope.imagenPerfil=$scope.imagenDefecto}),$scope.idUsuario=infoUsuario._id,$scope.nombreCompleto=infoUsuario.firstName+" "+infoUsuario.lastName,$scope.nombreUsuario=infoUsuario.firstName,$scope.apellidosUsuario=infoUsuario.lastName,$scope.correoUsuario=infoUsuario.email,$scope.rolUsuario=infoUsuario.roles[0],$scope.nicknameUsuario=infoUsuario.username,$scope.mensajeActualizacion=""},$scope.remove=function(){$scope.user=Lista.remove({userId:$stateParams.usuarioID}),$location.path("/settings/list")},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})},$scope.$on("agregaUsuario",function(event,message){$scope.usuariosTeam($scope.idCuentaSelect,$scope.nombreCuentadefault),$scope.imagenPerfil="",$scope.idUsuario="",$scope.nombreCompleto="",$scope.nombreUsuario="",$scope.apellidosUsuario="",$scope.correoUsuario="",$scope.rolUsuario="",$scope.nicknameUsuario="",$scope.mensajeActualizacion=""}),$scope.$on("actualizaUsuarios",function(event,message){$scope.usuariosTeam($scope.idCuentaSelect,$scope.nombreCuentadefault)}),$scope.$on("cambiaPassword",function(event,message){$scope.mensajeActualizacion=message}),$scope.$on("actualizaUsuario",function(event,message){$scope.mensajeActualizacion="Perfil Actualizado",Authentication.user=message,$scope.user=Authentication.user})}]).controller("TooltipDemoCtrl",["$scope",function($scope){$scope.htmlTooltip='<a href="">I\'ve been made <b>bold</b>!</a>'}]).controller("ModalEquipo",["$scope","$modal","$log","$resource","Authentication","Users","Lista",function($scope,$modal,$log,$resource,Authentication,Users,Lista){$scope.authentication=Authentication,$scope.statusLoginFacebook=!1,"undefined"!=typeof $scope.authentication.user.additionalProvidersData&&($scope.statusLoginFacebook=!0),$scope.open=function(usuario,rolActual,idCuenta,nombreCuenta){$scope.rolUsuarioActual=rolActual,$scope.idUsuario=usuario._id,$scope.cuentaDefault=nombreCuenta,$scope.idCuenta=idCuenta;var modalInstance=$modal.open({templateUrl:"agregaUsuario.html",controller:"ModalInstanceEquipo",size:150,resolve:{cuentaDefault:function(){return $scope.cuentaDefault},idCuenta:function(){return $scope.idCuenta},idUsuario:function(){return $scope.idUsuario},rolDefault:function(){return $scope.rolUsuarioActual}}});modalInstance.result.then(function(data){$scope.$emit("agregaUsuario",data)},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.openEditarContrasena=function(idUsuario){var modalInstance=$modal.open({templateUrl:"editarContrasena.html",controller:"ModalInstancePassword",size:150,resolve:{idUsuario:function(){return idUsuario}}});modalInstance.result.then(function(data){$scope.$emit("cambiaPassword",data)},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.openFoto=function(idUsuario){$scope.idUsuario=idUsuario;var modalInstance=$modal.open({templateUrl:"fotoPerfil.html",controller:"ModalInstanceFoto",size:150,resolve:{idUsuario:function(){return idUsuario}}});modalInstance.result.then(function(data){delete data[0].password,delete data[0].salt,$scope.$emit("actualizaUsuario",data[0])},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.openEliminacion=function(usuario,rolActual){$scope.rolUsuarioActual=rolActual,$scope.idUsuario=usuario._id,$scope.cuentaDefault=usuario.cuenta.marca,$scope.idCuenta=usuario.cuenta._id;var modalInstance=$modal.open({templateUrl:"eliminaUsuario.html",controller:"ModalInstanceEquipo",size:150,resolve:{cuentaDefault:function(){return $scope.cuentaDefault},idCuenta:function(){return $scope.idCuenta},idUsuario:function(){return $scope.idUsuario},rolDefault:function(){return $scope.rolUsuarioActual}}});modalInstance.result.then(function(data){"equipo"===data?$scope.$emit("agregaUsuario",data):"borraAdmin"===data&&$scope.$emit("actualizaUsuarios",data)},function(){$log.info("Modal dismissed at: "+new Date)})}}]).controller("ModalInstanceEquipo",["$scope","$modalInstance","cuentaDefault","rolDefault","idCuenta","idUsuario","$resource","$http","Accounts","Authentication","Users","Lista",function($scope,$modalInstance,cuentaDefault,rolDefault,idCuenta,idUsuario,$resource,$http,Accounts,Authentication,Users,Lista){switch($scope.cuentaDefault=cuentaDefault,$scope.idCuenta=idCuenta,$scope.idUsuario=idUsuario,rolDefault){case"app-manager":$scope.losroles=[{name:"App Manager",value:"app-manager"},{name:"Account Manager",value:"account-manager"},{name:"Community Manager",value:"community-manager"},{name:"Directivo",value:"directivo"}];break;case"account-manager":$scope.losroles=[{name:"Account Manager",value:"account-manager"},{name:"Community Manager",value:"community-manager"},{name:"Directivo",value:"directivo"}];break;default:$scope.losroles=null}$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(respuesta){$modalInstance.close(respuesta)},$scope.createUsuario=function(){var cuentaid=$scope.idCuenta,obj_cuenta={},nombre=this.firstName,apellido=this.lastName,completo=this.firstName+" "+this.lastName,correo=this.email,login=this.username,passwd=this.password,elrol=this.rol;$resource("/marca/:marcaId",{marcaId:"@id"}).get({marcaId:cuentaid},function(data){obj_cuenta={_id:$scope.idCuenta,marca:$scope.cuentaDefault}}).$promise.then(function(){var user=new Lista({firstName:nombre,lastName:apellido,displayName:completo,email:correo,username:login,password:passwd,provider:"local",roles:elrol,cuenta:obj_cuenta});user.$save(function(response){$scope.ok("equipo"),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})})},$scope.createUsuarioAdmin=function(){var cuentaid=$scope.idCuenta,obj_cuenta={},nombre=this.firstName,apellido=this.lastName,completo=this.firstName+" "+this.lastName,correo=this.email,login=this.username,passwd=this.password,elrol=this.rol;$resource("/marca/:marcaId",{marcaId:"@id"}).get({marcaId:cuentaid},function(data){obj_cuenta={_id:$scope.idCuenta,marca:$scope.cuentaDefault}}).$promise.then(function(){var user=new Lista({firstName:nombre,lastName:apellido,displayName:completo,email:correo,username:login,password:passwd,provider:"local",roles:elrol,cuenta:obj_cuenta});user.$save(function(response){$scope.ok("borraAdmin"),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})})},$scope.borraUsuario=function(){$http.post("/eliminaEquipo/",{cuenta:cuentaDefault,idUsuario:$scope.idUsuario}).success(function(data){0===data?$scope.errorEliminar="An error occurred when deleting the user":1===data&&$scope.ok("equipo")})},$scope.borraUsuarioAdmin=function(){$http.post("/eliminaEquipo/",{cuenta:cuentaDefault,idUsuario:$scope.idUsuario}).success(function(data){0===data?$scope.errorEliminar="An error occurred when deleting the user":1===data&&$scope.ok("borraAdmin")})}}]).controller("ModalInstancePerfil",["$scope","datosUsuario","$modalInstance","$resource","$http","Accounts","Authentication","Users","Lista",function($scope,datosUsuario,$modalInstance,$resource,$http,Accounts,Authentication,Users,Lista){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(respuesta){$modalInstance.close(respuesta)},$scope.updateProfile=function(){var nombre=datosUsuario.nombre,apellidos=datosUsuario.apellidos,rol=datosUsuario.rol,email=datosUsuario.email,nickname=datosUsuario.nickname,idUsuario=datosUsuario.idUser;$http.post("/actualizaPerfil/",{nombre:nombre,apellido:apellidos,correo:email,rol:rol,idUsuario:idUsuario,nickname:nickname}).success(function(data,status,headers,config){"0"===data?$scope.mensajeActualizacion="An error occurred while updating user data":$scope.ok(data)})}}]).controller("ModalInstancePassword",["idUsuario","$scope","$modalInstance","$resource","$http","$stateParams","Accounts","Authentication","Users","Lista",function(idUsuario,$scope,$modalInstance,$resource,$http,$stateParams,Accounts,Authentication,Users,Lista){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(respuesta){$modalInstance.close(respuesta)},$scope.updatePassword=function(){var textos={"Please fill out all marked boxes":"Favor de llenar los campos vacíos","The entered password is too short, please try again":"La contraseña ingresada es muy corta, por favor intente nuevamente","The current password is incorrect":"La contraseña actual es incorrecta","The new passwords you entered did not match, please try again":"Las contraseñas no coinciden, por favor intentalo nuevamente","The password has been successfully updated":"La contraseña se actualizó","User not found":"Usuario no encontrado","Please enter a different password":"Ingresa una contraseña distinta","The user is not logged":"El usuario no esta logueado","There was an unknown error please try again later":"Error Desconocido"},passwordActual=$scope.password,passNuevo=$scope.newPassword,confirmaPass=$scope.confirmPassword,passwordDetails={};passwordDetails.newPassword=passNuevo,passwordDetails.verifyPassword=confirmaPass,passwordDetails.currentPassword=passwordActual,$scope.success=$scope.error=null,$scope.errorValidacion=0,$scope.mensajeValidacion=textos["Please fill out all marked boxes"],$scope.passwordActualVacio=!1,$scope.passwordNuevoVacio1=!1,$scope.passwordNuevoVacio2=!1,(""===$scope.password||"undefined"==typeof $scope.password)&&($scope.passwordActualVacio=!0,$scope.errorValidacion++),(""===$scope.newPassword||"undefined"==typeof $scope.newPassword)&&($scope.passwordNuevoVacio1=!0,$scope.errorValidacion++),(""===$scope.confirmPassword||"undefined"==typeof $scope.confirmPassword)&&($scope.passwordNuevoVacio2=!0,$scope.errorValidacion++),$scope.errorValidacion<=0&&$http.post("/users/password/",passwordDetails).success(function(response){1===response?$scope.mensajePassword=textos["The entered password is too short, please try again"]:2===response?$scope.mensajePassword=textos["The current password is incorrect"]:3===response?$scope.mensajePassword=textos["The new passwords you entered did not match, please try again"]:4===response?($scope.mensajePassword=textos["The password has been successfully updated"],$scope.ok(),$scope.passwordDetails=null):5===response?$scope.mensajePassword=textos["User not found"]:6===response?$scope.mensajePassword=textos["Please enter a different password"]:7===response?$scope.mensajePassword=textos["The user is not logged"]:$scope.mensajePassword=textos["There was an unknown error please try again later"]})},$scope.changePassword=function(){var textos={"The entered password is too short, please dial another":"La contraseña ingresada es muy corta, por favor intente nuevamente","The current password is incorrect":"La contraseña actual es incorrecta","The new passwords you entered did not match, please try again":"Las contraseñas no coinciden, intentalo nuevamente","The password has been successfully updated":"La contraseña se actualizó","User not found":"Usuario no encontrado","Please enter a different password":"Por favor ingresa una contraseña distinta","The user is not logged":"El usuario no esta logueado","There was an unknown error please try again later":"Error desconocido, intentalo nuevamente"},passNuevo=$scope.newPassword,confirmaPass=$scope.confirmPassword,passwordDetails={};passwordDetails.newPassword=passNuevo,passwordDetails.verifyPassword=confirmaPass,$scope.success=$scope.error=null,$http.post("/users/AdminPassword/",{passwordDetails:passwordDetails,idUsuario:idUsuario}).success(function(response){1===response?$scope.errorPassword=textos["The entered password is too short, please dial another"]:2===response?$scope.errorPassword=textos["The current password is incorrect"]:3===response?$scope.errorPassword=textos["The new passwords you entered did not match, please try again"]:4===response?($scope.errorPassword=textos["The password has been successfully updated"],$scope.ok($scope.errorPassword),$scope.passwordDetails=null):5===response?$scope.errorPassword=textos["User not found"]:6===response?$scope.errorPassword=textos["Please enter a different password"]:7===response?$scope.errorPassword=textos["The user is not logged"]:$scope.errorPassword=textos["There was an unknown error please try again later"]})}}]).controller("ModalInstanceFoto",["idUsuario","$scope","$modalInstance","$resource","$http","$stateParams","Accounts","Authentication","Users","Lista",function(idUsuario,$scope,$modalInstance,$resource,$http,$stateParams,Accounts,Authentication,Users,Lista){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(respuesta){$modalInstance.close(respuesta)},$scope.submit=function(req,res){var textos={"Failed to load image":"Failed to load image","Could not update image":"Could not update image"},fd=new FormData,f=document.getElementById("file").files[0];fd.append("idUsuario",idUsuario),fd.append("file",f),fd.append("nombre",$scope.nombre),fd.append("nombre_corto",$scope.nombre_corto),$http.post("/actualizaFoto",fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(response){1===response?$scope.errorImagen=textos["Failed to load image"]:2===response?$scope.errorImagen=textos["Could not update image"]:$scope.ok(response)})},$scope.cambiaImagen=function(){var f=document.getElementById("file").files[0],r=new FileReader;r.onloadend=function(e){var data=e.target.result;$scope.image=data;var fileDisplayArea=document.getElementById("fileDisplayArea");fileDisplayArea.innerHTML="";var img=new Image;img.src=r.result;var aux=r.result,image=aux.replace("data:image/jpeg;base64,","");image=image.replace(" ","+"),fileDisplayArea.appendChild(img)},r.readAsDataURL(f)}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Cuenta",["$resource",function($resource){return $resource("cuentas/",{cuentaId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").factory("GetMarca",["$resource",function($resource){return $resource("marca/:marcaId",{marcaId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").factory("Lista",["$resource",function($resource){return $resource("users/list/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").factory("Listabycuenta",["$resource",function($resource){return $resource("users/listbyaccount/:accId",{accId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);